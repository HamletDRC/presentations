/*
 MIT
 @url http://livepipe.net/projects/control_modal/
 @version 2.2.3
*/
(function($){var regs={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowerUpper:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g},getObject=function(objectName,currentin,add){var current=currentin||window,parts=objectName?objectName.split(/\./):[],ret,i=0;for(;i<parts.length-1&&current;i++)current=current[parts[i]]||add&&(current[parts[i]]={});if(parts.length==0)return currentin;ret=current[parts[i]]||add&&(current[parts[i]]={});if(add===false)delete current[parts[i]];
return ret},str=$.String={getObject:getObject,strip:function(string){return string.replace(/^\s+/,"").replace(/\s+$/,"")},capitalize:function(s,cache){return s.charAt(0).toUpperCase()+s.substr(1)},endsWith:function(s,pattern){var d=s.length-pattern.length;return d>=0&&s.lastIndexOf(pattern)===d},camelize:function(s){var parts=s.split(regs.undHash),i=1;parts[0]=parts[0].charAt(0).toLowerCase()+parts[0].substr(1);for(;i<parts.length;i++)parts[i]=str.capitalize(parts[i]);return parts.join("")},classize:function(s){var parts=
s.split(regs.undHash),i=0;for(;i<parts.length;i++)parts[i]=str.capitalize(parts[i]);return parts.join("")},niceName:function(s){var parts=s.split(regs.undHash),i=0;for(;i<parts.length;i++)parts[i]=str.capitalize(parts[i]);return parts.join(" ")},underscore:function(s){return s.replace(regs.colons,"/").replace(regs.words,"$1_$2").replace(regs.lowerUpper,"$1_$2").replace(regs.dash,"_").toLowerCase()},sub:function(s,data,remove){var obs=[];obs.push(s.replace(regs.replacer,function(whole,inside){var ob=
getObject(inside,data,!remove),type=typeof ob;if((type==="object"||type==="function")&&type!==null){obs.push(ob);return""}else return""+ob}));return obs.length<=1?obs[0]:obs}}})(jQuery);
(function($){var initializing=false,makeArray=$.makeArray,isFunction=$.isFunction,isArray=$.isArray,concatArgs=function(arr,args){return arr.concat(makeArray(args))},fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,inheritProps=function(newProps,oldProps,addTo){addTo=addTo||newProps;for(var name in newProps)addTo[name]=isFunction(newProps[name])&&isFunction(oldProps[name])&&fnTest.test(newProps[name])?function(name,fn){return function(){var tmp=this._super,ret;this._super=oldProps[name];ret=fn.apply(this,
arguments);this._super=tmp;return ret}}(name,newProps[name]):newProps[name]},clss=$.Class=function(){if(arguments.length)clss.extend.apply(clss,arguments)};$.extend(clss,{callback:function(funcs){var args=makeArray(arguments),self;funcs=args.shift();if(!isArray(funcs))funcs=[funcs];self=this;return function class_cb(){var cur=concatArgs(args,arguments),isString,length=funcs.length,f=0,func;for(;f<length;f++){func=funcs[f];if(!func)continue;isString=typeof func=="string";if(isString&&self._set_called)self.called=
func;cur=(isString?self[func]:func).apply(self,cur||[]);if(f<length-1)cur=!isArray(cur)||cur._use_call?[cur]:cur}return cur}},getObject:$.String.getObject,newInstance:function(){var inst=this.rawInstance(),args;if(inst.setup)args=inst.setup.apply(inst,arguments);if(inst.init)inst.init.apply(inst,isArray(args)?args:arguments);return inst},setup:function(oldClass,fullName){this.defaults=$.extend(true,{},oldClass.defaults,this.defaults);return arguments},rawInstance:function(){initializing=true;var inst=
new this;initializing=false;return inst},extend:function(fullName,klass,proto){if(typeof fullName!="string"){proto=klass;klass=fullName;fullName=null}if(!proto){proto=klass;klass=null}proto=proto||{};var _super_class=this,_super=this.prototype,name,shortName,namespace,prototype;initializing=true;prototype=new this;initializing=false;inheritProps(proto,_super,prototype);function Class(){if(initializing)return;if(this.constructor!==Class&&arguments.length)return arguments.callee.extend.apply(arguments.callee,
arguments);else return this.Class.newInstance.apply(this.Class,arguments)}for(name in this)if(this.hasOwnProperty(name)&&$.inArray(name,["prototype","defaults","getObject"])==-1)Class[name]=this[name];inheritProps(klass,this,Class);if(fullName){var parts=fullName.split(/\./),shortName=parts.pop(),current=clss.getObject(parts.join("."),window,true),namespace=current;current[shortName]=Class}$.extend(Class,{prototype:prototype,namespace:namespace,shortName:shortName,constructor:Class,fullName:fullName});
Class.prototype.Class=Class.prototype.constructor=Class;var args=Class.setup.apply(Class,concatArgs([_super_class],arguments));if(Class.init)Class.init.apply(Class,args||[]);return Class}});clss.prototype.callback=clss.callback})(jQuery);LowPro={};LowPro.Version="0.5";LowPro.CompatibleWithPrototype="1.6";
if(Prototype.Version.indexOf(LowPro.CompatibleWithPrototype)!=0&&window.console&&window.console.warn)console.warn("This version of Low Pro is tested with Prototype "+LowPro.CompatibleWithPrototype+" it may not work as expected with this version ("+Prototype.Version+")");if(!Element.addMethods)Element.addMethods=function(o){Object.extend(Element.Methods,o)};DOM={};
DOM.Builder={tagFunc:function(tag){return function(){var attrs,children;if(arguments.length>0){if(arguments[0].constructor==Object){attrs=arguments[0];children=Array.prototype.slice.call(arguments,1)}else children=arguments;children=$A(children).flatten()}return DOM.Builder.create(tag,attrs,children)}},create:function(tag,attrs,children){attrs=attrs||{};children=children||[];tag=tag.toLowerCase();var el=new Element(tag,attrs);for(var i=0;i<children.length;i++){if(typeof children[i]=="string")children[i]=
document.createTextNode(children[i]);el.appendChild(children[i])}return $(el)}};(function(){var els=("p|div|span|strong|em|img|table|tr|td|th|thead|tbody|tfoot|pre|code|"+"h1|h2|h3|h4|h5|h6|ul|ol|li|form|input|textarea|legend|fieldset|"+"select|option|blockquote|cite|br|hr|dd|dl|dt|address|a|button|abbr|acronym|"+"script|link|style|bdo|ins|del|object|param|col|colgroup|optgroup|caption|"+"label|dfn|kbd|samp|var").split("|");var el,i=0;while(el=els[i++])window["$"+el]=DOM.Builder.tagFunc(el)})();
DOM.Builder.fromHTML=function(html){var root;if(!(root=arguments.callee._root))root=arguments.callee._root=document.createElement("div");root.innerHTML=html;return root.childNodes[0]};Object.extend(Event,{onReady:function(f){if(document.body)f();else document.observe("dom:loaded",f)}});
Event.addBehavior=function(rules){var ab=this.addBehavior;Object.extend(ab.rules,rules);if(!ab.responderApplied){Ajax.Responders.register({onComplete:function(){if(Event.addBehavior.reassignAfterAjax)setTimeout(function(){ab.reload()},10)}});ab.responderApplied=true}if(ab.autoTrigger)this.onReady(ab.load.bind(ab,rules))};Event.delegate=function(rules){return function(e){for(var selector in rules)if(e.findElement(selector))return rules[selector].apply(this,$A(arguments))}};
Object.extend(Event.addBehavior,{rules:{},cache:[],reassignAfterAjax:false,autoTrigger:true,load:function(rules){for(var selector in rules){var observer=rules[selector];var sels=selector.split(",");sels.each(function(sel){var parts=sel.split(/:(?=[a-z]+$)/),css=parts[0],event=parts[1];$$(css).each(function(element){if(event){var wrappedObserver=Event.addBehavior._wrapObserver(observer);$(element).observe(event,wrappedObserver);Event.addBehavior.cache.push([element,event,wrappedObserver])}else if(!element.$$assigned||
!element.$$assigned.include(observer)){if(observer.attach)observer.attach(element);else observer.call($(element));element.$$assigned=element.$$assigned||[];element.$$assigned.push(observer)}})})}},unload:function(){this.cache.each(function(c){Event.stopObserving.apply(Event,c)});this.cache=[]},reload:function(){var ab=Event.addBehavior;ab.unload();ab.load(ab.rules)},_wrapObserver:function(observer){return function(event){if(observer.call(this,event)===false)event.stop()}}});
Event.observe(window,"unload",Event.addBehavior.unload.bind(Event.addBehavior));$$$=Event.addBehavior.bind(Event);
var Behavior={create:function(){var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))parent=properties.shift();var behavior=function(){if(!this.initialize){var args=$A(arguments);return function(){var initArgs=[this].concat(args);behavior.attach.apply(behavior,initArgs)}}else{var args=arguments.length==2&&arguments[1]instanceof Array?arguments[1]:Array.prototype.slice.call(arguments,1);this.element=$(arguments[0]);this.initialize.apply(this,args);behavior._bindEvents(this);
behavior.instances.push(this)}};Object.extend(behavior,Class.Methods);Object.extend(behavior,Behavior.Methods);behavior.superclass=parent;behavior.subclasses=[];behavior.instances=[];if(parent){var subclass=function(){};subclass.prototype=parent.prototype;behavior.prototype=new subclass;parent.subclasses.push(behavior)}for(var i=0;i<properties.length;i++)behavior.addMethods(properties[i]);if(!behavior.prototype.initialize)behavior.prototype.initialize=Prototype.emptyFunction;behavior.prototype.constructor=
behavior;return behavior},Methods:{attach:function(element){return new this(element,Array.prototype.slice.call(arguments,1))},_bindEvents:function(bound){for(var member in bound){var matches=member.match(/^on(.+)/);if(matches&&typeof bound[member]=="function")bound.element.observe(matches[1],Event.addBehavior._wrapObserver(bound[member].bindAsEventListener(bound)))}}}};
Remote=Behavior.create({initialize:function(options){if(this.element.nodeName=="FORM")new Remote.Form(this.element,options);else new Remote.Link(this.element,options)}});
Remote.Base={initialize:function(options){this.options=Object.extend({evaluateScripts:true},options||{});this._bindCallbacks()},_makeRequest:function(options){if(options.update)new Ajax.Updater(options.update,options.url,options);else new Ajax.Request(options.url,options);return false},_bindCallbacks:function(){$w("onCreate onComplete onException onFailure onInteractive onLoading onLoaded onSuccess").each(function(cb){if(Object.isFunction(this.options[cb]))this.options[cb]=this.options[cb].bind(this)}.bind(this))}};
Remote.Link=Behavior.create(Remote.Base,{onclick:function(){var options=Object.extend({url:this.element.href,method:"get"},this.options);return this._makeRequest(options)}});
Remote.Form=Behavior.create(Remote.Base,{onclick:function(e){var sourceElement=e.element();if(["input","button"].include(sourceElement.nodeName.toLowerCase())&&["submit","image"].include(sourceElement.type))this._submitButton=sourceElement},onsubmit:function(){var options=Object.extend({url:this.element.action,method:this.element.method||"get",parameters:this.element.serialize({submit:this._submitButton.name})},this.options);this._submitButton=null;return this._makeRequest(options)}});
Observed=Behavior.create({initialize:function(callback,options){this.callback=callback.bind(this);this.options=options||{};this.observer=this.element.nodeName=="FORM"?this._observeForm():this._observeField()},stop:function(){this.observer.stop()},_observeForm:function(){return this.options.frequency?new Form.Observer(this.element,this.options.frequency,this.callback):new Form.EventObserver(this.element,this.callback)},_observeField:function(){return this.options.frequency?new Form.Element.Observer(this.element,
this.options.frequency,this.callback):new Form.Element.EventObserver(this.element,this.callback)}});Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction;this.transport.abort();Ajax.activeRequestCount--};if(typeof console==="undefined")console={log:function(){}};function trace(msg){try{console.log(msg)}catch(e){}}
var PChangedEvent=Class.create({initialize:function(changedObject,options){this.changedObject=changedObject;this.attribute=null;this.type="change";Object.extend(this,options)}});
var PBaseModel=Class.create({initialize:function(data){this.changeListeners=new Array;this.destroyed=false;Object.extend(this,data);this.attribute_names=new Array;$H(data).each(function(d){this.attribute_names.push(d.key)}.bind(this))},getModelName:function(){return"PBaseModel"},serializeAttr:function(attr,objHash){return objHash.get(attr)},serialize:function(){var objHash=$H(this);var retval=new Hash;this.attribute_names.each(function(attr){retval.set(attr,this.serializeAttr(attr,objHash))}.bind(this));
return retval},destroy:function(){trace("destroy called!");this.destroyed=true;this.fireChange({type:"destroy"})},addChangeListener:function(listener){this.changeListeners.push(listener)},removeChangeListener:function(listener){this.changeListeners=this.changeListeners.without(listener)},fireChange:function(options){var changedEvent=new PChangedEvent(this,options);this.changeListeners.each(function(l){l(changedEvent)})},getId:function(){return this.id}});
document.observe("dom:loaded",function(){if($("feedback_anchor"))new PModal("feedback_anchor","/main/feedback",{},{});$$(".CodeRay").each(function(e){e.observe("click",function(t){e.toggleClassName("hide_numbers")})})});
var PModal=Class.create({initialize:function(action_id,target_callback,parameters,options){this.options=Object.extend({opacity:0.5,position:"absolute",width:500,height:570,identifier:null,modalTitle:null,padContents:true,onComplete:function(){},onSuccess:function(){},onFailure:function(){}},options||{});this.options.beforeOpen=this.openHandler.bindAsEventListener(this);this.options.beforeClose=this.closeHandler.bindAsEventListener(this);this.action_id=$(action_id);this.identifier=this.action_id?this.action_id.getAttribute("id"):
this.options.identifier;this.target_callback=target_callback;this.parameters=parameters||{};if(this.action_id)this.action_id.observe("click",this.click.bindAsEventListener(this));if(this.action_id&&this.action_id.getAttribute("href"))this.action_id.setAttribute("href","#")},openHandler:function(){$$("object, embed").each(function(obj){obj.hide()})},closeHandler:function(){$$("object, embed").each(function(obj){obj.show()})},click:function(evt){if(evt)evt.stop();this.modal=Control.Modal.open('<div id="modal_'+
this.identifier+'" style="padding: 5px;"><img src="/images/loading.gif"></div>',this.options);this.modalDiv=$("modal_"+this.identifier);new Ajax.Request(this.target_callback,{method:"get",parameters:this.parameters,onSuccess:function(transport){var response=transport.responseText||"Something went wrong. Email us at <a href='mailto:help@posterous.com'>help@posterous.com.</a>";this.response=response;this.modalDiv.update(this.response);this.modalDiv.select(".close_modal_button").each(function(a){a.observe("click",
function(e){Event.stop(e);Control.Modal.close()})});this.options.onSuccess()}.bindAsEventListener(this),onFailure:function(){this.options.onFailure();alert("Something went wrong. Email us at help@posterous.com and we'll get back to you ASAP.")}.bindAsEventListener(this)})},getContainerNode:function(){return $("modal_"+this.identifier)},finishLazyLoad:function(){this.modalDiv.update(this.response)}});
PModal2=Class.create(PModal,{click:function(evt){if(evt)evt.stop();PModal2.currentModal=this;this.modal=Control.Modal.open('<div id="modal_'+this.identifier+'"></div>',this.options);var chrome=this.assembleModal();var containerNode=this.getContainerNode();containerNode.appendChild(chrome);this.modalDiv=containerNode.down(".main_area");this.modalDiv.update('<img src="/images/loading.gif" width="16" height="16" />');if(this.options.modalTitle)containerNode.down(".modal_title").update(this.options.modalTitle);
new Ajax.Request(this.target_callback,{method:"get",parameters:this.parameters,onComplete:function(response){Event.addBehavior.reload();if(FB&&FB.XFBML)FB.XFBML.parse();this.options.onComplete()}.bindAsEventListener(this),onSuccess:function(transport){var response=transport.responseText||"Something went wrong. Email us at <a href='mailto:help@posterous.com'>help@posterous.com.</a>";this.response=response;this.modalDiv.update(this.response);this.modalDiv.select(".close_modal_button").each(function(a){a.observe("click",
function(e){Event.stop(e);Control.Modal.close()})});if(!this.options.padContents)this.modalDiv.removeClassName("padded_content");this.options.onSuccess()}.bindAsEventListener(this),onFailure:function(){this.options.onFailure();alert("Something went wrong. Email us at help@posterous.com and we'll get back to you ASAP.")}.bindAsEventListener(this)})},assembleModal:function(){return $div({"class":"posterous_modal_skeleton1"},$div({"class":"header"},$h3({"class":"modal_title"})),$div({"class":"sidebar"}),
$div({"class":"main_area padded_content"}),$div({"class":"commands"},$div({"class":"right"},$div({"class":"ok_cmd button",onclick:"Control.Modal.close(); return false;"}))))}});
document.observe("dom:loaded",function(){if($("feedback_anchor"))new PModal("feedback_anchor","/main/feedback",{},{});$$(".CodeRay").each(function(e){e.observe("click",function(t){e.toggleClassName("hide_numbers")})});$$(".slide-out").each(function(slide){slide.select(".slide-out-toggler").each(function(tog){tog.observe("click",function(){slide.toggleClassName("slide-out-opened")})})})});var PREFILL_CLASSNAME="prefilled";
function prefillClearer(elem,defaultText){elem=$(elem);var enableText=function(){elem.value=defaultText;elem.addClassName(PREFILL_CLASSNAME)};var disableText=function(){elem.value="";elem.removeClassName(PREFILL_CLASSNAME)};elem.observe("focus",function(){if(elem.value==defaultText||elem.value=="Untitled")disableText();elem.removeClassName(PREFILL_CLASSNAME)});elem.observe("blur",function(){if(elem.value.blank())enableText()});$(elem.form).observe("reset",enableText);if(elem.value.blank())enableText();
if(elem.value!=defaultText||elem.value=="Untitled")elem.removeClassName(PREFILL_CLASSNAME)}if(typeof Control=="undefined")Control={};Control.Modal=Class.create();
Object.extend(Control.Modal,{loaded:false,loading:false,loadingTimeout:false,overlay:false,container:false,current:false,ie:false,effects:{containerFade:false,containerAppear:false,overlayFade:false,overlayAppear:false},targetRegexp:/#(.+)$/,imgRegexp:/\.(jpe?g|gif|png|tiff?)($|\?.+)/i,overlayStyles:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:9998},overlayIEStyles:{position:"absolute",top:0,left:0,zIndex:9998},disableHoverClose:false,load:function(){if(!Control.Modal.loaded){Control.Modal.loaded=
true;Control.Modal.ie=!(typeof document.body.style.maxHeight!="undefined");Control.Modal.overlay=$(document.createElement("div"));Control.Modal.overlay.id="modal_overlay";Object.extend(Control.Modal.overlay.style,Control.Modal["overlay"+(Control.Modal.ie?"IE":"")+"Styles"]);Control.Modal.overlay.hide();Control.Modal.container_holder=$(document.createElement("div"));Control.Modal.container_holder.id="modal_container_holder";Control.Modal.container=$(document.createElement("div"));Control.Modal.container.id=
"modal_container";Control.Modal.container_holder.hide();Control.Modal.loading=$(document.createElement("div"));Control.Modal.loading.id="modal_loading";Control.Modal.loading.hide();var body_tag=document.getElementsByTagName("body")[0];body_tag.appendChild(Control.Modal.overlay);Control.Modal.container_holder.appendChild(Control.Modal.container);body_tag.appendChild(Control.Modal.container_holder);body_tag.appendChild(Control.Modal.loading);Control.Modal.container_holder.observe("mouseout",function(event){if(!Control.Modal.disableHoverClose&&
Control.Modal.current&&Control.Modal.current.options.hover&&!Position.within(Control.Modal.container_holder,Event.pointerX(event),Event.pointerY(event)))Control.Modal.close()})}},open:function(contents,options){options=options||{};if(!options.contents)options.contents=contents;var modal_instance=new Control.Modal(false,options);modal_instance.open();return modal_instance},close:function(force){if(typeof force!="boolean")force=false;if(Control.Modal.current)Control.Modal.current.close(force)},attachEvents:function(){Event.observe(window,
"load",Control.Modal.load)},center:function(element){if(!element._absolutized){element.setStyle({position:"absolute"});element._absolutized=true}var dimensions=element.getDimensions();if(dimensions.width==0||dimensions.height==0)dimensions=Control.Modal.recursiveGetDimensions(element);Position.prepare();var offset_left=Position.deltaX+Math.floor((Control.Modal.getWindowWidth()-dimensions.width)/2);var offset_top=Position.deltaY+(Control.Modal.getWindowHeight()>dimensions.height?Math.floor((Control.Modal.getWindowHeight()-
dimensions.height)/2):0);var scroll_offset=element.cumulativeScrollOffset();var new_offset_left=scroll_offset[0];var new_offset_top=scroll_offset[1];if(element.down(1)!=undefined&&element.down(1).hasClassName("subscription_form"))element.setStyle({margin:(new_offset_top!=null&&new_offset_top>0?new_offset_top:"0")+"px "+"0px "+"0px "+"0px ",left:dimensions.width<=Control.Modal.getWindowWidth()?(offset_left!=null&&offset_left>0?offset_left:"0")+"px":0});else element.setStyle({top:(offset_top!=null&&
offset_top>0?offset_top:"0")+"px",left:dimensions.width<=Control.Modal.getWindowWidth()?(offset_left!=null&&offset_left>0?offset_left:"0")+"px":0})},recursiveGetDimensions:function(element){var children=element.select("*");return{width:children.clone().map(function(el){return el.getWidth()}).max(),height:children.clone().map(function(el){return el.getHeight()}).max()}},getWindowWidth:function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0},getWindowHeight:function(){return self.innerHeight||
document.documentElement.clientHeight||document.body.clientHeight||0},getDocumentWidth:function(){return Math.min(document.body.scrollWidth,Control.Modal.getWindowWidth())},getDocumentHeight:function(){return Math.max(document.body.scrollHeight,Control.Modal.getWindowHeight())},onKeyDown:function(event){if(event.keyCode==Event.KEY_ESC)Control.Modal.close()}});
Object.extend(Control.Modal.prototype,{mode:"",html:false,href:"",element:false,src:false,imageLoaded:false,ajaxRequest:false,initialize:function(element,options){this.element=$(element);this.options={beforeOpen:Prototype.emptyFunction,afterOpen:Prototype.emptyFunction,beforeClose:Prototype.emptyFunction,afterClose:Prototype.emptyFunction,onSuccess:Prototype.emptyFunction,onFailure:Prototype.emptyFunction,onException:Prototype.emptyFunction,beforeImageLoad:Prototype.emptyFunction,afterImageLoad:Prototype.emptyFunction,
autoOpenIfLinked:true,contents:false,loading:false,fade:false,fadeDuration:0.75,image:false,target:false,imageCloseOnClick:true,hover:false,iframe:false,iframeTemplate:new Template('<iframe src="#{href}" width="100%" height="100%" frameborder="0" id="#{id}"></iframe>'),evalScripts:true,requestOptions:{},overlayDisplay:true,overlayClassName:"",overlayCloseOnClick:true,containerClassName:"",opacity:0.3,zIndex:9998,width:null,height:null,offsetLeft:0,offsetTop:0,position:"absolute",borderRadius:10,padding:0};
Object.extend(this.options,options||{});var target_match=false;var image_match=false;if(this.element){target_match=Control.Modal.targetRegexp.exec(this.element.href);image_match=Control.Modal.imgRegexp.exec(this.element.href)}if(this.options.position=="mouse")this.options.hover=true;if(this.options.contents)this.mode="contents";else if(this.options.image||image_match){this.mode="image";this.src=this.element.href}else if(this.options.target||target_match){this.mode="named";var target=this.options.target||
target_match[1];var x=$(target);this.html=x.innerHTML;x.remove();this.href=target}else{this.mode=this.options.iframe?"iframe":"ajax";this.href=this.element.href}if(this.element)if(this.options.hover){this.element.observe("mouseover",this.open.bind(this));this.element.observe("mouseout",function(event){if(!Position.within(Control.Modal.container_holder,Event.pointerX(event),Event.pointerY(event)))this.close()}.bindAsEventListener(this))}else this.element.onclick=function(event){this.open();Event.stop(event);
return false}.bindAsEventListener(this);var targets=Control.Modal.targetRegexp.exec(window.location);this.position=function(event){if(this.options.position=="absolute")Control.Modal.center(Control.Modal.container_holder);else{var xy=event&&this.options.position=="mouse"?[Event.pointerX(event),Event.pointerY(event)]:Position.cumulativeOffset(this.element);Control.Modal.container_holder.setStyle({position:"absolute",top:xy[1]+(typeof this.options.offsetTop=="function"?this.options.offsetTop():this.options.offsetTop)+
"px",left:xy[0]+(typeof this.options.offsetLeft=="function"?this.options.offsetLeft():this.options.offsetLeft)+"px"})}if(Control.Modal.ie)Control.Modal.overlay.setStyle({height:Control.Modal.getDocumentHeight()+"px",width:Control.Modal.getDocumentWidth()+"px"})}.bind(this);if(this.mode=="named"&&this.options.autoOpenIfLinked&&targets&&targets[1]&&targets[1]==this.href)this.open()},showLoadingIndicator:function(){if(this.options.loading)Control.Modal.loadingTimeout=window.setTimeout(function(){var modal_image=
$("modal_image");if(modal_image)modal_image.hide();Control.Modal.loading.style.zIndex=this.options.zIndex+1;Control.Modal.loading.update('<img id="modal_loading" src="'+this.options.loading+'"/>');Control.Modal.loading.show();Control.Modal.center(Control.Modal.loading)}.bind(this),250)},hideLoadingIndicator:function(){if(this.options.loading){if(Control.Modal.loadingTimeout)window.clearTimeout(Control.Modal.loadingTimeout);var modal_image=$("modal_image");if(modal_image)modal_image.show();Control.Modal.loading.hide()}},
open:function(force){if(!force&&this.notify("beforeOpen")===false)return;if(!Control.Modal.loaded)Control.Modal.load();Control.Modal.close();if(!this.options.hover)Event.observe($(document.getElementsByTagName("body")[0]),"keydown",Control.Modal.onKeyDown);Control.Modal.current=this;if(!this.options.hover)Control.Modal.overlay.setStyle({zIndex:this.options.zIndex,opacity:this.options.opacity});var borderRadiusPx=this.options.borderRadius+"px";Control.Modal.container.setStyle({zIndex:this.options.zIndex+
2,position:"absolute",backgroundColor:"#fff",top:borderRadiusPx,left:borderRadiusPx,right:borderRadiusPx,bottom:borderRadiusPx});Control.Modal.container_holder.setStyle({zIndex:this.options.zIndex+1,padding:this.options.padding+"px",backgroundColor:Prototype.Browser.IE?"#999999":"rgba(44, 44, 44, 0.4)",width:this.options.width?(typeof this.options.width=="function"?this.options.width():this.options.width)+this.options.borderRadius*2+this.options.padding+"px":null,height:this.options.height?(typeof this.options.height==
"function"?this.options.height():this.options.height)+this.options.borderRadius*2+this.options.padding+"px":null});if(Control.Modal.ie&&!this.options.hover)$A(document.getElementsByTagName("select")).each(function(select){select.style.visibility="hidden"});Control.Modal.overlay.addClassName(this.options.overlayClassName);Control.Modal.container.addClassName(this.options.containerClassName);switch(this.mode){case "image":this.imageLoaded=false;this.notify("beforeImageLoad");this.showLoadingIndicator();
var img=document.createElement("img");img.onload=function(img){this.hideLoadingIndicator();this.update([img]);if(this.options.imageCloseOnClick)$(img).observe("click",Control.Modal.close);this.position();this.notify("afterImageLoad");img.onload=null}.bind(this,img);img.src=this.src;img.id="modal_image";break;case "ajax":this.notify("beforeLoad");var options={method:"post",onSuccess:function(request){this.hideLoadingIndicator();this.update(request.responseText);this.notify("onSuccess",request);this.ajaxRequest=
false}.bind(this),onFailure:function(){this.notify("onFailure")}.bind(this),onException:function(){this.notify("onException")}.bind(this)};Object.extend(options,this.options.requestOptions);this.showLoadingIndicator();this.ajaxRequest=new Ajax.Request(this.href,options);break;case "iframe":this.update(this.options.iframeTemplate.evaluate({href:this.href,id:"modal_iframe"}));break;case "contents":this.update(typeof this.options.contents=="function"?this.options.contents():this.options.contents);break;
case "named":this.update(this.html);break}if(!this.options.hover){if(this.options.overlayCloseOnClick&&this.options.overlayDisplay)Control.Modal.overlay.observe("click",Control.Modal.close);if(this.options.overlayDisplay)if(this.options.fade){if(Control.Modal.effects.overlayFade)Control.Modal.effects.overlayFade.cancel();Control.Modal.effects.overlayAppear=new Effect.Appear(Control.Modal.overlay,{queue:{position:"front",scope:"Control.Modal"},to:this.options.opacity,duration:this.options.fadeDuration/
2})}else Control.Modal.overlay.show()}if(this.options.position=="mouse"){this.mouseHoverListener=this.position.bindAsEventListener(this);this.element.observe("mousemove",this.mouseHoverListener)}this.notify("afterOpen")},update:function(html){if(typeof html=="string")Control.Modal.container.update(html);else{Control.Modal.container.update("");html.each?html.each(function(node){Control.Modal.container.appendChild(node)}):Control.Modal.container.appendChild(html)}if(this.options.fade){if(Control.Modal.effects.containerFade)Control.Modal.effects.containerFade.cancel();
Control.Modal.effects.containerAppear=new Effect.Appear(Control.Modal.container_holder,{queue:{position:"end",scope:"Control.Modal"},to:1,duration:this.options.fadeDuration/2})}else Control.Modal.container_holder.show();this.position();Event.observe(window,"resize",this.position,false)},close:function(force){if(!force&&this.notify("beforeClose")===false)return;if(this.ajaxRequest)this.ajaxRequest.transport.abort();this.hideLoadingIndicator();if(this.mode=="image"){var modal_image=$("modal_image");
if(this.options.imageCloseOnClick&&modal_image)modal_image.stopObserving("click",Control.Modal.close)}if(Control.Modal.ie&&!this.options.hover)$A(document.getElementsByTagName("select")).each(function(select){select.style.visibility="visible"});if(!this.options.hover)Event.stopObserving(window,"keyup",Control.Modal.onKeyDown);Control.Modal.current=false;Event.stopObserving(window,"resize",this.position,false);Event.stopObserving(window,"scroll",this.position,false);if(!this.options.hover){if(this.options.overlayCloseOnClick&&
this.options.overlayDisplay)Control.Modal.overlay.stopObserving("click",Control.Modal.close);if(this.options.overlayDisplay)if(this.options.fade){if(Control.Modal.effects.overlayAppear)Control.Modal.effects.overlayAppear.cancel();Control.Modal.effects.overlayFade=new Effect.Fade(Control.Modal.overlay,{queue:{position:"end",scope:"Control.Modal"},from:this.options.opacity,to:0,duration:this.options.fadeDuration/2})}else Control.Modal.overlay.hide()}if(this.options.fade){if(Control.Modal.effects.containerAppear)Control.Modal.effects.containerAppear.cancel();
Control.Modal.effects.containerFade=new Effect.Fade(Control.Modal.container,{queue:{position:"front",scope:"Control.Modal"},from:1,to:0,duration:this.options.fadeDuration/2,afterFinish:function(){Control.Modal.container.update("");this.resetClassNameAndStyles()}.bind(this)})}else{Control.Modal.container_holder.hide();Control.Modal.container.update("");this.resetClassNameAndStyles()}if(this.options.position=="mouse")this.element.stopObserving("mousemove",this.mouseHoverListener);this.notify("afterClose")},
resetClassNameAndStyles:function(){Control.Modal.overlay.removeClassName(this.options.overlayClassName);Control.Modal.container_holder.removeClassName(this.options.containerClassName);Control.Modal.container_holder.setStyle({height:null,width:null,top:null,left:null})},notify:function(event_name){try{if(this.options[event_name])return[this.options[event_name].apply(this.options[event_name],$A(arguments).slice(1))]}catch(e){if(e!=$break)throw e;else return false}}});if(typeof Object.Event!="undefined")Object.Event.extend(Control.Modal);
Control.Modal.attachEvents();
Object.extend(Control.Modal,{dynamicResize:function(new_dims,scope,queue){if(!scope)scope="control_modal_resize";if(!queue)queue="front";new_height=new_dims.height;new_width=new_dims.width;win_height=this.getWindowHeight();win_width=this.getWindowWidth();new_left=Math.floor((win_width-new_width)/2);new_top=Math.floor((win_height-new_height)/2);new Effect.Morph(this.container_holder.id,{style:{height:new_height+"px",width:new_width+"px",left:new_left+"px",top:new_top+"px"},duration:0.2,scope:scope,
queue:queue})},hideInternalElement:function(elem,effect){modal_height=$("modal_container_holder").getHeight();elem_height=this.getElemHeight(elem);if(effect)effect(elem,{queue:"front",scope:"control_modal_resize",duration:0.4});else elem.hide();this.waitForResize(function(){this.dynamicResize({height:modal_height-elem_height},"control_modal_resize","end")}.bind(this))},showInternalElement:function(elem,effect){modal_height=$("modal_container_holder").getHeight();elem_height=this.getElemHeight(elem);
elem.setStyle({display:"none"});this.dynamicResize({height:modal_height+elem_height},"control_modal_resize","front");this.waitForResize(function(){if(effect)effect(elem,{queue:"end",scope:"control_modal_resize",duration:0.2});else elem.show()}.bind(this))},getElemHeight:function(elem){elem_height=elem.getHeight();elem_margins=parseInt(elem.getStyle("margin-top"),"decimal")+parseInt(elem.getStyle("margin-bottom"),"decimal");return elem_height+elem_margins},waitForResize:function(callback){new PeriodicalExecuter(function(pe){if(Effect.Queues.get("control_modal_resize").effects.length==
0){pe.stop();callback()}},0.2)},swapElems:function(elem_to_hide,elem_to_show){if(typeof elem_to_hide=="string")elem_hide=$(elem_to_hide);else elem_hide=elem_to_hide;if(typeof elem_to_show=="string")elem_show=$(elem_to_show);else elem_show=elem_to_show;height_add=this.getElemHeight(elem_show);height_sub=this.getElemHeight(elem_hide);delta=height_add-height_sub;modal_height=$("modal_container_holder").getHeight();if(delta>0){this.dynamicResize({height:modal_height+delta});this.waitForResize(function(){Effect.SlideUp(elem_hide,
{queue:"front",scope:"control_modal_resize",duration:0.4});Effect.SlideDown(elem_show,{queue:"end",scope:"control_modal_resize",duration:0.4})})}else{Effect.Fade(elem_hide,{queue:"front",scope:"control_modal_resize"});Effect.Appear(elem_show,{queue:"front",scope:"control_modal_resize"});this.waitForResize(function(){this.dynamicResize({height:modal_height+delta})}.bind(this))}},visible:function(){if(this.container_holder)return this.container_holder.visible();else return false}});
if(Object.isUndefined(Proto))var Proto={};
Proto.Menu=Class.create({initialize:function(){var e=Prototype.emptyFunction;this.ie=Prototype.Browser.IE;this.options=Object.extend({selector:".contextmenu",className:"protoMenu",pageOffset:25,fade:false,zIndex:100,beforeShow:e,beforeHide:e,beforeSelect:e,position:"mouse_click",location:null,click:"right",width:null,menuAlign:"left"},arguments[0]||{});this.shim=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:false;",
frameborder:0});this.options.fade=this.options.fade&&!Object.isUndefined(Effect);this.container=new Element("div",{className:this.options.className,style:"display:none"});if(this.options.width!=null)this.container.setStyle({width:this.options.width+"px"});var list=new Element("ul");this.options.menuItems.each(function(item){var aLink="";if(!item.separator){aLink=Object.extend(new Element("a",{href:!item.href||item.method=="post"||item.method=="put"||item.method=="delete"?"#":item.href,title:item.name,
className:(item.className||"")+(item.disabled?" disabled":" enabled")}),{_method:item.method,_params:item.params,_confirm:item.confirm,_href:item.href,_callback:item.callback});aLink.observe("click",this.onClick.bind(this));aLink.observe("contextmenu",Event.stop);aLink.update(item.name);if(item.icon)aLink.setStyle({backgroundImage:"url("+item.icon+")",backgroundPosition:"8px 50%",backgroundRepeat:"no-repeat"})}list.insert((new Element("li",{className:item.separator?"separator":""})).insert(aLink))}.bind(this));
$(document.body).insert(this.container.insert(list).observe("contextmenu",Event.stop));if(this.ie)$(document.body).insert(this.shim);if(this.options.click=="right"){document.observe("click",function(e){if(this.container.visible()&&!e.isRightClick()){this.options.beforeHide(e);if(this.ie)this.shim.hide();this.container.hide()}}.bind(this));$$(this.options.selector).invoke("observe",Prototype.Browser.Opera?"click":"contextmenu",function(e){if(Prototype.Browser.Opera&&!e.ctrlKey)return;this.show(e)}.bind(this))}else{document.observe("click",
function(e){if(this.container.visible()){this.options.beforeHide(e);if(this.ie)this.shim.hide();this.container.hide()}}.bind(this));$$(this.options.selector).invoke("observe","click",function(e){this.container.visible()?this.container.hide():this.show(e);e.stop()}.bind(this))}},is_form_post:function(item){return},show:function(e){e.stop();this.options.beforeShow(e);var x=Event.pointer(e).x,y=Event.pointer(e).y,elDim=this.container.getDimensions();if(this.options.position=="relative"){var elemOffset=
this.options.location.cumulativeOffset();if(this.options.menuAlign=="left"){x=elemOffset[0];y=elemOffset[1]+this.options.location.getHeight()-2}else{x=elemOffset[0]+this.options.location.getWidth()-elDim.width;y=elemOffset[1]+this.options.location.getHeight()-2}}var vpDim=document.viewport.getDimensions(),vpOff=document.viewport.getScrollOffsets(),elOff={left:(x+elDim.width+this.options.pageOffset>vpDim.width?vpDim.width-elDim.width-this.options.pageOffset:x)+"px",top:(y-vpOff.top+elDim.height>vpDim.height&&
y-vpOff.top>elDim.height?y-elDim.height:y)+"px"};this.container.setStyle(elOff).setStyle({zIndex:this.options.zIndex});if(this.ie)this.shim.setStyle(Object.extend(Object.extend(elDim,elOff),{zIndex:this.options.zIndex-1})).show();this.options.fade?Effect.Appear(this.container,{duration:0.25}):this.container.show();this.event=e},onClick:function(e){var hide_after=false;if(e.target._href&&(!e.target._method||e.target._method=="get"))return true;else if(e.target._method=="delete")if(confirm("Are you sure?")){var f=
document.createElement("form");f.style.display="none";e.target.appendChild(f);f.method="POST";f.action=e.target._href;var m=document.createElement("input");m.setAttribute("type","hidden");m.setAttribute("name","_method");m.setAttribute("value","delete");f.appendChild(m);m=document.createElement("input");m.setAttribute("type","hidden");m.setAttribute("name","authenticity_token");m.setAttribute("value",window._token);f.appendChild(m);$H(e.target._params).each(function(pair){m=document.createElement("input");
m.setAttribute("type","hidden");m.setAttribute("name",pair.key);m.setAttribute("value",pair.value);f.appendChild(m)});f.submit();e.stop();return false}else hide_after=true;e.stop();if((hide_after||e.target._callback)&&!e.target.hasClassName("disabled")){this.options.beforeSelect(e);if(this.ie)this.shim.hide();this.container.hide();e.target._callback(this.event)}return true}});
String.prototype.parseColor=function(){var color="#";if(this.slice(0,4)=="rgb("){var cols=this.slice(4,this.length-1).split(",");var i=0;do color+=parseInt(cols[i]).toColorPart();while(++i<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();if(this.length==7)color=this.toLowerCase()}return color.length==7?color:arguments[0]||this};
Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return node.nodeType==3?node.nodeValue:node.hasChildNodes()?Element.collectTextNodes(node):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return node.nodeType==3?node.nodeValue:node.hasChildNodes()&&!Element.hasClassName(node,className)?Element.collectTextNodesIgnoreClass(node,className):""}).flatten().join("")};
Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:percent/100+"em"});if(Prototype.Browser.WebKit)window.scrollBy(0,0);return element};Element.getInlineOpacity=function(element){return $(element).style.opacity||""};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(" ");element.appendChild(n);element.removeChild(n)}catch(e){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(pos){return-Math.cos(pos*Math.PI)/2+0.5},reverse:function(pos){return 1-pos},flicker:function(pos){var pos=-Math.cos(pos*Math.PI)/4+0.75+Math.random()/4;return pos>1?1:pos},wobble:function(pos){return-Math.cos(pos*Math.PI*9*pos)/2+0.5},pulse:function(pos,pulses){return-Math.cos(pos*((pulses||
5)-0.5)*2*Math.PI)/2+0.5},spring:function(pos){return 1-Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6)},none:function(pos){return 0},full:function(pos){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(element){var tagifyStyle="position:relative";if(Prototype.Browser.IE)tagifyStyle+=";zoom:1";element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore((new Element("span",
{style:tagifyStyle})).update(character==" "?String.fromCharCode(160):character),child)});Element.remove(child)}})},multiple:function(element,effect){var elements;if((typeof element=="object"||Object.isFunction(element))&&element.length)elements=element;else elements=$(element).childNodes;var options=Object.extend({speed:0.1,delay:0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}))})},
PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(element,effect){element=$(element);effect=(effect||"appear").toLowerCase();var options=Object.extend({queue:{position:"end",scope:element.id||"global",limit:1}},arguments[2]||{});Effect[element.visible()?Effect.PAIRS[effect][1]:Effect.PAIRS[effect][0]](element,options)}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(iterator){this.effects._each(iterator)},add:function(effect){var timestamp=(new Date).getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case "front":this.effects.findAll(function(e){return e.state=="idle"}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn});break;case "with-last":timestamp=
this.effects.pluck("startOn").max()||timestamp;break;case "end":timestamp=this.effects.pluck("finishOn").max()||timestamp;break}effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||this.effects.length<effect.options.queue.limit)this.effects.push(effect);if(!this.interval)this.interval=setInterval(this.loop.bind(this),15)},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect});if(this.effects.length==0){clearInterval(this.interval);this.interval=
null}},loop:function(){var timePos=(new Date).getTime();for(var i=0,len=this.effects.length;i<len;i++)this.effects[i]&&this.effects[i].loop(timePos)}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName))return queueName;return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return(options[eventName+"Internal"]?"this.options."+eventName+"Internal(this);":"")+(options[eventName]?"this.options."+eventName+"(this);":"")}if(options&&options.transition===false)options.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1E3;this.finishOn=
this.startOn+this.options.duration*1E3;this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=function(){function dispatch(effect,eventName){if(effect.options[eventName+"Internal"])effect.options[eventName+"Internal"](effect);if(effect.options[eventName])effect.options[eventName](effect)}return function(pos){if(this.state==="idle"){this.state="running";dispatch(this,"beforeSetup");if(this.setup)this.setup();
dispatch(this,"afterSetup")}if(this.state==="running"){pos=this.options.transition(pos)*this.fromToDelta+this.options.from;this.position=pos;dispatch(this,"beforeUpdate");if(this.update)this.update(pos);dispatch(this,"afterUpdate")}}}();this.event("beforeStart");if(!this.options.sync)Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");
if(this.finish)this.finish();this.event("afterFinish");return}var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame}}},cancel:function(){if(!this.options.sync)Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);this.state="finished"},event:function(eventName){if(this.options[eventName+"Internal"])this.options[eventName+"Internal"](this);if(this.options[eventName])this.options[eventName](this)},
inspect:function(){var data=$H();for(property in this)if(!Object.isFunction(this[property]))data.set(property,this[property]);return"#<Effect:"+data.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1])},update:function(position){this.effects.invoke("render",position)},finish:function(position){this.effects.each(function(effect){effect.render(1);effect.cancel();effect.event("beforeFinish");if(effect.finish)effect.finish(position);effect.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value};this.start(Object.extend({from:from,to:to},options||{}))},update:function(position){this.method(position)}});
Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw Effect._elementDoesNotExistError;if(Prototype.Browser.IE&&!this.element.currentStyle.hasLayout)this.element.setStyle({zoom:1});var options=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(options)},update:function(position){this.element.setOpacity(position)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw Effect._elementDoesNotExistError;var options=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(options)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=
this.options.y-this.originalTop}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+"px",top:(this.options.y*position+this.originalTop).round()+"px"})}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element)throw Effect._elementDoesNotExistError;var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:percent},arguments[2]||{});this.start(options)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left",
"width","height","fontSize"].each(function(k){this.originalStyle[k]=this.element.style[k]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode==
"box")this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))this.dims=[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]},update:function(position){var currentScale=this.options.scaleFrom/100+this.factor*position;if(this.options.scaleContent&&this.fontSize)this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});this.setDimensions(this.dims[0]*
currentScale,this.dims[1]*currentScale)},finish:function(position){if(this.restoreAfterFinish)this.element.setStyle(this.originalStyle)},setDimensions:function(height,width){var d={};if(this.options.scaleX)d.width=width.round()+"px";if(this.options.scaleY)d.height=height.round()+"px";if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY)d.top=this.originalTop-topd+"px";if(this.options.scaleX)d.left=
this.originalLeft-leftd+"px"}else{if(this.options.scaleY)d.top=-topd+"px";if(this.options.scaleX)d.left=-leftd+"px"}}this.element.setStyle(d)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw Effect._elementDoesNotExistError;var options=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(options)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor)this.options.endcolor=
this.element.getStyle("background-color").parseColor("#ffffff");if(!this.options.restorecolor)this.options.restorecolor=this.element.getStyle("background-color");this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i]}.bind(this))},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(m,v,i){return m+
(this._base[i]+this._delta[i]*position).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});
Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset();if(options.offset)elementOffsets[1]+=options.offset;return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round())})};
Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1,to:0,afterFinishInternal:function(effect){if(effect.options.to!=0)return;effect.element.hide().setStyle({opacity:oldOpacity})}},arguments[1]||{});return new Effect.Opacity(element,options)};
Effect.Appear=function(element){element=$(element);var options=Object.extend({from:element.getStyle("display")=="none"?0:element.getOpacity()||0,to:1,afterFinishInternal:function(effect){effect.element.forceRerendering()},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show()}},arguments[1]||{});return new Effect.Opacity(element,options)};
Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle("position"),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(effect){Position.absolutize(effect.effects[0].element)},
afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle)}},arguments[1]||{}))};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping()}},arguments[1]||{}))};
Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(effect){effect.element.undoClipping()}},arguments[1]||{}))};
Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping()},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity})}})}},
arguments[1]||{}))};
Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle("top"),left:element.getStyle("left"),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned()},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle)}},arguments[1]||
{}))};
Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10;var oldStyle={top:element.getStyle("top"),left:element.getStyle("left")};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*
2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle)}})}})}})}})}})}})};
Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle("bottom");var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:""});
effect.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:effect.dims[0]-effect.element.clientHeight+"px"})},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom})}},arguments[1]||{}))};
Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle("bottom");var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();
if(window.opera)effect.element.setStyle({top:""});effect.element.makeClipping().show()},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:effect.dims[0]-effect.element.clientHeight+"px"})},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom})}},arguments[1]||{}))};
Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping()},afterFinishInternal:function(effect){effect.element.hide().undoClipping()}})};
Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case "top-left":initialMoveX=
initialMoveY=moveX=moveY=0;break;case "top-right":initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case "bottom-left":initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case "bottom-right":initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case "center":initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break}return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,
beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1,from:0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,
restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle)}},options))}})};
Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case "top-left":moveX=moveY=0;break;
case "top-right":moveX=dims.width;moveY=0;break;case "bottom-left":moveX=0;moveY=dims.height;break;case "bottom-right":moveX=dims.width;moveY=dims.height;break;case "center":moveX=dims.width/2;moveY=dims.height/2;break}return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0,from:1,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,
transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle)}},options))};
Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{},oldOpacity=element.getInlineOpacity(),transition=options.transition||Effect.Transitions.linear,reverser=function(pos){return 1-transition(-Math.cos(pos*(options.pulses||5)*2*Math.PI)/2+0.5)};return new Effect.Opacity(element,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity})}},options),{transition:reverser}))};
Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle)}})}},arguments[1]||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw Effect._elementDoesNotExistError;var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style))this.style=$H(options.style);else if(options.style.include(":"))this.style=options.style.parseStyle();else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();
this.style=this.style.reject(function(style){return style.value==css[style.key]});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]=""})}}this.start(options)},setup:function(){function parseColor(color){if(!color||["rgba(0, 0, 0, 0)","transparent"].include(color))color="#ffffff";color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),
16)})}this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor("#zzzzzz")!="#zzzzzz"){value=value.parseColor();unit="color"}else if(property=="opacity"){value=parseFloat(value);if(Prototype.Browser.IE&&!this.element.currentStyle.hasLayout)this.element.setStyle({zoom:1})}else if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=components.length==3?components[2]:null}var originalValue=
this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=="color"?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=="color"?parseColor(value):value,unit:unit}}.bind(this)).reject(function(transform){return transform.originalValue==transform.targetValue||transform.unit!="color"&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))})},update:function(position){var style={},transform,i=this.transforms.length;while(i--)style[(transform=this.transforms[i]).style]=
transform.unit=="color"?"#"+Math.round(transform.originalValue[0]+(transform.targetValue[0]-transform.originalValue[0])*position).toColorPart()+Math.round(transform.originalValue[1]+(transform.targetValue[1]-transform.originalValue[1])*position).toColorPart()+Math.round(transform.originalValue[2]+(transform.targetValue[2]-transform.originalValue[2])*position).toColorPart():(transform.originalValue+(transform.targetValue-transform.originalValue)*position).toFixed(3)+(transform.unit===null?"":transform.unit);
this.element.setStyle(style,true)}});
Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks)},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get("ids"),effect=track.get("effect"),options=track.get("options");
var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options))})}).flatten(),this.options)}});
Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle "+"borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth "+"borderRightColor borderRightStyle borderRightWidth borderSpacing "+"borderTopColor borderTopStyle borderTopWidth bottom clip color "+"fontSize fontWeight height left letterSpacing lineHeight "+"marginBottom marginLeft marginRight marginTop markerOffset maxHeight "+"maxWidth minHeight minWidth opacity outlineColor outlineOffset "+
"outlineWidth paddingBottom paddingLeft paddingRight paddingTop "+"right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit)style=(new Element("div",{style:this})).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(property){if(style[property])styleRules.set(property,style[property])});if(Prototype.Browser.IE&&this.include("opacity"))styleRules.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return styleRules};
if(document.defaultView&&document.defaultView.getComputedStyle)Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles})};else Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results});if(!styles.opacity)styles.opacity=
element.getOpacity();return styles};Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element},visualEffect:function(element,effect,options){element=$(element);var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown "+"pulsate shake puff squish switchOff dropOut").each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(f){Effect.Methods[f]=Element[f]});Element.addMethods(Effect.Methods);
if(typeof Effect=="undefined")throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};
Autocompleter.Base=Class.create({baseInitialize:function(element,update,options){element=$(element);this.element=element;this.update=$(update);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions)this.setOptions(options);else this.options=options||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||
0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(element,update){if(!update.style.position||update.style.position=="absolute"){update.style.position="absolute";Position.clone(element,update,{setHeight:false,offsetTop:element.offsetHeight})}Effect.Appear(update,{duration:0.15})};this.options.onHide=this.options.onHide||function(element,update){new Effect.Fade(update,{duration:0.15})};if(typeof this.options.tokens=="string")this.options.tokens=new Array(this.options.tokens);
if(!this.options.tokens.include("\n"))this.options.tokens.push("\n");this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none")this.options.onShow(this.element,this.update);if(!this.iefix&&Prototype.Browser.IE&&Element.getStyle(this.update,"position")==
"absolute"){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" '+'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix)setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height});this.iefix.style.zIndex=1;this.update.style.zIndex=
2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none")this.options.onHide(this.element,this.update);if(this.iefix)Element.hide(this.iefix)},startIndicator:function(){if(this.options.indicator)Element.show(this.options.indicator)},stopIndicator:function(){if(this.options.indicator)Element.hide(this.options.indicator)},onKeyPress:function(event){if(this.active)switch(event.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();
Event.stop(event);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(event);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(event);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(event);return}else if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&event.keyCode==0)return;this.changed=true;this.hasFocus=true;if(this.observer)clearTimeout(this.observer);this.observer=
setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1E3)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(event){var element=Event.findElement(event,"LI");if(this.index!=element.autocompleteIndex){this.index=element.autocompleteIndex;this.render()}Event.stop(event)},onClick:function(event){var element=Event.findElement(event,"LI");this.index=element.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(event){setTimeout(this.hide.bind(this),
250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var i=0;i<this.entryCount;i++)this.index==i?Element.addClassName(this.getEntry(i),"selected"):Element.removeClassName(this.getEntry(i),"selected");if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0)this.index--;else this.index=this.entryCount-1;this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-
1)this.index++;else this.index=0;this.getEntry(this.index).scrollIntoView(false)},getEntry:function(index){return this.update.firstChild.childNodes[index]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(selectedElement){if(this.options.updateElement){this.options.updateElement(selectedElement);return}var value="";if(this.options.select){var nodes=$(selectedElement).select("."+
this.options.select)||[];if(nodes.length>0)value=Element.collectTextNodes(nodes[0],this.options.select)}else value=Element.collectTextNodesIgnoreClass(selectedElement,"informal");var bounds=this.getTokenBounds();if(bounds[0]!=-1){var newValue=this.element.value.substr(0,bounds[0]);var whitespace=this.element.value.substr(bounds[0]).match(/^\s+/);if(whitespace)newValue+=whitespace[0];this.element.value=newValue+value+this.element.value.substr(bounds[1])}else this.element.value=value;this.oldElementValue=
this.element.value;this.element.focus();if(this.options.afterUpdateElement)this.options.afterUpdateElement(this.element,selectedElement)},updateChoices:function(choices){if(!this.changed&&this.hasFocus){this.update.innerHTML=choices;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var i=0;i<this.entryCount;i++){var entry=this.getEntry(i);entry.autocompleteIndex=
i;this.addObservers(entry)}}else this.entryCount=0;this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else this.render()}},addObservers:function(element){Event.observe(element,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(element,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars)this.getUpdatedChoices();
else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var bounds=this.getTokenBounds();return this.element.value.substring(bounds[0],bounds[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var value=this.element.value;if(value.strip().empty())return[-1,0];var diff=arguments.callee.getFirstDifferencePos(value,this.oldElementValue);var offset=diff==this.oldElementValue.length?1:0;var prevTokenPos=-1,nextTokenPos=value.length;
var tp;for(var index=0,l=this.options.tokens.length;index<l;++index){tp=value.lastIndexOf(this.options.tokens[index],diff+offset-1);if(tp>prevTokenPos)prevTokenPos=tp;tp=value.indexOf(this.options.tokens[index],diff+offset);if(-1!=tp&&tp<nextTokenPos)nextTokenPos=tp}return this.tokenBounds=[prevTokenPos+1,nextTokenPos]}});
Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(newS,oldS){var boundary=Math.min(newS.length,oldS.length);for(var index=0;index<boundary;++index)if(newS[index]!=oldS[index])return index;return boundary};
Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(element,update,url,options){this.baseInitialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=url},getUpdatedChoices:function(){this.startIndicator();var entry=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,
entry):entry;if(this.options.defaultParams)this.options.parameters+="&"+this.options.defaultParams;new Ajax.Request(this.url,this.options)},onComplete:function(request){this.updateChoices(request.responseText)}});
Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(element,update,array,options){this.baseInitialize(element,update,options);this.options.array=array},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(options){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(instance){var ret=[];var partial=[];var entry=instance.getToken();var count=0;for(var i=0;i<instance.options.array.length&&
ret.length<instance.options.choices;i++){var elem=instance.options.array[i];var foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase()):elem.indexOf(entry);while(foundPos!=-1){if(foundPos==0&&elem.length!=entry.length){ret.push("<li><strong>"+elem.substr(0,entry.length)+"</strong>"+elem.substr(entry.length)+"</li>");break}else if(entry.length>=instance.options.partialChars&&instance.options.partialSearch&&foundPos!=-1)if(instance.options.fullSearch||/\s/.test(elem.substr(foundPos-
1,1))){partial.push("<li>"+elem.substr(0,foundPos)+"<strong>"+elem.substr(foundPos,entry.length)+"</strong>"+elem.substr(foundPos+entry.length)+"</li>");break}foundPos=instance.options.ignoreCase?elem.toLowerCase().indexOf(entry.toLowerCase(),foundPos+1):elem.indexOf(entry,foundPos+1)}}if(partial.length)ret=ret.concat(partial.slice(0,instance.options.choices-ret.length));return"<ul>"+ret.join("")+"</ul>"}},options||{})}});
Field.scrollFreeActivate=function(field){setTimeout(function(){Field.activate(field)},1)};
Ajax.InPlaceEditor=Class.create({initialize:function(element,url,options){this.url=url;this.element=element=$(element);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(options);Object.extend(this.options,options||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId))this.options.formId=""}if(this.options.externalControl)this.options.externalControl=$(this.options.externalControl);if(!this.options.externalControl)this.options.externalControlOnly=
false;this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(e){if(!this._editing||
e.ctrlKey||e.altKey||e.shiftKey)return;if(Event.KEY_ESC==e.keyCode)this.handleFormCancellation(e);else if(Event.KEY_RETURN==e.keyCode)this.handleFormSubmission(e)},createControl:function(mode,handler,extraClasses){var control=this.options[mode+"Control"];var text=this.options[mode+"Text"];if("button"==control){var btn=document.createElement("input");btn.type="submit";btn.value=text;btn.className="editor_"+mode+"_button";if("cancel"==mode)btn.onclick=this._boundCancelHandler;this._form.appendChild(btn);
this._controls[mode]=btn}else if("link"==control){var link=document.createElement("a");link.href="#";link.appendChild(document.createTextNode(text));link.onclick="cancel"==mode?this._boundCancelHandler:this._boundSubmitHandler;link.className="editor_"+mode+"_link";if(extraClasses)link.className+=" "+extraClasses;this._form.appendChild(link);this._controls[mode]=link}},createEditField:function(){var text=this.options.loadTextURL?this.options.loadingText:this.getText();var fld;if(1>=this.options.rows&&
!/\r|\n/.test(this.getText())){fld=document.createElement("input");fld.type="text";var size=this.options.size||this.options.cols||0;if(0<size)fld.size=size}else{fld=document.createElement("textarea");fld.rows=1>=this.options.rows?this.options.autoRows:this.options.rows;fld.cols=this.options.cols||40}fld.name=this.options.paramName;fld.value=text;fld.className="editor_field";if(this.options.submitOnBlur)fld.onblur=this._boundSubmitHandler;this._controls.editor=fld;if(this.options.loadTextURL)this.loadExternalText();
this._form.appendChild(this._controls.editor)},createForm:function(){var ipe=this;function addText(mode,condition){var text=ipe.options["text"+mode+"Controls"];if(!text||condition===false)return;ipe._form.appendChild(document.createTextNode(text))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase())this._form.appendChild(document.createElement("br"));
if(this.options.onFormCustomization)this.options.onFormCustomization(this,this._form);addText("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);addText("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");addText("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML)this.element.innerHTML=this._oldInnerHTML;this.leaveEditMode();
this.unregisterListeners()},enterEditMode:function(e){if(this._saving||this._editing)return;this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl)this.options.externalControl.hide();this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL)this.postProcessEditField();if(e)Event.stop(e)},enterHover:function(e){if(this.options.hoverClassName)this.element.addClassName(this.options.hoverClassName);
if(this._saving)return;this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(transport){this.triggerCallback("onFailure",transport);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(e){this.wrapUp();if(e)Event.stop(e)},handleFormSubmission:function(e){var form=this._form;var value=$F(this._controls.editor);this.prepareSubmission();var params=this.options.callback(form,
value)||"";if(Object.isString(params))params=params.toQueryParams();params.editorId=this.element.id;if(this.options.htmlResponse){var options=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,options)}else{var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:params,onComplete:this._boundWrapperHandler,
onFailure:this._boundFailureHandler});new Ajax.Request(this.url,options)}if(e)Event.stop(e)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl)this.options.externalControl.show();this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(e){if(this.options.hoverClassName)this.element.removeClassName(this.options.hoverClassName);
if(this._saving)return;this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._form.removeClassName(this.options.loadingClassName);var text=transport.responseText;if(this.options.stripLoadedTextTags)text=
text.stripTags();this._controls.editor.value=text;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,options)},postProcessEditField:function(){var fpc=this.options.fieldPostCreation;if(fpc)$(this._controls.editor)["focus"==fpc?"focus":"activate"]()},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);
[this._extraDefaultOptions].flatten().compact().each(function(defs){Object.extend(this.options,defs)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var listener;$H(Ajax.InPlaceEditor.Listeners).each(function(pair){listener=this[pair.value].bind(this);this._listeners[pair.key]=listener;if(!this.options.externalControlOnly)this.element.observe(pair.key,listener);if(this.options.externalControl)this.options.externalControl.observe(pair.key,
listener)}.bind(this))},removeForm:function(){if(!this._form)return;this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(cbName,arg){if("function"==typeof this.options[cbName])this.options[cbName](this,arg)},unregisterListeners:function(){$H(this._listeners).each(function(pair){if(!this.options.externalControlOnly)this.element.stopObserving(pair.key,
pair.value);if(this.options.externalControl)this.options.externalControl.stopObserving(pair.key,pair.value)}.bind(this))},wrapUp:function(transport){this.leaveEditMode();this._boundComplete(transport,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});
Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,element,url,options){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(element,url,options)},createEditField:function(){var list=document.createElement("select");list.name=this.options.paramName;list.size=1;this._controls.editor=list;this._collection=this.options.collection||[];if(this.options.loadCollectionURL)this.loadCollection();else this.checkForExternalText();this._form.appendChild(this._controls.editor)},
loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js))throw"Server returned an invalid collection representation.";this._collection=eval(js);
this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(text){this._controls.editor.disabled=true;var tempOption=this._controls.editor.firstChild;if(!tempOption){tempOption=document.createElement("option");tempOption.value="";this._controls.editor.appendChild(tempOption);tempOption.selected=true}tempOption.update((text||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();
if(this.options.loadTextURL)this.loadExternalText();else this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){this._text=transport.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,
options)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(entry){return 2===entry.length?entry:[entry,entry].flatten()});var marker="value"in this.options?this.options.value:this._text;var textFound=this._collection.any(function(entry){return entry[0]==marker}.bind(this));this._controls.editor.update("");var option;this._collection.each(function(entry,index){option=document.createElement("option");option.value=entry[0];
option.selected=textFound?entry[0]==marker:0==index;option.appendChild(document.createTextNode(entry[1]));this._controls.editor.appendChild(option)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});
Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(options){if(!options)return;function fallback(name,expr){if(name in options||expr===undefined)return;options[name]=expr}fallback("cancelControl",options.cancelLink?"link":options.cancelButton?"button":options.cancelLink==options.cancelButton==false?false:undefined);fallback("okControl",options.okLink?"link":options.okButton?"button":options.okLink==options.okButton==false?false:undefined);fallback("highlightColor",options.highlightcolor);
fallback("highlightEndColor",options.highlightendcolor)};
Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",
savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(form){return Form.serialize(form)},onComplete:function(transport,element){new Effect.Highlight(element,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(ipe){ipe.element.style.backgroundColor=ipe.options.highlightColor;if(ipe._effect)ipe._effect.cancel()},onFailure:function(transport,
ipe){alert("Error communication with the server: "+transport.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(ipe){ipe._effect=new Effect.Highlight(ipe.element,{startcolor:ipe.options.highlightColor,endcolor:ipe.options.highlightEndColor,restorecolor:ipe._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});
Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};
Form.Element.DelayedObserver=Class.create({initialize:function(element,delay,callback){this.delay=delay||0.5;this.element=$(element);this.callback=callback;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(event){if(this.lastValue==$F(this.element))return;if(this.timer)clearTimeout(this.timer);this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1E3);this.lastValue=$F(this.element)},
onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});
(function(){var withinElement=function(evt,el){var parent=evt.relatedTarget;while(parent&&parent!=el)try{parent=parent.parentNode}catch(error){parent=el}return parent==el};Object.extend(Event,{mouseEnter:function(element,f,options){element=$(element);var fc=options&&options.enterDelay?function(){window.setTimeout(f,options.enterDelay)}:f;if(Prototype.Browser.IE)element.observe("mouseenter",fc);else{element.hovered=false;element.observe("mouseover",function(evt){if(!element.hovered){element.hovered=
true;fc(evt)}})}},mouseLeave:function(element,f,options){element=$(element);var fc=options&&options.leaveDelay?function(){window.setTimeout(f,options.leaveDelay)}:f;if(Prototype.Browser.IE)element.observe("mouseleave",fc);else element.observe("mouseout",function(evt){var target=Event.element(evt);if(!withinElement(evt,element)){fc(evt);element.hovered=false}})}});Element.addMethods({hover:function(element,mouseEnterFunc,mouseLeaveFunc,options){options=Object.extend({},options)||{};Event.mouseEnter(element,
mouseEnterFunc,options);Event.mouseLeave(element,mouseLeaveFunc,options)}})})();
var PHover=Class.create({initialize:function(hover_div,position_div,options){this.options=Object.extend({top_active_area_px:35,y_offset:0},options||{});this.hover_div=$(hover_div);this.position_div=$(position_div);this.child_divs=new Array;this.child_div_position=new Hash;this.setup();this.t_dim=null;this.t_off=null},setup:function(){this.hover_div.hover(this.hoverHandler.bindAsEventListener(this),function(){})},mouseHandler:function(evt){if(this.t_dim&&this.t_off){var x=Event.pointerX(evt);var y=
Event.pointerY(evt);if(x>this.t_off.left&&x<this.t_off.left+this.t_dim.width&&y>this.t_off.top-this.options.top_active_area_px&&y<this.t_off.top+this.t_dim.height);else this.unhoverHandler()}},show:function(){this.hoverHandler()},hoverHandler:function(){document.observe("mousemove",this.mouseHandler.bindAsEventListener(this));var dim=this.t_dim=this.hover_div.getDimensions();var off=this.t_off=this.hover_div.cumulativeOffset();var pos_dim=this.position_div.getDimensions();var pos_off=this.position_div.cumulativeOffset();
this.child_divs.each(function(div){this.position_child_div(pos_dim,pos_off,div);div.show()}.bind(this))},position_child_div:function(pos_dim,pos_off,div){var new_div_style={position:"absolute",top:pos_off.top-div.getHeight()+this.options.y_offset+"px"};if(this.child_div_position.get(div.getAttribute("id"))=="topright")new_div_style.left=pos_off.left+pos_dim.width-div.getWidth()+"px";else new_div_style.left=pos_off.left+"px";div.setStyle(new_div_style)},reposition:function(child_div){var pos_dim=this.position_div.getDimensions();
var pos_off=this.position_div.cumulativeOffset();this.position_child_div(pos_dim,pos_off,$(child_div))},unhoverHandler:function(){document.stopObserving("mousemove",this.mouseHandler.bindAsEventListener(this));this.t_dim=null;this.t_off=null;this.child_divs.each(function(div){if(!div.hasClassName("phover_donothide"))div.hide()})},addChildDiv:function(child_div,position){this.child_divs.push($(child_div));this.child_div_position.set($(child_div).id,position);$(child_div).hide()}});
PHover.created_hovers=new Hash;PHover.factory_create=function(hover_div,position_div,options){if(!$(hover_div))return;var existing=PHover.created_hovers.get($(hover_div).getAttribute("id"));if(existing)return existing;else{var new_phover=new PHover(hover_div,position_div,options);PHover.created_hovers.set($(hover_div).getAttribute("id"),new_phover);return new_phover}};
if(typeof PSlideGallery2=="undefined"){Prototype.Browser.IE6=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6;Prototype.Browser.IE7=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7;Prototype.Browser.IE8=Prototype.Browser.IE&&!Prototype.Browser.IE6&&!Prototype.Browser.IE7;var pgallery_stopclick=function(e){Event.stop(e)};var themeWidth=$$('meta[name="width"]').first()?parseInt($$('meta[name="width"]').first().readAttribute("content")):
500;var loadingDiv=new Element("div",{style:"width: "+themeWidth+"px; padding-top: 158px; padding-bottom: 159px;text-align: center; border: 1px solid #aaa;"});var loadingImage=new Image;loadingImage.src="/images/loading.gif";loadingImage.width=16;loadingImage.height=16;Element.extend(loadingImage).setAttribute("id","mainImage");Element.extend(loadingImage).setAttribute("style","border: none;");loadingDiv.appendChild(loadingImage);var PImage2=Class.create({initialize:function(init_data){Object.extend(this,
init_data);if(!this.thumb){this.thumb="/images/spacer.gif";this.thumbWidth=36;this.thumbHeight=36}this.imageObj=Element.extend(new Image);this.imageObj.observe("load",this.imageLoaded.bindAsEventListener(this));this.imageObj.src=this.main;if(this.width)this.imageObj.width=this.width;if(this.height)this.imageObj.height=this.height;this.loaded=false;Element.extend(this.imageObj).setAttribute("id","mainImage")},imageLoaded:function(){this.loaded=true;if(this.loadCallback!=null){this.loadCallback(this.imageObj,
this.loadCallback_meref);this.loadCallback=null}},getMainImage:function(callback,callingObj){if(this.loaded==true)callback(this.imageObj,callingObj);else{callback(loadingDiv,callingObj);this.loadCallback=callback;this.loadCallback_meref=callingObj}}});var PSlideGallery2=Class.create({initialize:function(galleryDiv,urls,options){this.galleryDiv=$(galleryDiv);this.zipFile=options["zipFile"];this.zipFileSize=options["zipFileSize"];this.showDownload=options["showDownload"];this.externalUrl=options["external_url"];
if($$(".posterous_site_data").length>0){this.show_type=$$(".posterous_site_data")[0].readAttribute("data-show-type");this.site_type=$$(".posterous_site_data")[0].readAttribute("data-site-type");this.site_id=$$(".posterous_site_data")[0].readAttribute("data-site-id");this.user_id=$$(".posterous_site_data")[0].readAttribute("data-user-id");this.post_id=$$(".posterous_site_data")[0].readAttribute("data-post-id")}else{this.show_type=document.body.readAttribute("data-show-type")||document.body.readAttribute("data-show_type")||
window.show_type;this.site_type=document.body.readAttribute("data-site-type")||document.body.readAttribute("data-site_type")||window.site_type;this.site_id=document.body.readAttribute("data-site-id")||document.body.readAttribute("data-site_id")||window.site_id;this.user_id=document.body.readAttribute("data-user-id")||document.body.readAttribute("data-admin_id")||window.user_id;this.post_id=document.body.readAttribute("data-post-id")||window.post_id}if(this.site_type=="group"){thread_div=this.galleryDiv.up(".thread");
if(thread_div){thread_slug=thread_div.readAttribute("data-slug");thread_id=thread_div.readAttribute("data-site-id");this.url_slug=thread_slug;this.thread_id=$$("article.post")[0].readAttribute("data-id");var reply_ids=[];$$("article.reply").each(function(reply){if(reply.readAttribute("data-parent_id"))reply_ids.push(reply.readAttribute("data-id"))});this.reply_ids=reply_ids}else{this.url_slug="";this.thread_id=0;this.reply_ids=[]}}else{post_div=this.galleryDiv.up(".post");if(post_div!=undefined)post_title_div=
post_div.down(".post-title");else post_title_div=undefined;if(post_title_div!=undefined)post_link_div=post_title_div.down("a");else post_link_div=undefined;if(post_link_div!=undefined){post_link=post_link_div.href;regex=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)\/(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;if(post_link.match(regex)&&post_link.match(/private/))this.url_slug=post_link.replace(regex,"private/$4");else if(post_link.match(regex))this.url_slug=post_link.replace(regex,"$4")}}this.imageList=
new Array;$A(urls).each(function(image_url){this.imageList.push(new PImage2(image_url))}.bind(this));this.idx=0;if(this.imageList.length==1&&this.imageList[0].largeWidth<=themeWidth&&!this.externalUrl)return;this.galleryDiv.update("");this.generateGallery();document.observe("keyup",this.handleKeyboard.bindAsEventListener(this))},generateGallery:function(){if(this.imageList.length>1){var controlDiv=new Element("div",{style:"margin-bottom: 3px;","class":"posterousGalleryNavigationDiv"});var leftLink=
new Element("a",{href:"#",onclick:"return false;",style:"vertical-align: middle;"});var leftArrow="<img src='/images/arrowleft.gif' border='0'>";leftLink.update(leftArrow);controlDiv.appendChild(leftLink);var spacer=document.createTextNode(" ");controlDiv.appendChild(spacer);var rightLink=new Element("a",{href:"#",onclick:"return false;",style:"vertical-align: middle;"});var rightArrow="<img src='/images/arrowright.gif' border='0'>";rightLink.update(rightArrow);controlDiv.appendChild(rightLink);this.labelSpan=
new Element("span");this.labelSpan.addClassName("galleryLabel");this.labelSpan.update("1 of "+this.imageList.length);controlDiv.appendChild(this.labelSpan);this.registerPrev(leftLink);this.registerNext(rightLink);this.galleryDiv.appendChild(controlDiv);var thumbDiv=new Element("div",{style:"margin-bottom: 2px","class":"posterousGalleryThumbnailsDiv"});this.galleryDiv.appendChild(thumbDiv);for(var i=0;i<this.imageList.length;i++){var img=this.imageList[i];if(img==null)continue;var thumbLink=new Element("a",
{href:"#",onClick:"return false;",style:"margin-right: 5px !important;"});var thumbImg=new Element("img",{src:img.thumb,width:img.thumbWidth,height:img.thumbWidth});thumbLink.appendChild(thumbImg);thumbDiv.appendChild(thumbLink);img.thumbLink=thumbLink;this.registerThumb(i,thumbLink);if(i==0)thumbLink.addClassName("gallerySelectedImage")}}this.mainLink=new Element("a",{href:"#",onClick:"return false;"});this.mainLink.addClassName("posterousGalleryMainlink");this.mainImage=this.imageList[this.idx].imageObj;
this.mainLink.appendChild(this.mainImage);this.galleryDiv.appendChild(this.mainLink);this.setupCommandPanel();this.registerMainImage(this.mainImage);this.resizeShowBar()},setupCommandPanel:function(){if(this.commandSpan==null){this.commandSpan=new Element("span");this.commandSpan.addClassName("show");var div1=new Element("div",{style:"color: #fff; font-size: 14px;",id:this.galleryDiv.id+"-click"});div1.update(this.externalUrl?"Click to view link":"Click to view large");div1.update(this.externalUrl?
"Click to view link":"<a href='#' style='color:#fff' onclick='return false'>Click to view large</a>");if(this.imageList[this.idx].originalSize){var div2=new Element("div",{style:"font-size: 14px;",id:this.galleryDiv.id+"-dl1"});div2.addClassName("posterousGalleryLink");div2.update("Download full size ("+this.imageList[this.idx].originalSize+" KB)")}var div3=new Element("div",{style:"font-size: 14px;",id:this.galleryDiv.id+"-dl2"});div3.addClassName("posterousGalleryLink");div3.update("Download this gallery (ZIP, "+
this.zipFileSize+" KB)");var div4=new Element("div",{style:"font-size:14px;position:absolute;right:10px;bottom:0px;",id:this.galleryDiv.id+"-dl3"});if(this.url_slug!=undefined)if(Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6)div4.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' title='Click to view in full screen' />");else div4.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' data-posterous-tooltip='Click to view in full screen' />");
else if(Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6)div4.update("<a href='#' onclick='return false' class='view_slideshow' title='Click to view in full screen' />");else div4.update("<a href='#' onclick='return false' class='view_slideshow' data-posterous-tooltip='Click to view in full screen' />");this.commandDiv2=div2;this.commandDiv3=div3;this.commandDiv4=div4;this.commandSpan.appendChild(div4);if(this.showDownload){if(div3){this.commandSpan.appendChild(div3);div3.observe("click",
this.clickDownloadGallery.bindAsEventListener(this))}if(div2){this.commandSpan.appendChild(div2);div2.observe("click",this.clickDownloadFull.bindAsEventListener(this))}}div4.observe("click",this.handlePostSlideshow.bindAsEventListener(this));this.mainLink.appendChild(this.commandSpan)}var isSmall=this.imageList[this.idx].largeWidth<=themeWidth&&this.imageList[this.idx].largeHeight<=themeWidth&&!this.externalUrl;var hasZipFile=this.zipFile!=null;if(!isSmall){if(div2)this.commandDiv2.show();if(div4)this.commandDiv4.show()}else if(div2)this.commandDiv2.hide();
if(hasZipFile){if(div3)this.commandDiv3.show();if(div4)this.commandDiv4.show()}else if(div3)this.commandDiv3.hide();if(!this.showDownload)if(!isSmall)this.commandSpan.addClassName("show");var commandspan=this.commandSpan},resizeShowBar:function(){$$("span.show").each(function(bar){var glyph_div=bar.down(".view_slideshow").up();var dl_fullsize=glyph_div.next();var dl_gallery=glyph_div.next(1);if(glyph_div){if(dl_fullsize&&dl_fullsize.getStyle("display")=="none"&&dl_gallery&&dl_gallery.getStyle("display")==
"none"||bar.childElements().length<=1)if(Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6)bar.writeAttribute({style:"background-color:transparent"});else bar.setStyle({"background-color":"transparent"});if(dl_fullsize&&dl_fullsize.getStyle("display")!="none"&&dl_gallery&&dl_gallery.getStyle("display")!="none"&&bar.childElements().length>1)if(Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6)glyph_div.writeAttribute({bottom:"8px"});else glyph_div.setStyle({bottom:"8px"})}})},
clickDownloadFull:function(){window.open(this.imageList[this.idx].original)},clickDownloadGallery:function(){window.open(this.zipFile)},registerThumb:function(idx,thumbLink){thumbLink.observe("mousedown",this.handleThumbClick.bindAsEventListener(this,idx));Event.observe(thumbLink,"click",pgallery_stopclick,false)},handleThumbClick:function(){var clickedIdx=$A(arguments)[1];this.setIndex(clickedIdx)},getCurrentPImage:function(){return this.imageList[this.idx]},registerMainImage:function(mainImage){this.mainImage.observe("mousedown",
this.handleClick.bindAsEventListener(this))},unregisterMainImage:function(mainImage){this.mainImage.stopObserving("mousedown",this.handleClick.bindAsEventListener(this))},handleClick:function(evt){Event.stop(evt);if(this.externalUrl)document.location.href=this.externalUrl;else this.setupLargeImage()},handlePostSlideshow:function(){if($$(".posterous_site_data").length>0){this.show_type=$$(".posterous_site_data")[0].readAttribute("data-show-type");this.site_type=$$(".posterous_site_data")[0].readAttribute("data-site-type");
this.site_id=$$(".posterous_site_data")[0].readAttribute("data-site-id");this.user_id=$$(".posterous_site_data")[0].readAttribute("data-user-id");this.post_id=$$(".posterous_site_data")[0].readAttribute("data-post-id")}else{this.show_type=document.body.readAttribute("data-show-type")||document.body.readAttribute("data-show_type")||window.show_type;this.site_type=document.body.readAttribute("data-site-type")||document.body.readAttribute("data-site_type")||window.site_type;this.site_id=document.body.readAttribute("data-site-id")||
document.body.readAttribute("data-site_id")||window.site_id;this.user_id=document.body.readAttribute("data-user-id")||document.body.readAttribute("data-admin_id")||window.user_id;this.post_id=document.body.readAttribute("data-post-id")||window.post_id}var current=this.getCurrentPImage();var image_list=[];if(this.site_type!="group"){var post_inner=this.galleryDiv.up(".inner")||this.galleryDiv.up(".copy")||this.galleryDiv.up(".post")||this.galleryDiv.up(".content")||this.galleryDiv.up(".post_body")||
this.galleryDiv.up(".bodytext")||this.galleryDiv.up(".regular");var main_gallery_list=this.galleryDiv.readAttribute("data-posterous-file-list");image_list.push(current);post_inner.childElements().each(function(child){if(child.hasClassName("posterousGalleryMainDiv")){var images=child.readAttribute("data-posterous-file-list");var images_json=unescape(images).evalJSON();for(var index=0,len=images_json.length;index<len;++index){var image=images_json[index];if(image.large!=current.large)image_list.push(image)}}})}if(this.externalUrl)document.location.href=
this.externalUrl;else if(this.site_type!="group"&&this.site_type!="application"&&(this.show_type=="site"||this.show_type=="post")){if(image_list.flatten().length<=1)slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:this.post_id,site_id:this.site_id,user_id:this.user_id,image_list:image_list.flatten(),current_image:current,slug:this.url_slug,autoplay:false});else slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:this.post_id,site_id:this.site_id,
user_id:this.user_id,image_list:image_list.flatten(),current_image:current,slug:this.url_slug,autoplay:true});if(this.post_id)slideshow.setLocation("#!/slideshow");else if(this.url_slug&&this.post_id==undefined)slideshow.setLocation("#!/"+this.url_slug+"/slideshow")}else if(this.site_type=="application"){post_div=this.galleryDiv.up(".articlePost");post_id=post_div.readAttribute("data-id");site_id=post_div.readAttribute("data-site");user_id=post_div.readAttribute("data-user");slug=post_div.readAttribute("data-slug");
if(image_list.flatten().length<=1)slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:post_id,site_id:site_id,user_id:user_id,image_list:image_list.flatten(),current_image:current,slug:slug,autoplay:false});else slides=new startSlideshow({show_type:"post",site_type:this.site_type,post_id:post_id,site_id:site_id,user_id:user_id,image_list:image_list.flatten(),current_image:current,slug:slug,autoplay:true})}else{if(this.imageList.length<=1)slides=new startSlideshow({show_type:"thread",
site_type:this.site_type,thread_id:this.thread_id,reply_ids:this.reply_ids,slug:this.url_slug,site_id:this.site_id,user_id:this.user_id,image_list:this.imageList,current_image:current,autoplay:false});else slides=new startSlideshow({show_type:"thread",site_type:this.site_type,thread_id:this.thread_id,reply_ids:this.reply_ids,slug:this.url_slug,site_id:this.site_id,user_id:this.user_id,image_list:this.imageList,current_image:current,autoplay:true});if(this.url_slug&&this.thread_id)slideshow.setLocation("#!/"+
this.url_slug+"/slideshow");else if(this.url_slug&&this.thread_id==undefined)slideshow.setLocation("#!/"+this.url_slug+"/slideshow")}},setupLargeImage:function(){var current=this.getCurrentPImage();if(current.large!=null)var modal=Control.Modal.open("<a href='#' onClick='Control.Modal.close();return false;'><img src='"+current.large+"'"+" width='"+current.largeWidth+"'"+" height='"+current.largeHeight+"'"+"id='posterousGalleryExpandedImg_"+this.galleryDiv.id+"'></a>",{opacity:0.6,width:parseInt(current.largeWidth),
height:parseInt(current.largeHeight)});this.setupSlideshowGlyph()},setupSlideshowGlyph:function(){var slideshow_glyph=new Element("div",{style:"font-size: 14px;position:absolute;right:30px;bottom:15px;",id:this.galleryDiv.id+"-dl3"});var modal_div=$("modal_container");var gallery_id=this.galleryDiv.id;if(this.url_slug!=undefined)if(Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6)slideshow_glyph.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' id='"+
this.galleryDiv.id+"-slideshow' style='display:none;' title='Click to view in full screen' />");else slideshow_glyph.update("<a href='#!/"+this.url_slug+"/slideshow' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' data-posterous-tooltip='Click to view in full screen' />");else if(Prototype.Browser.IE8||Prototype.Browser.IE7||Prototype.Browser.IE6)slideshow_glyph.update("<a href='#' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+
"-slideshow' style='display:none;' title='Click to view in full screen' />");else slideshow_glyph.update("<a href='#' onclick='return false' class='view_slideshow' id='"+this.galleryDiv.id+"-slideshow' style='display:none;' data-posterous-tooltip='Click to view in full screen' />");modal_div.appendChild(slideshow_glyph);slideshow_glyph.observe("click",this.handlePostSlideshow.bindAsEventListener(this));modal_div.observe("mouseover",function(){if($(""+gallery_id+"-slideshow")!=null)$(""+gallery_id+
"-slideshow").show()});modal_div.observe("mouseout",function(){if($(""+gallery_id+"-slideshow")!=null)$(""+gallery_id+"-slideshow").hide()})},registerPrev:function(prevLink){prevLink.observe("mousedown",this.prevButtonClick.bindAsEventListener(this));Event.observe(prevLink,"click",pgallery_stopclick,false)},isVisibleInViewport:function(){var topOffset=$(this.galleryDiv).viewportOffset().top;return topOffset>=-200&&topOffset<=document.viewport.getHeight()-200},handleKeyboard:function(evt){if(!this.isVisibleInViewport())return;
var key=evt.charCode||evt.keyCode;if(key==37)this.prev();else if(key==39)this.next()},prevButtonClick:function(){this.prev()},prev:function(){if(this.idx==0)this.setIndex(this.imageList.length-1);else this.setIndex(this.idx-1)},registerNext:function(nextLink){nextLink.observe("mousedown",this.nextButtonClick.bindAsEventListener(this));Event.observe(nextLink,"click",pgallery_stopclick,false)},nextButtonClick:function(){this.next()},next:function(){if(this.idx==this.imageList.length-1)this.setIndex(0);
else this.setIndex(this.idx+1)},setIndex:function(nextIndex){if(this.imageList[nextIndex].thumb!=null||this.imageList[this.idx].thumbLink!=null){this.imageList[this.idx].thumbLink.removeClassName("gallerySelectedImage");this.imageList[nextIndex].thumbLink.addClassName("gallerySelectedImage")}this.idx=nextIndex;this.labelSpan.update(this.idx+1+" of "+this.imageList.length);this.imageList[this.idx].getMainImage(this.setMainImage,this);if(Control.Modal.current&&$("posterousGalleryExpandedImg_"+this.galleryDiv.id))this.setupLargeImage()},
setMainImage:function(nextImage,me){if(me==null)me=this;if(nextImage==null)return;me.unregisterMainImage(me.mainImage);$(me.mainImage).replace(nextImage);me.mainImage=nextImage;me.registerMainImage(me.mainImage);me.setupCommandPanel()}})}
if(PWidgets==null){var themeWidth=$$('meta[name="width"]').first()?parseInt($$('meta[name="width"]').first().readAttribute("content")):500;var PWidgets="loaded";Event.observe(window,"load",function(){var items=$$(".post img, div.body div.inner img");for(var i=0;i<items.length;i++){var img=items[i];if(img.width>themeWidth)new PosterousLargeExternal(img)}});var PosterousLargeExternal=Class.create({initialize:function(element){this.element=element;this.oldWidth=element.width;this.oldHeight=element.height;
element.observe("click",this.handleClick.bindAsEventListener(this));var newdim=posterous_resize_image(element.width,element.height,themeWidth);if(newdim!=null){element.width=newdim[0];element.height=newdim[1]}element.addClassName("pointer_cursor")},handleClick:function(){var modal=Control.Modal.open("<a href='#' onClick='Control.Modal.close();return false;'>"+"<img src='"+this.element.src+"'"+" width='"+this.oldWidth+"'"+" height='"+this.oldHeight+"'"+"></a>",{opacity:0.6})}});function posterous_resize_image(width,
height,maxWidth){if(width>maxWidth)return[maxWidth,maxWidth*height/width];else return null}var pw_stopclick=function(e){Event.stop(e)}}if(typeof deconcept=="undefined")var deconcept=new Object;if(typeof deconcept.util=="undefined")deconcept.util=new Object;if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil=new Object;
deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById)return;this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object;this.variables=new Object;this.attributes=new Array;if(_1)this.setAttribute("swf",_1);if(id)this.setAttribute("id",id);if(w)this.setAttribute("width",w);if(h)this.setAttribute("height",h);if(_5)this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));this.installedVer=
deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7)deconcept.SWFObject.doPrepUnload=true;if(c)this.addParam("bgcolor",c);var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=_8?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9)this.setAttribute("redirectUrl",_9)};
deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true)},setAttribute:function(_e,_f){this.attributes[_e]=_f},getAttribute:function(_10){return this.attributes[_10]},addParam:function(_11,_12){this.params[_11]=_12},getParams:function(){return this.params},addVariable:function(_13,_14){this.variables[_13]=_14},getVariable:function(_15){return this.variables[_15]},getVariables:function(){return this.variables},
getVariablePairs:function(){var _16=new Array;var key;var _18=this.getVariables();for(key in _18)_16[_16.length]=key+"="+_18[key];return _16},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}_19='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+
this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';_19+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var _1a=this.getParams();for(var key in _1a)_19+=[key]+'="'+_1a[key]+'" ';var _1c=this.getVariablePairs().join("&");if(_1c.length>0)_19+='flashvars="'+_1c+'"';_19+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}_19='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+
this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';_19+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var _1d=this.getParams();for(var key in _1d)_19+='<param name="'+key+'" value="'+_1d[key]+'" />';var _1f=this.getVariablePairs().join("&");if(_1f.length>0)_19+='<param name="flashvars" value="'+_1f+'" />';_19+="</object>"}return _19},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,
0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=typeof _20=="string"?
document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true}else if(this.getAttribute("redirectUrl")!="")document.location.replace(this.getAttribute("redirectUrl"));return false}};
deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description)_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo)try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);
_23=new deconcept.PlayerVersion([_26,0,0])}catch(e){axo=null}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(_23.major==6)return _23}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null)_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}return _23};
deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major)return false;if(this.major>fv.major)return true;if(this.minor<fv.minor)return false;if(this.minor>fv.minor)return true;if(this.rev<fv.rev)return false;return true};
deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null)return q;if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++)if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b)return _2d[i].substring(_2d[i].indexOf("=")+1)}return""}};
deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i])if(typeof _2f[i][x]=="function")_2f[i][x]=function(){}}};
if(deconcept.SWFObject.doPrepUnload)if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}if(!document.getElementById&&document.all)document.getElementById=function(id){return document.all[id]};var getQueryParamValue=deconcept.util.getRequestParameter;
var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;
var PFavorite=Class.create({initialize:function(hoverContainer,positionContainer,postid,isFaved,options){this.options=Object.extend({y_offset:20},options||{});this.hoverContainer=$(hoverContainer);this.positionContainer=$(positionContainer);this.postid=postid;this.isFaved=isFaved;this.mouseoverHandler=this.mouseoverHandler_delegate.bindAsEventListener(this);this.mouseoutHandler=this.mouseoutHandler_delegate.bindAsEventListener(this);this.clickHandler=this.clickHandler_delegate.bindAsEventListener(this);
this.isLoading=false;this.createFavPanel();this.tooltip=PHover.factory_create(hoverContainer,positionContainer,this.options);this.tooltip.addChildDiv(this.favpanel,"topright");this.favpanel.observe("mouseover",this.mouseoverHandler);this.favpanel.observe("mouseout",this.mouseoutHandler);this.favpanel.observe("click",this.clickHandler)},createFavPanel:function(){this.favpanel=new Element("div",{id:"favpanel_"+this.postid,style:"display:none;"});this.favpanel.addClassName("fav_star");this.favpanel.addClassName("posterous_favorite");
document.body.appendChild(this.favpanel);this.messageDiv=new Element("span",{style:"display:none;"});this.favpanel.appendChild(this.messageDiv);this.favImg=new Element("img",{src:"/images/icons/star.png",width:16,height:16});this.favpanel.appendChild(this.favImg);this.updateView()},mouseoverHandler_delegate:function(evt){if(!this.isLoading){this.messageDiv.show();this.favpanel.addClassName("fav_mouseover")}this.resetFavpanelPosition()},mouseoutHandler_delegate:function(evt){if(!this.isLoading){this.messageDiv.hide();
this.favpanel.removeClassName("fav_mouseover")}this.resetFavpanelPosition()},updateMessage:function(){if(this.isLoading)this.messageDiv.innerHTML="Saving...";else if(this.isFaved)this.messageDiv.innerHTML="Unfavorite this";else this.messageDiv.innerHTML="Favorite this"},updateIcon:function(){if(this.isLoading)this.favImg.src="/images/loading.gif";else if(this.isFaved)this.favImg.src="/images/icons/star.png";else this.favImg.src="/images/icons/star-hover.png"},updateView:function(){this.updateMessage();
this.updateIcon()},clickHandler_delegate:function(evt){this.isLoading=true;this.messageDiv.show();this.updateView();this.favpanel.addClassName("phover_donothide");var me=this;new Ajax.Updater(this.messageDiv,"/reader/favorite",{parameters:{id:this.postid,add:!me.isFaved,authenticity_token:window._token},onLoading:function(){me.resetFavpanelPosition()},onComplete:function(){me.isFaved=!me.isFaved;me.isLoading=false;me.updateIcon();me.resetFavpanelPosition()}})},resetFavpanelPosition:function(){this.tooltip.reposition(this.favpanel.getAttribute("id"))}});
var PComment=Class.create({initialize:function(commentLink,postId,container){this.container=$(container);this.postId=postId;this.commentLink=$(commentLink);this.linkClickHandler=this.linkClick_delegate.bindAsEventListener(this);this.commentLink.observe("click",this.linkClickHandler)},linkClick_delegate:function(evt){$(this.commentLink.parentNode).hide();if(this.commentDiv==null)this.createCommentDiv();else Effect.SlideDown(this.outerDiv,{duration:0.5});Event.stop(evt);return false},hideCommentDiv:function(){Effect.SlideUp(this.outerDiv);
Effect.SlideDown($(this.commentLink.parentNode))},createCommentDiv:function(){this.outerDiv=new Element("div",{"class":"posterous_comments_wrapper",style:"display: none"});this.commentDiv=new Element("div");this.commentDiv.addClassName("posterous_comments");this.loadingDiv=new Element("div",{style:"display: none;"});this.loadingDiv.addClassName("comment_loading_div");this.loadingImg=new Element("img",{src:"/images/loading.gif"});this.loadingDiv.appendChild(this.loadingImg);this.container.appendChild(this.loadingDiv);
this.outerDiv.appendChild(this.commentDiv);this.container.appendChild(this.outerDiv);this.loadingDiv.show();new Ajax.Updater(this.commentDiv,"/posts/getcomments",{parameters:{id:this.postId,authenticity_token:window._token},evalScripts:true,onLoading:function(){},onComplete:function(){Effect.SlideDown(this.outerDiv,{duration:0.5,afterFinish:function(){p.initializeCommentForm(null,this.commentDiv.down('[data-posterous-comment-form="true"]').id)}.bind(this)});this.loadingDiv.hide();FB.XFBML.parse()}.bind(this)})}});
var PTwitterComment=Class.create({initialize:function(twitterCheckbox,commentBox,twitterBox,twitterDiv,twitterUsername,twitterShorturl,showLink){this.twitterCheckbox=$(twitterCheckbox);this.commentBox=$(commentBox);this.twitterBox=$(twitterBox);this.twitterDiv=$(twitterDiv);this.twitterUsername=twitterUsername;this.twitterShorturl=twitterShorturl;this.linkOutput=true;this.showLink=showLink;this.setup();this.updateAll()},updateAll:function(){this.updateTwitterBox();this.updateCheckbox()},setup:function(){this.twitterCheckbox.observe("click",
this.updateCheckbox.bindAsEventListener(this));this.twitterBox.observe("change",function(){this.linkOutput=false}.bindAsEventListener(this));this.twitterBox.observe("keyup",this.updateTwitterCount.bindAsEventListener(this));this.commentBox.observe("keyup",this.updateTwitterBox.bindAsEventListener(this));this.numLeft=new Element("div",{style:"font-size: 10px; color: #090; line-height: 12px;"});this.twitterDiv.appendChild(this.numLeft);this.twitterBoxExpander=new Texpand(this.twitterBox)},getCommentBoxValue:function(){return this.commentBox.value.gsub(/\n/,
"")},specialTruncate:function(value,len){if(value.length>len){value=value.substring(0,len-3).replace(/[ \.]\w+$/,"");value+="..."}return value},updateTwitterBox:function(){if(!this.linkOutput)return;var prefix=this.twitterUsername?this.twitterUsername+" ":"";var suffix=this.twitterShorturl?" "+this.twitterShorturl:"";var remaining=140-prefix.length;var commentBoxValue=this.getCommentBoxValue();if(remaining>=commentBoxValue.length&&this.twitterUsername&&!this.showLink)this.twitterBox.value=prefix+
commentBoxValue;else if(commentBoxValue.length>0)this.twitterBox.value=prefix+this.specialTruncate(commentBoxValue,remaining-suffix.length)+suffix;this.updateTwitterCount();this.twitterBoxExpander._autoExpand()},updateTwitterCount:function(){var remaining=140-this.twitterBox.value.length;if(remaining>=0)this.numLeft.innerHTML=remaining+" characters left";else this.numLeft.innerHTML=-1*remaining+" characters over the 140 character limit"},updateCheckbox:function(){this.twitterCheckbox.checked?this.twitterDiv.show():
this.twitterDiv.hide()}});var Texpand=Class.create();
Texpand.prototype={initialize:function(el){var obj=this;this.element=$(el);this.increment=14;if(this.element.tagName.toLowerCase()!="textarea")throw"Texpand: can only be initialized with a <textarea> but got <"+this.element.tagName.toLowerCase()+">";if(typeof Prototype=="undefined"||parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.6)throw"Texpand: requires Prototype 1.6.0+";if(typeof Effect=="undefined")throw"Textpand: requires Script.aculo.us, specifically Effects";this.element.insert({after:'<div id="texpand-mimic-'+
this.element.identify()+'"></div>'});this.mimic=this.element.next();this.mimic.update(this.element.value);if(Prototype.Browser.IE){var fontSize=this.element.getStyle("fontSize");if(fontSize.search(/em/)>=0){var pixelSize=parseFloat(fontSize.replace(/em/,""))*10;this.element.setStyle({fontSize:pixelSize+"px"})}}var style={};var properties=$w("borderBottomColor borderBottomStyle borderBottomWidth borderTopColor borderTopStyle borderTopWidth borderRightColor borderRightStyle borderRightWidth borderLeftColor borderLeftStyle borderLeftWidth fontSize fontFamily fontWeight letterSpacing lineHeight marginTop marginRight marginBottom marginLeft paddingTop paddingRight paddingBottom paddingLeft textAlign textIndent width wordSpacing");
properties.each(function(property){style[property]=obj.element.getStyle(property)});this.mimic.setStyle(style);this.mimic.setStyle({display:"none",position:"absolute",left:"-9999px",top:"-9999px"});this.element.observe("keyup",obj._autoExpand.bind(obj));this._autoExpand(null);return this.element},_autoExpand:function(ev){this.mimic.update(this.element.value.replace(/\n/gm,"<br />"));var mimicCurrentHeight=this.mimic.getHeight();var elementCurrentHeight=this.element.getHeight();var differenceHeight=
elementCurrentHeight-mimicCurrentHeight;var targetHeight=elementCurrentHeight+(this.increment-differenceHeight);if(differenceHeight<this.increment){var queue=Effect.Queues.get("texpand"+this.element.identify());queue.each(function(effect){effect.cancel()});this.element.morph("height: "+targetHeight+"px;",{duration:0.1,queue:{position:"end",scope:"texpand"+this.element.identify(),limit:2}})}}};
var PosterousHeader=Class.create({initialize:function(headerDiv,options){this.options=Object.extend({imgClear:"/images/header/default-clear-right.png",imgColored:"/images/header/yellow-arrow.png",imgArrow:"/images/header/yellow-arrow.png",imgExpanded:"/images/header/yellow-expanded.png",imgClearLeft:"/images/header/default-clear-left.png",imgColoredLeft:"/images/header/yellow-arrow-left.png",imgArrowLeft:"/images/header/yellow-arrow-left.png",imgExpandedLeft:"/images/header/yellow-expanded-left.png",
clearDefault:true,top_active_area_px:25,hide_offset_px:25,direction:"right"},options||{});this.headerDiv=$(headerDiv);this.viewstate="";this.setup();this.observeSubscriptionButtons()},observeSubscriptionButtons:function(){var unsubscribeButton=$("posterous_bar_unsubscribe");var subscribeButton=$("posterous_bar_subscribe");var loadingImage=$("posterous_loading_image");if(unsubscribeButton&&subscribeButton){unsubscribeButton.observe("click",function(e){e.stop();if(confirm("Are you sure you want to unsubscribe from this posterous?"))this.performSubscriptionAction(unsubscribeButton,
subscribeButton,loadingImage)}.bindAsEventListener(this));subscribeButton.observe("click",function(e){e.stop();this.performSubscriptionAction(subscribeButton,unsubscribeButton,loadingImage)}.bindAsEventListener(this))}},performSubscriptionAction:function(actionButton,secondaryButton,loadingImage){action=actionButton.readAttribute("data-action");siteId=actionButton.readAttribute("data-site_id");method=action=="addsub"?"post":"delete";new Ajax.Request("/members",{method:method,parameters:{authenticity_token:window._token,
site_id:siteId},onLoading:function(){loadingImage.show();actionButton.hide()},onSuccess:function(){secondaryButton.show()},onComplete:function(){loadingImage.hide()}})},setup:function(){if($("posterousbar_nojs"))$("posterousbar_nojs").hide();if(this.options.clearDefault){var bgcolor=this.getParentBackgroundColor(this.headerDiv.up());if(this.getColorSum(bgcolor)>384)this.headerDiv.addClassName("posterousHeaderLight");else this.headerDiv.addClassName("posterousHeaderDark")}else this.headerDiv.addClassName("posterousHeaderLight");
if(this.options.direction=="left")this.headerDiv.addClassName("posterousHeaderLeft");this.headerDiv.addClassName("posterousHeader");var contents=this.headerDiv.innerHTML;this.headerDiv.innerHTML="";if(this.options.direction=="right"){this.defaultImg=(new Element("img",{src:this.options.clearDefault?this.options.imgClear:this.options.imgColored})).addClassName("posterousHeaderImageRight");this.defaultArrowImg=(new Element("img",{src:this.options.imgArrow,style:"display: none;"})).addClassName("posterousHeaderImageRight");
this.defaultExpandedImg=(new Element("img",{src:this.options.imgExpanded,style:"display: none;"})).addClassName("posterousHeaderImageRight")}else{this.defaultImg=(new Element("img",{src:this.options.clearDefault?this.options.imgClearLeft:this.options.imgColoredLeft})).addClassName("posterousHeaderImageLeft");this.defaultArrowImg=(new Element("img",{src:this.options.imgArrowLeft,style:"display: none;"})).addClassName("posterousHeaderImageLeft");this.defaultExpandedImg=(new Element("img",{src:this.options.imgExpandedLeft,
style:"display: none;"})).addClassName("posterousHeaderImageLeft")}var posterousLink=(new Element("a",{href:"http://posterous.com/"})).addClassName("mp_logo_btn");posterousLink.appendChild(this.defaultImg);posterousLink.appendChild(this.defaultArrowImg);posterousLink.appendChild(this.defaultExpandedImg);this.posterousImg=this.defaultImg;this.headerDiv.appendChild(posterousLink);this.expandedDiv=(new Element("div",{id:this.headerDiv.id+"expanded_content",style:"display: none;"})).update("Hello world!");
this.expandedDiv.innerHTML=contents;this.expandedDiv.addClassName(this.options.direction=="right"?this.options.clearDefault?"posterousHeaderExpandedDivRight":"posterousHeaderExpandedDivRightOpaque":this.options.clearDefault?"posterousHeaderExpandedDivLeft":"posterousHeaderExpandedDivLeftOpaque");this.headerDiv.appendChild(this.expandedDiv);this.setState("hidden");document.observe("mousemove",this.mouseHandler.bindAsEventListener(this));Effect.Appear(this.headerDiv)},getParentBackgroundColor:function(elem){if(elem.getStyle==
null)return"transparent";var bgcolor=elem.getStyle("background-color");if(bgcolor&&bgcolor!="transparent"&&bgcolor!="rgba(0, 0, 0, 0)")return bgcolor;if(!elem.up())return"transparent";return this.getParentBackgroundColor(elem.up())},getColorSum:function(color_str){var sum=0;if(Prototype.Browser.IE){color_str=color_str.gsub(/^#/,"");color_str=color_str.gsub(/^([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,"#{1}#{1}#{2}#{2}#{3}#{3}");color_str=color_str.gsub(/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
function(match){return parseInt(match[1],16)+" "+parseInt(match[2],16)+" "+parseInt(match[3],16)})}color_str.scan(/\d+/,function(num){sum=sum+parseInt(num)});return sum},mouseHandler:function(evt){var x=Event.pointerX(evt);var y=Event.pointerY(evt);this.getCurrentPositions();if(this.viewstate=="expanded"&&this.isInExpandedArea(x,y)||this.isInActivationArea(x,y))this.setState("expanded");else if(this.viewstate!="expanded"&&this.isInTeaserArea(x,y))this.setState("arrow");else this.setState("hidden")},
setState:function(newState){if(this.viewstate==newState)return;if(newState=="expanded"){this.defaultImg.hide();this.defaultArrowImg.hide();this.posterousImg=this.defaultExpandedImg;if(Prototype.Browser.IE)this.expandedDiv.show();else{this.sliding=true;Effect.Appear(this.expandedDiv,Object.extend({duration:0.15,afterFinish:function(){this.sliding=false}.bindAsEventListener(this)}))}this.posterousImg.show()}else if(newState=="arrow"&&this.viewstate!="expanded"&&!this.sliding){this.defaultImg.hide();
this.defaultExpandedImg.hide();this.posterousImg=this.defaultArrowImg;this.posterousImg.show()}else{this.posterousImg=this.defaultImg;if(Prototype.Browser.IE){this.defaultArrowImg.hide();this.defaultExpandedImg.hide();this.posterousImg.show();this.expandedDiv.hide()}else{this.sliding=true;Effect.Fade(this.expandedDiv,Object.extend({duration:0.1,afterFinish:function(){this.defaultArrowImg.hide();this.defaultExpandedImg.hide();this.posterousImg.show();this.sliding=false}.bindAsEventListener(this)}))}}this.viewstate=
newState},isInActivationArea:function(x,y){return y<this.e_off.top+this.e_dim.height+5&&x>=this.e_off.left&&x<=this.e_off.left+this.e_dim.width},isInExpandedArea:function(x,y){return y<this.t_off.top+this.t_dim.height+this.options.hide_offset_px&&x>=this.t_off.left-this.options.hide_offset_px&&x<=this.t_off.left+this.t_dim.width+this.options.hide_offset_px},isInTeaserArea:function(x,y){return y<this.t_off.top+this.t_dim.height+this.options.top_active_area_px&&x>=this.e_off.left-this.options.top_active_area_px&&
x<=this.e_off.left+this.e_dim.width+this.options.top_active_area_px},getCurrentPositions:function(){this.e_dim=this.posterousImg.getDimensions();this.e_off=this.posterousImg.cumulativeOffset();this.t_dim=this.headerDiv.getDimensions();this.t_off=this.headerDiv.cumulativeOffset()}});
document.observe("dom:loaded",function(){if($("posterous_modal_flash")){setTimeout("Effect.Appear($('posterous_modal_flash'))",1E3);$("posterous_modal_flash").observe("click",function(){Effect.Fade($("posterous_modal_flash"),{duration:0.5})})}if($("footerbar")&&$("footerbar").hasClassName("claimbar"))setTimeout("Effect.BlindDown($('footerbar'))",1E3)});
var isIphone=navigator.userAgent.toLowerCase().indexOf("mobile")!=-1&&(navigator.userAgent.toLowerCase().indexOf("iphone")!=-1||navigator.userAgent.toLowerCase().indexOf("ipod")!=-1||navigator.userAgent.toLowerCase().indexOf("ipad")!=-1);
var Application=Class.create({_posterousDefaultAnimationDurationLong:0.5,_posterousDefaultAnimationDurationShort:0.2,modalWindow:null,posts:{},postIds:[],retries:0,initialize:function(){if($$("body").first().hasClassName("mobile")){this.initializeMobile();return}this.registerProtomenus();this.initializeSubscriptionButtons();this.initializeSubscriptionLinks();this.initializeTagModal();if(!$$('meta[name="generator"]').first())return;try{this.registerShowOnClickActions();this.registerShowOnHoverActions();
this.registerSearchBoxes();this.registerComment();this.registerRetweetButtons();this.parseCodeBlocks();this.fillAllTimeAgoFields()}catch(err){}this.afterDeferredContentCallbacks=[this.setAuthenticityToken.bind(this),this.registerPosterousBar.bind(this),this.registerSubscribeLinks.bind(this),this.registerSubscribeContent.bind(this),this.createFavorite.bind(this),this.replaceViewCounts.bind(this),this.createNewCommentForm.bind(this),this.initializeCommentForm.bind(this),this.insertAdminBox.bind(this),
this.removeUnauthorizedEditBoxes.bind(this),this.fixDeleteLinks.bind(this),this.registerProtomenus.bind(this),this.setupUpsell.bind(this),this.postMixpanelUserActivity.bind(this),this.postMixpanelSiteActivity.bind(this)]},initializeMobile:function(){this.fillAllTimeAgoFields()},makeDeferredCallbacks:function(json){this.afterDeferredContentCallbacks.each(function(c){c(json)},this);window.deferredContent=json;$j(window).trigger("app:deferredContentComplete")},setupUpsell:function(deferredContent){if(!deferredContent.logged_in&&
deferredContent.show_upsell&&!isIphone){var upsell=(new Element("a",{id:"posterous_footerbar",href:"http://posterous.com/faq"})).update("Share it your way on Posterous - Create your own site, blog or group for free&nbsp;&raquo;");var newMargin=(parseInt($(document.body).getStyle("margin-bottom"),10)+60).toString()+"px";$(document.body).setStyle("margin-bottom",newMargin);$(document.body).appendChild(upsell)}},postMixpanelUserActivity:function(deferredContent){if(deferredContent.logged_in){mpmetrics.track("User Activity",
{id:deferredContent.uid,type:"Logged in Page View"});mpmetrics.track("User Activity, No Emails",{id:deferredContent.uid,type:"Logged in Page View"})}},postMixpanelSiteActivity:function(){var attrs_dom=$j("[data-site-id]");if(attrs_dom.length>0){var site_id=attrs_dom.attr("data-site-id");var is_private=attrs_dom.attr("data-site-is-private");mpmetrics.identify(site_id);mpmetrics.track("Site Activity",{action:"views","private":is_private})}},registerProtomenus:function(){if(!Prototype.Browser.IE)$$('[data-posterous-protomenu="true"]').each(function(e){e.href=
"#";e.down("img").show();items=$(e.readAttribute("data-posterous-items-list-id")).select("li a").map(function(m){return{href:m.href,name:m.innerHTML,icon:m.readAttribute("data-icon")}});new Proto.Menu({selector:"#"+e.id,position:"relative",location:e,click:"left",width:200,className:"menu desktop",menuItems:items})})},registerShowOnClickActions:function(){$$('[data-posterous-show-on-click="true"]').each(function(e){var elementToHideOnClick=$(e.readAttribute("data-posterous-hide-on-click-id"));var actionTriggerElement=
$(e.readAttribute("data-posterous-action-trigger-id"));var elementToShowOnClick=$(e.readAttribute("data-posterous-id-to-show-on-click"));if(actionTriggerElement&&elementToShowOnClick)actionTriggerElement.observe("click",function(event){event.stop();if(elementToHideOnClick)elementToHideOnClick.hide();Effect.toggle(elementToShowOnClick,"slide",{duration:this._posterousDefaultAnimationDurationLong,afterFinish:function(){$j("body").trigger("show-on-click:finished")}})}.bindAsEventListener(this))},this)},
registerShowOnHoverActions:function(){$$('[data-posterous-show-on-hover="true"]').each(function(e){var actionTriggerElement=$(e.readAttribute("data-posterous-action-trigger-id"));var elementToShowOnHover=$(e.readAttribute("data-posterous-id-to-show-on-hover"));if(actionTriggerElement&&elementToShowOnHover){actionTriggerElement.observe("mouseover",function(){elementToShowOnHover.show()});actionTriggerElement.observe("mouseout",function(){elementToShowOnHover.hide()})}})},registerSubscribeLinks:function(deferredContent){$$('[data-posterous-subscribe-link="true"]').each(function(e){var actionTriggerElement=
$(e.readAttribute("data-posterous-action-trigger-id"));var elementToBeReplaced=$(e.readAttribute("data-posterous-id-to-be-replaced"));var loadingElement=$(e.readAttribute("data-posterous-loading-element"));var actionToTake=e.readAttribute("data-posterous-subscription-action").strip()=="addsub"?"addsub":"removesub";var siteId=e.readAttribute("data-posterous-site-id");if(actionToTake=="addsub")deferredContent.subscribed_to_this_site?e.hide():e.show();else deferredContent.subscribed_to_this_site?e.show():
e.hide();if(actionTriggerElement)actionTriggerElement.observe("click",function(event){event.stop();new Ajax.Request("/members/modal",{method:"get",evalScripts:true,parameters:{site_id:siteId},onLoading:function(){loadingElement.show();actionTriggerElement.hide();elementToBeReplaced.update()},onComplete:function(){loadingElement.hide()},onSuccess:function(transport){var json=transport.responseJSON;Control.Modal.open(json.rsp,{height:5,width:500});Control.Modal.showInternalElement($("modal_container").down(),
Effect.Appear);this.initializeSubscriptionModal()}.bind(this)})}.bind(this))}.bind(this))},initializeSubscriptionButtons:function(){$$('[data-posterous-subscribe-onsite-link="true"]').each(function(e){new StateButton(e,{initialState:e.readAttribute("data-posterous-member-type"),states:{unsubscribed:{text:"Subscribe"},subscribed:{text:"Subscribed",tooltip:"Click to change notification settings or unsubscribe."},contributor:{text:"You're a contributor",tooltip:"Click to change notification settings or unsubscribe."},
admin:{text:"You're an admin",tooltip:"Click to change notification settings or unsubscribe."},nonuser:{text:"Subscribe by email"},loading:{text:"Loading..."}},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},initializeSubscriptionLinks:function(){$$(".posterous_trigger_member_modal").each(function(e){new StateLink(e,{initialState:e.readAttribute("data-posterous-member-type"),states:{unsubscribed:{text:"Subscribe"},subscribed:{text:"Manage how I get email updates"},contributor:{text:"Manage how I get email updates"},
admin:{text:"Manage how I get email updates"},nonuser:{text:"Subscribe by email"},loading:{text:"Loading..."}},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},registerSubscribeContent:function(deferredContent){$$('[data-posterous-subscribe2-link="true"]').each(function(e){new StateContainer(e,{initialState:deferredContent.member_type,states:{unsubscribed:e.readAttribute("data-posterous-subscription-unsubscribed-content"),subscribed:e.readAttribute("data-posterous-subscription-subscribed-content"),
contributor:e.readAttribute("data-posterous-subscription-contributor-content"),admin:e.readAttribute("data-posterous-subscription-admin-content"),nonuser:e.readAttribute("data-posterous-subscription-non-user-content"),loading:e.readAttribute("data-posterous-loading")},stateTriggers:{unsubscribed:e.readAttribute("data-posterous-subscription-unsubscribed-action"),subscribed:e.readAttribute("data-posterous-subscription-subscribed-action"),contributor:e.readAttribute("data-posterous-subscription-contributor-action"),
admin:e.readAttribute("data-posterous-subscription-admin-action"),nonuser:e.readAttribute("data-posterous-subscription-non-user-action")},onButtonClicked:this.subscriptionButtonClicked.bind(this)})},this)},subscriptionButtonClicked:function(stateButton){var startState=stateButton.currentState();var siteId=stateButton.element.readAttribute("data-posterous-site-id");stateButton.changeState("loading");var callback=null;var self=this;if(startState=="unsubscribed"){mpmetrics.track("JS - Member Modal - Trigger Subscribe",
{state:startState});mpmetrics.track("Follow button Clicked",{view_type:"site",action:"follow"});new Ajax.Request("/members",{method:"post",parameters:{site_id:siteId,authenticity_token:window._token},onComplete:stateButton.changeState.bind(stateButton,"subscribed"),onSuccess:function(){self.openSubscriptionModal(startState,siteId,{stateButton:stateButton,afterClose:function(){if(startState!="unsubscribed")stateButton.changeState(startState)}})}})}else{mpmetrics.track("JS - Member Modal - Trigger Edit",
{state:startState});this.openSubscriptionModal(startState,siteId,{stateButton:stateButton,afterClose:function(){if(startState!="unsubscribed")stateButton.changeState(startState)}})}},openSubscriptionModal:function(state,siteId,options){var defaultOptions=$H({});var options=defaultOptions.merge($H(options||{}));var modalWidth=state=="nonuser"?500:250;new Ajax.Request("/members/modal",{method:"get",parameters:{site_id:siteId,just_followed:state=="unsubscribed"?true:null},onSuccess:function(transport){Control.Modal.open(transport.responseJSON.rsp,
{height:5,width:modalWidth,afterClose:options.get("afterClose")});Control.Modal.showInternalElement($("modal_container").down(),Effect.Appear);this.initializeSubscriptionModal(options);if(typeof options.get("callback")=="function")options.get("callback")(state)}.bind(this)})},initializeSubscriptionModal:function(options){$$(".modal_cancel").each(function(e){e.observe("click",Control.Modal.close)});this.initializeNotificationForm(options);this.initializeSubscriptionForm(options)},initializeNotificationForm:function(options){if($("notification_user_option_form"))$("notification_user_option_select").observe("change",
function(){mpmetrics.track("JS - Member Modal - Trigger freq of notification");$("notification_user_option_form").request({onLoading:function(){$("notification_user_option_ajax_result").update("<img src='/images/loading.gif' width='16' height='16' alt='loading'/>")},onSuccess:function(transport){var json=transport.responseJSON;$("notification_user_option_ajax_result").update("<img src='/images/icons/silk/accept.png' width='16' height='16'/>")},onFailure:function(transport){var json=transport.responseJSON;
$("notification_user_option_ajax_result").update("<img src='/images/icons/silk/error.png' width='16' height='16'/>")}})})},initializeSubscriptionForm:function(options){if($("subscribe_form")){var subform=$$("#modal_container .subscription_form").first();$("subscribe_form_submit").observe("click",function(e){e.stop();if(!subform||subform.readAttribute("data-is-admin-or-contributor")!=""||confirm("Are you sure you want to remove yourself from this site?"))$("subscribe_form").request({onLoading:function(){if($("subscribe_form_response").visible())Control.Modal.hideInternalElement($("subscribe_form_response"));
Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_buttons"),$("subscribe_form_loading"))})},onSuccess:function(transport){var json=transport.responseJSON;$("subscribe_form_response").removeClassName("subscribe_form_response_fail");$("subscribe_form_response").addClassName("subscribe_form_response_success");$("subscribe_form_response").update(json.rsp);if(subform&&options.get("stateButton")){delete Control.Modal.current.options.afterClose;if(subform.readAttribute("data-member")==
""){options.get("stateButton").changeState("unsubscribed");mpmetrics.track("Follow button Clicked",{view_type:"site",action:"unfollow"})}else if(subform.readAttribute("data-logged-in")=="")options.get("stateButton").changeState("subscribed")}Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_loading"),$("subscribe_form_response"))});Effect.waitForQueueClear(function(){if(json.reloadWindow)window.location.reload(true);else setTimeout(function(){Control.Modal.close(false,true)},
1500)})},onFailure:function(transport){$("subscribe_form_response").addClassName("subscribe_form_response_fail");$("subscribe_form_response").update(transport.responseJSON.rsp);Effect.waitForQueueClear(function(){Effect.swapElems($("subscribe_form_loading"),$("subscribe_form_buttons"))});Effect.waitForQueueClear(function(){Control.Modal.showInternalElement($("subscribe_form_response"))})}})})}},registerSearchBoxes:function(){$$('[data-posterous-search-box="true"]').each(function(e){var searchButton=
$(e.readAttribute("data-posterous-search-button-id"));var searchBox=$(e.readAttribute("data-posterous-search-box-id"));var currentlyHoveringOverButton=false;if(searchButton&&searchBox){searchButton.observe("mouseover",function(){currentlyHoveringOverButton=true});searchButton.observe("mouseout",function(){currentlyHoveringOverButton=false});searchBox.observe("focus",function(){searchButton.show()});searchBox.observe("blur",function(){if(!currentlyHoveringOverButton)searchButton.hide()})}})},registerPosterousBar:function(deferredContent){$$('[data-posterous-bar="true"]').each(function(e){$(e.readAttribute("data-posterous-action-id")||
e.id).insert({bottom:deferredContent.posterous_bar});new PosterousHeader($(e.readAttribute("data-posterous-action-id")||e.id),{direction:e.readAttribute("data-posterous-direction")||"left",clearDefault:e.readAttribute("data-posterous-translucent")||"false"})});$$('[data-posterous-bar-legacy="true"]').each(function(e){e.update(deferredContent.posterous_bar_legacy).show()},this);var slideshowBtns=$j("a[data-mixpanel-id=mp_slideshow_btn]");if(slideshowBtns&&slideshowBtns.length>0)slideshowBtns.click(function(){mpmetrics.track("Posterous Bar: Button Clicked (Clean Sheet)",
{button_label:"Slideshow",bar_type:"Clean Sheet"});mpmetrics.track("Posterous Bar: Button Clicked",{button_label:"Slideshow",bar_type:"Clean Sheet"})});mpmetrics.track_links($j("li[data-mixpanel-id=mp_login_btn] a"),"Posterous Bar: Button Clicked (Clean Sheet)",{button_label:"Login",bar_type:"Clean Sheet"});mpmetrics.track_links($j("li[data-mixpanel-id=mp_login_btn] a"),"Posterous Bar: Button Clicked",{button_label:"Login",bar_type:"Clean Sheet"});mpmetrics.track_links($j("li[data-mixpanel-id=mp_get_your_space_btn] a"),
"Posterous Bar: Button Clicked (Clean Sheet)",{button_label:"Get your own Space",bar_type:"Clean Sheet"});mpmetrics.track_links($j("li[data-mixpanel-id=mp_get_your_space_btn] a"),"Posterous Bar: Button Clicked",{button_label:"Get your own Space",bar_type:"Clean Sheet"});mpmetrics.track_links($j("#posterous_header a.logo"),"Posterous Bar: Button Clicked (Clean Sheet)",{button_label:"Logo",bar_type:"Clean Sheet"});mpmetrics.track_links($j("#posterous_header a.logo"),"Posterous Bar: Button Clicked",
{button_label:"Logo",bar_type:"Clean Sheet"});mpmetrics.track_links($j(".posterousHeaderActions a.try_it_now"),"Posterous Bar: Button Clicked (Button Style)",{button_label:"Try it now",bar_type:"Button Style"});mpmetrics.track_links($j(".posterousHeaderActions a.try_it_now"),"Posterous Bar: Button Clicked",{button_label:"Try it now",bar_type:"Button Style"});mpmetrics.track_links($j(".posterousHeaderActions a.login"),"Posterous Bar: Button Clicked (Button Style)",{button_label:"Login",bar_type:"Button Style"});
mpmetrics.track_links($j(".posterousHeaderActions a.login"),"Posterous Bar: Button Clicked",{button_label:"Login",bar_type:"Button Style"});mpmetrics.track_links($j(".posterousHeaderActions a.slideshow"),"Posterous Bar: Button Clicked (Button Style)",{button_label:"Slideshow",bar_type:"Button Style"});mpmetrics.track_links($j(".posterousHeaderActions a.slideshow"),"Posterous Bar: Button Clicked",{button_label:"Slideshow",bar_type:"Button Style"});mpmetrics.track_links($j("a.mp_logo_btn"),"Posterous Bar: Button Clicked (Button Style)",
{button_label:"Logo",bar_type:"Button Style"});mpmetrics.track_links($j("a.mp_logo_btn"),"Posterous Bar: Button Clicked",{button_label:"Logo",bar_type:"Button Style"})},createFavorite:function(deferredContent){if(deferredContent.logged_in){var postFavorited=null;$$('[data-posterous-favorite="true"]').each(function(e){if($(e.readAttribute("data-posterous-position"))&&$(e.readAttribute("data-posterous-hover"))){postFavorited=deferredContent.post_favorited[parseInt(e.readAttribute("data-posterous-identifier"),
10)];new PFavorite(e.readAttribute("data-posterous-hover"),e.readAttribute("data-posterous-position"),e.readAttribute("data-posterous-identifier"),postFavorited==true)}},this);var postId;$j("[data-posterous-like-button-for-post-id]").each(function(i){postId=$j(this).attr("data-posterous-like-button-for-post-id");p.setLikedState(postId,deferredContent.post_favorited[parseInt(postId,10)])})}},setLikedState:function(postId,liked){var elm=$j('[data-posterous-like-button-for-post-id="'+postId+'"]');if(liked){var text=
elm.attr("data-posterous-unlike-text");var htmlClass="unlike_post";var url=elm.attr("data-unlike-url")}else{var text=elm.attr("data-posterous-like-text");var htmlClass="like_post";var url=elm.attr("data-like-url")}elm.removeClass().addClass(htmlClass).attr("href",url).attr("title",text).children("span").html(text);if(!Modernizr&&(document.body||document.documentElement).style.WebkitPerspective===undefined||!Modernizr.csstransforms3d)if(liked){elm.children(".p_unlike_icon").show();elm.children(".p_like_icon").hide()}else{elm.children(".p_unlike_icon").hide();
elm.children(".p_like_icon").show()}else{elm.children(".p_unlike_icon").show();elm.children(".p_like_icon").show()}},registerComment:function(){$$('[data-posterous-comment="true"]').each(function(e){if($(e.readAttribute("data-posterous-comment-link")))window[e.readAttribute("data-posterous-comment-var")]=new PComment($(e.readAttribute("data-posterous-comment-link")),e.readAttribute("data-posterous-post-identifier"),$(e.readAttribute("data-posterous-post-div")))})},registerRetweetButtons:function(){$$('[data-posterous-retweet="true"]').each(function(e){new PModal(e.id,
"/posts/retweet",{post_id:e.readAttribute("data-posterous-post-id"),authenticity_token:window._token},{width:500,height:160,identifier:"retweet_modal_"+e.readAttribute("data-posterous-post-id")})})},parseCodeBlocks:function(){if($$('[data-posterous-parse-code="true"]').length>0){dp.SyntaxHighlighter.ClipboardSwf="/javascripts/syntaxhighlighter/clipboard.swf";dp.SyntaxHighlighter.HighlightAll("code",false)}},replaceViewCounts:function(deferredContent){$$('[data-posterous-view-count="true"]').each(function(e){var postId=
parseInt(e.readAttribute("data-posterous-post-id"),10);if(deferredContent&&deferredContent.post_views&&(deferredContent.post_views[postId]||deferredContent.post_views[postId]===0))e.replace(deferredContent.post_views[postId])})},fillAllTimeAgoFields:function(){var fromDate=null;$$('[data-posterous-time-ago="true"]').each(function(e){fromDate=parseInt(e.readAttribute("data-posterous-pubdate"),10);e.replace(this._timeAgoInWords(fromDate)+" ago")},this)},insertAdminBox:function(deferredContent){$$('[data-posterous-admin-box="true"]').each(function(e){e.replace(deferredContent.admin_box)})},
initializeCommentForm:function(deferredContent,id){var postId=null;var showFacebookOptions=false;var facebookLoginButton=null;var facebookLogoutButton=null;var twitterLoginButton=null;var posterousBodyTextarea=null;var emailNotifyToast=null;var twitterComment=null;var twitterOauthRedirect=null;var commentForms=id?[$(id)]:$$('[data-posterous-comment-form="true"]');$$('[data-posterous-user-setting-toggle="true"]').each(function(e){e.observe("click",function(){if(e.checked)new Ajax.Request("/user_settings/set/"+
e.readAttribute("data-posterous-user-setting-attribute"),{method:"get"});else new Ajax.Request("/user_settings/unset/"+e.readAttribute("data-posterous-user-setting-attribute"),{method:"get"})})});commentForms.each(function(e){postId=e.readAttribute("data-posterous-post-id");showFacebookOptions=e.readAttribute("data-posterous-facebook")=="true";if(posterousBodyTextarea=$("pcomment_newbody_"+postId))new Texpand(posterousBodyTextarea);e.select('.facebook_login_button, [data-facebook-login-botton="true"]').each(function(f){f.observe("click",
function(event){event.stop();FB.login(function(response){window.location.href=f.href})})});if(facebookLogoutButton=e.down(".facebook_logout_button"))facebookLogoutButton.observe("click",function(event){event.stop();FB.logout(function(response){window.location.reload(true)})});if(twitterOauthRedirect=$$('[data-posterous-twitter-oauth="true"]').first())this.posts=unescape(twitterOauthRedirect.readAttribute("data-posterous-post-ids").gsub("+"," ")).evalJSON();e.select(".twitter_login_button").each(function(t){t.observe("click",
function(event){event.stop();this.initOauthAndRedirectToPost("1",this.posts[parseInt(postId,10)])}.bindAsEventListener(this))},this);if(emailNotifyToast=$("comment_email_notify_toast_"+postId)){$("comment_email_notify_"+postId).observe("click",function(){this._refreshToast(postId,true)});this._refreshToast(postId,false)}if(twitterPreview=$("twitter_preview_"+postId)){twitterComment=new PTwitterComment("push_twitter_comment_"+postId,"pcomment_newbody_"+postId,"twitter_body_"+postId,"twitter_preview_"+
postId,twitterPreview.readAttribute("data-posterous-twitter-username"),twitterPreview.readAttribute("data-posterous-short-url"),twitterPreview.readAttribute("data-posterous-show-lin"));twitterComment.updateAll()}e.observe("submit",function(event){event.stop();if($("push_fbfeed_"+postId)&&$("push_fbfeed_"+postId).checked&&FB.getSession()==null)FB.login(Prototype.empty);$("pcomment_submit_loading_"+postId).show();$("posterous_submit_"+postId).hide();$j.ajax({type:"post",url:e.action,data:$j(this).serialize(),
success:function(response){$("pcomment_newbody_"+postId).value="";if($("twitter_body_"+postId))$("twitter_body_"+postId).value=""},complete:function(data){$j("#pcomment_comments_new_"+postId).append(data.responseText);$("pcomment_submit_loading_"+postId).hide();$("posterous_submit_"+postId).show();if($("first_comment_"+postId))$("first_comment_"+postId).hide();$("pcomment_comments_new_"+postId).highlight();if(showFacebookOptions)p.publishCommentToFacebook(postId)}})})},this)},publishCommentToFacebook:function(postId,
body,publish){window["fb_comment_"+postId]=body||$("pcomment_newbody_"+postId).value;window["push_fbfeed_"+postId]=publish||($("push_fbfeed_"+postId)?$("push_fbfeed_"+postId).checked:false);if(window["push_fbfeed_"+postId]){if(window["fb_comment_attachment_"+postId]==undefined)window["fb_comment_attachment_"+postId]=null;if(window["fb_comment_action_link_"+postId]==undefined)window["fb_comment_action_link_"+postId]=null;if(window.fbid_site_owner==undefined)window.fbid_site_owner=1;new PeriodicalExecuter(function(pe){if(FB.getSession()!=
null){FB.ui({method:"stream.publish",message:window["fb_comment_"+postId],user_message_prompt:"What are your comments?",attachment:window["fb_comment_attachment_"+postId],action_links:window["fb_comment_action_link_"+postId]});pe.stop()}},1)}FB.XFBML.parse()},createNewCommentForm:function(deferredContent){if(!deferredContent.new_comment_form)return;$$('[data-posterous-new-comment-form="true"]').each(function(e){e.replace(deferredContent.new_comment_form);FB.XFBML.parse()})},initializeTagForm:function(event,
modal){var tagLink=$j(this);var tagFeed=$j.parseJSON($j(modal.modal).find("[data-tag-feed]").attr("data-tag-feed"));var postId=tagLink.attr("data-post-id");var createTagUrl=$j(modal.modal).find("[data-tag-feed]").attr("data-create-url");var destroyTagUrl=$j(modal.modal).find("[data-tag-feed]").attr("data-destroy-url");var tagboxSelector=new ProtoMultiSelect("tags-input-box",null,{feed:tagFeed,defaultMessage:"Type the name of a tag you'd like to add to this post.",newValues:true,sortResults:true,onUserAdd:function(input){$j.jsonp({url:createTagUrl,
data:{tags:input.caption,post_id:postId,authenticity_token:window._token,format:"jsonp"}})},onUserRemove:function(input){$j.jsonp({url:destroyTagUrl,data:{caption:input.caption,id:input.value,new_value:input.newValue,post_id:postId,authenticity_token:window._token,format:"jsonp"}})}});tagboxSelector.inputElem.focus()},initializeTagModal:function(){$j('a[data-posterous-tag-form="true"]').bind("modal:success",this.initializeTagForm)},removeUnauthorizedEditBoxes:function(deferredContent){$$('[data-posterous-edit-box="true"]').each(function(e){if(!deferredContent.edit_boxes[parseInt(e.readAttribute("data-posterous-post-id"),
10)])e.remove();else e.removeClassName("posterous_edit_box_hidden")})},setAuthenticityToken:function(deferredContent){if(deferredContent.authenticity_token)window._token=deferredContent.authenticity_token},fixDeleteLinks:function(){$$('[data-posterous-delete-link="true"]').each(function(e){e.observe("click",function(event){e.innerHTML="Deleting...";Event.stop(event);if(confirm(e.readAttribute("data-posterous-confirm")))new Ajax.Request(e.href,{method:"delete",parameters:{authenticity_token:window._token},
onSuccess:function(){window.location.reload()}})})})},_refreshToast:function(postId,doFocus){if($("comment_email_notify_"+postId).checked){$("comment_email_notify_toast_"+postId).value="Please enter your email address here";$("comment_email_notify_toast_"+postId).show();if(doFocus){$("comment_email_notify_toast_"+postId).focus();$("comment_email_notify_toast_"+postId).select()}}else{$("comment_email_notify_toast_"+postId).value="";$("comment_email_notify_toast_"+postId).hide()}},initOauthAndRedirectToPost:function(providerType,
redirectUrl){this.modalWindow=window.open("","_blank","height=400,width=800,left=300,top=200,resizable=yes",true);this.modalWindow.location.href=$$('[data-posterous-twitter-oauth="true"]').first().readAttribute("data-posterous-redirect-url")+providerType;new PeriodicalExecuter(function(pe){if(this.modalWindow.closed){if(window.location.href==redirectUrl||window.location.href+"#comments"==redirectUrl)window.location.reload();else window.location.href=redirectUrl;pe.stop()}}.bind(this),0.25)},_timeAgoInWords:function(from){var now=
Math.floor((new Date).getTime()/1E3);return this._distanceOfTimeInWords(now,from)},_distanceOfTimeInWords:function(to,from){secondsAgo=to-from;minutesAgo=Math.max(Math.floor(secondsAgo/60),0);if(minutesAgo==0)return"less than a minute";if(minutesAgo==1)return"1 minute ago";if(minutesAgo<45)return minutesAgo+" minutes";if(minutesAgo<90)return" 1 hour";hoursAgo=Math.floor(minutesAgo/60);if(minutesAgo<1440)return hoursAgo+" hours";if(minutesAgo<2880)return"1 day";daysAgo=Math.floor(minutesAgo/1440);
if(minutesAgo<43200)return daysAgo+" days";if(minutesAgo<86400)return"1 month";monthsAgo=Math.floor(minutesAgo/43200);if(minutesAgo<525960)return monthsAgo+" months";if(minutesAgo<1051920)return"1 year";yearsAgo=Math.floor(minutesAgo/525960);return"over "+yearsAgo+" years"}});
if(typeof Effect!="undefined")Object.extend(Effect,{swapElems:function(elem_to_hide,elem_to_show,options){if(!options)options={};Effect.Fade(elem_to_hide,Object.extend(options,{queue:"front"}));Effect.Appear(elem_to_show,Object.extend(options,{queue:"end"}))},waitForQueueClear:function(callback,queue){if(!queue)queue="global";new PeriodicalExecuter(function(pe){if(Effect.Queues.get(queue).effects.length==0){pe.stop();callback()}},0.2)}});
Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction;this.transport.abort();Ajax.activeRequestCount--};document.observe("dom:loaded",function(){afterload=(new Date).getTime();p=new Application;$$("body").first().fire("posterous:initialized");if(typeof beforeload!="undefined"){loadtime=Math.round((afterload-beforeload)/1E3*Math.pow(10,1))/Math.pow(10,1);mpmetrics.track("Pageview - IP",{type:pagetype,load_time:loadtime})}});
var ActionMenu=Class.create({initialize:function(root,options){var defaultOptions=$H({onItemSelected:null,onMenuOpened:null});this.menu=$(root);if(!this.menu.readAttribute("data-menu-activated")!="true"){this.menu.writeAttribute("data-menu-activated","true");this.options=defaultOptions.merge($H(options||{}));this.button=this.menu.down(".button, .action_menu_dropdown_button");this.dropDown=this.button.next();this.button.observe("click",this.menuOpened.bindAsEventListener(this));this.dropDown.select("a").each(function(e){e.observe("click",
this.itemSelected.bindAsEventListener(this,e))},this)}},itemSelected:function(e,item,skipCallback){if(!skipCallback)if(typeof this.options.get("onItemSelected")=="function")this.options.get("onItemSelected")(e,item,this)},menuOpened:function(e){e.stop();ActionMenu.resetAllDropdowns();if(!this.button.hasClassName("active")){this.button.addClassName("active");this.dropDown.show()}this.menu.setStyle({zIndex:1E3});if(typeof this.options.get("onMenuOpened")=="function")this.options.get("onMenuOpened")(e,
this)}});ActionMenu.resetAllDropdowns=function(){$$(".action_menu, .state_menu").each(function(e){e.setStyle({zIndex:1});e.down(".action_menu_dropdown:visible").hide();e.down(".action_menu_dropdown_button, .button").removeClassName("active")})};
var StateMenu=Class.create(ActionMenu,{initialize:function($super,root,options){$super(root,options);this.value=this.menu.readAttribute("data-value")||this.button.down("span").innerHTML;this.previousItem=this.menu.select("li.selected a").first()||this.menu.select("li").first()},itemSelected:function($super,e,item,skipCallback){if(e)e.stop();var text=item.down("span").innerHTML;var value=item.readAttribute("data-value")||text;this.menu.writeAttribute("data-value",value);this.value=this.menu.readAttribute("data-value");
this.button.down("span").innerHTML=text;this.previousItem=item.up("ul").select("li.selected a").first();item.up("ul").select("li").invoke("removeClassName","selected");item.up("li").addClassName("selected");ActionMenu.resetAllDropdowns();$super(e,item,skipCallback)},undo:function(){this.itemSelected(null,this.previousItem,true)}});
var ActionSplitButton=Class.create({initialize:function(root,onItemSelected){this.menu=$(root);this.onItemSelected=onItemSelected;this.menu.select("li").each(function(e){e.observe("click",this.itemSelected.bindAsEventListener(this,e))},this)},itemSelected:function(e,item){e.stop();if(!item.hasClassName("active")){item.up("ul").select("li").invoke("removeClassName","active");item.addClassName("active");if(typeof this.onItemSelected=="function")this.onItemSelected(e,item)}}});
var AutoFadeInput=Class.create({initialize:function(input,options){var defaultOptions=$H({onKeypress:null,onBlur:null,onFocus:null});this.options=defaultOptions.merge($H(options||{}));this.input=$(input);this.label=this.input.adjacent("label").first();this.input.observe("keyup",this.keyWasPressed.bind(this));this.input.observe("focus",this.inputWasFocused.bind(this));this.input.observe("blur",this.inputWasBlurred.bind(this));this.keyWasPressed()},keyWasPressed:function(){if(this.input.present())this.label.hide();
if(typeof this.options.get("onKeypress")=="function")this.options.get("onKeypress")(this)},inputWasBlurred:function(){if(!this.input.present())this.label.appear({duration:Application.prototype._posterousDefaultAnimationDurationShort,to:1});if(typeof this.options.get("onBlur")=="function")this.options.get("onBlur")(this)},inputWasFocused:function(){this.label.fade({duration:Application.prototype._posterousDefaultAnimationDurationShort,to:0.5});if(typeof this.options.get("onFocus")=="function")this.options.get("onFocus")(this)}});
var ErrorBox=Class.create({initialize:function(element,headerText,bodyText,animated,state){element=$(element);var closeBox=(new Element("a",{"class":"close",href:"#",title:"Close this popup"})).update("Close");var header=(new Element("h1")).update(headerText.stripTags());var body=(new Element("p")).update(bodyText.stripTags());var outer=(new Element("div",{"class":"p_popup"+" "+state})).insert((new Element("div")).insert((new Element("div",{"class":"inner"})).insert(closeBox).insert(header).insert(body)));
this.outer=outer;$(document.body).insert(outer);var elementPosition=element.cumulativeOffset();var elementWidth=element.getWidth();var widgetDimensions=outer.getDimensions();var top=elementPosition[1]-widgetDimensions.height-20;var left=elementPosition[0]+elementWidth/2-widgetDimensions.width/2;outer.setStyle({left:left+"px",top:top+"px"});closeBox.observe("click",function(e){Event.stop(e);if(animated!==false)this.dropAndFade(closeBox.up(".p_popup"),{duration:Application.prototype._posterousDefaultAnimationDurationLong,
afterFinish:function(){outer.remove()}});else outer.remove()}.bind(this));document.body.observe("click",function(e){if(!Event.element(e).up(".p_popup"))$$(".p_popup").invoke("remove")});if(animated!==false)this.dropAndAppear(outer,{duration:Application.prototype._posterousDefaultAnimationDurationLong});else outer.show().setOpacity(1)},dropAndAppear:function(element,options){element.addClassName("active");if(typeof element.style["webkitTransform"]=="undefined")new Effect.Parallel([new Effect.Move(element.down(),
{sync:true,y:20,mode:"relative"}),new Effect.Appear(element.down(),{sync:true})],options||{});else element.show()},dropAndFade:function(element,options){if(typeof element.style["webkitTransform"]=="undefined")new Effect.Parallel([new Effect.Move(element.down(),{sync:true,y:-20,mode:"relative"}),new Effect.Fade(element.down())],options||{});else element.removeClassName("active")},dismiss:function(){this.dropAndFade(this.outer,{afterFinish:function(){this.outer.remove();delete this}.bind(this)})}});
var StateLink=Class.create({initialize:function(element,options){var defaultOptions=$H({states:{}});this.element=$(element);this.options=defaultOptions.merge($H(options||{}));this.states=this.options.get("states");this.observeStateTrigger();this.changeState(this.options.get("initialState")||"")},observeStateTrigger:function(){this.element.observe("click",this.buttonClicked.bindAsEventListener(this))},buttonClicked:function(event){event.stop();if(typeof this.options.get("onButtonClicked")=="function")this.options.get("onButtonClicked")(this)},
changeState:function(newState){var oldState=this.currentState();this.element.writeAttribute("data-state",newState);this.element.removeClassName(oldState).addClassName(newState);this.updateStateText();if(this.states[this.currentState()]["tooltip"])this.element.writeAttribute("data-posterous-tooltip",this.states[this.currentState()]["tooltip"]);else this.element.removeAttribute("data-posterous-tooltip");if(typeof this.options.get("onChangeState")=="function")this.options.get("onChangeState")(this)},
updateStateText:function(){var state=this.currentState();if(this.states[state])this.element.update(this.states[state]["text"])},currentState:function(){return this.element.readAttribute("data-state")}});var StateButton=Class.create(StateLink,{updateStateText:function(){var state=this.currentState();if(this.states[state])this.element.down("span").update(this.states[state]["text"])}});
var StateContainer=Class.create(StateLink,{observeStateTrigger:function(){this.stateTriggers=$H(this.options.get("stateTriggers")||{});this.stateTriggers.each(function(t){$(t.value).observe("click",this.buttonClicked.bindAsEventListener(this))},this)},changeState:function($super,newState){var oldState=this.currentState();this.element.writeAttribute("data-state",newState);if(this.states[oldState])$(this.states[oldState]).hide();if(this.states[newState])$(this.states[newState]).show();if(typeof this.options.get("onChangeState")==
"function")this.options.get("onChangeState")(this)}});
(function($,undefined){$(function(){$("[data-posterous-tooltip]").live("mouseover mouseout",function(event){if(event.type=="mouseover"){var mouseoverText=$(this).attr("data-posterous-tooltip");var offset=$(this).offset();var height=$(this).innerHeight();var width=$(this).innerWidth();var viewportWidth=$(window).width();var className="left";if(offset.left+200>viewportWidth)className="right";$("body").append('<div class="p_tooltip '+className+'" data-posterous-tooltip-box="true"><div class="p_nub"><div class="p_icon"></div></div><div class="inner">'+mouseoverText+
"</div></div>");$(".p_tooltip").css({top:offset.top+height+8+"px"});if(className=="right")$(".p_tooltip").css({right:viewportWidth-offset.left-width/2-31+"px"});else $(".p_tooltip").css({left:offset.left+width/2-31+"px"})}else $('[data-posterous-tooltip-box="true"]').remove();return false})})})($j);document.observe("click",ActionMenu.resetAllDropdowns);if(typeof window.innerShiv==="undefined")window.innerShiv=function(html){return html};
var Responses=function($){function bindFacebookTwitterPushButtons(){$("[data-posterous-toggle-for]").live("click",function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;var elm=$(this);var name=elm.attr("data-posterous-toggle-for");var target=elm.siblings('[name="'+name+'"]');var curValue=target.val();if(curValue=="1"){elm.removeClass("active");target.val("0")}else{elm.addClass("active");target.val("1")}return false})}function bindTwitterLoginButton(){$('[data-posterous-twitter-login-button="true"]').live("click",
function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;p.initOauthAndRedirectToPost("1",$(this).attr("data-posterous-jumpto-url"));return false})}function bindFacebookLoginButton(){$('[data-posterous-facebook-login-botton="true"]').live("click",function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;FB.login(function(response){if(window.location.href=f.href)window.location.reload();else window.location.href=f.href});return false})}function bindActionLinks(){$(".p_action_links a").live("click",
function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;var element=$(this);var rawElement=this;var href=$(this).attr("href");if(element.attr("data-confirm")&&!confirm(element.attr("data-confirm")))return false;addLoading(element);$.ajax({url:href,type:"get",success:function(rsp){var box=new ErrorBox(rawElement,"Done and done.",rsp,true,"confirmation");actionLinkSucceeded(element,box)},error:function(rsp){new ErrorBox(element,"Oops. There was an error",rsp,true,"error")},
complete:function(){removeLoading(element)}})});return false}function actionLinkSucceeded(element,box){if($(element).attr("data-posterous-approve-comment")=="true")setTimeout(function(){$(element).remove();box.dismiss()},4E3);else setTimeout(function(){box.dismiss();$(element).closest("article").fadeOut(500,function(){$(element).remove()})},3E3)}function bindResponsesLinks(){$(".p_responses_link a").live("click",function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;var elm=
$(this);var href=elm.attr("href");var post_id=elm.attr("data-response-post-id");var responses_container=$('[data-posterous-responses-for-post-id="'+post_id+'"]');var show_type=$("body").attr("data-show-type")||$(".posterous_site_data").first().attr("data-show-type");if(show_type!=undefined&&show_type=="site"){removeFailedLike(responses_container);if(responses_container.children(".p_response_container").size()>0&&responses_container.children(".p_response_container").css("display")!="none"&&elm.parent().siblings(".p_comment_link").hasClass("active")==
false)responses_container.children().slideUp();else if(responses_container.children(".p_response_container").size()>0)responses_container.children().slideDown();else{showLoader(responses_container);$.ajax({url:href,type:"get",dataType:"json",data:{authenticity_token:window._token},success:function(rsp){hideLoader(responses_container);responses_container.append(innerShiv(rsp.html));responses_container.find(".p_response_container").slideDown();responses_container.find(".p_response_container").find(".p_responses_list").children().show();
FB.XFBML.parse()}})}}else if(responses_container.children(".p_like_failed").size()>0){removeFailedLike(responses_container);responses_container.children().slideDown();responses_container.next(".p_comment_form").slideDown()}return false})}function bindLikeLinks(){$(".p_like_link .like_post, .p_like_link .unlike_post").live("click",function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;var elm=$(this);var like=elm.hasClass("like_post");var href=elm.attr("href");var responses_container=
elm.parents(".p_response_widget").next();removeFailedLike(responses_container);var loading_class="loading_class";if(elm.hasClass(loading_class))return false;else elm.addClass(loading_class);if(like)showLoader(responses_container,"Liking");else showLoader(responses_container,"Unliking");$.ajax({url:href,type:"get",dataType:"json",data:{authenticity_token:window._token},complete:function(){elm.removeClass(loading_class)},success:function(rsp){hideLoader(responses_container);if(like){if(responses_container.children().size()>
0){responses_container.children(".p_response_container").children(".p_responses_list").append(innerShiv(rsp.html));responses_container.children(".p_response_container").children(".p_responses_list").find(".p_like:last").fadeIn()}count_elm=elm.parent().parent().children(".p_responses_link").children().children("strong");updateResponseCount(count_elm)}else{if(responses_container.children().size()>0)$('[data-posterous-responses-for-post-id="'+rsp.post_id+'"] [data-likes_user_id="'+rsp.user_id+'"]').remove();
count_elm=elm.parent().parent().children(".p_responses_link").children().children("strong");decrementResponseCount(count_elm)}p.setLikedState(rsp.post_id,like)},error:function(jqxhr,textStatus){var show_type=$("body").attr("data-show-type")||$(".posterous_site_data").first().attr("data-show-type");hideLoader(responses_container);if(responses_container.children().size()>0){responses_container.children().slideUp();if(show_type!=undefined&&show_type=="post")responses_container.next(".p_comment_form").slideUp()}responses_container.append(innerShiv($.parseJSON(jqxhr.responseText).html));
responses_container.find(".p_like_failed").slideDown();if(elm.parent().siblings(".p_comment_link").hasClass("active")){elm.parent().siblings(".p_comment_link").children(".p_comment_link a").removeClass("active");elm.parent().siblings(".p_comment_link").removeClass("active")}if(elm.parent().siblings(".p_responses_link").hasClass("active"))elm.parent().siblings(".p_responses_link").removeClass("active");FB.XFBML.parse()}})});return false}function bindCommentLinks(){$(".p_comment_link a").live("click",
function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;var elm=$(this);var href=elm.attr("href");var post_id=elm.attr("data-comment-post-id");var responses_container=$('[data-posterous-responses-for-post-id="'+post_id+'"]');var show_type=$("body").attr("data-show-type")||$(".posterous_site_data").first().attr("data-show-type");if(show_type!=undefined&&show_type=="post")if(responses_container.children(".p_like_failed").size()>0){removeFailedLike(responses_container);responses_container.children().slideDown();
responses_container.next(".p_comment_form").slideDown();setTimeout(function(){form_elm=responses_container.next(".p_comment_form").find("#new_comment");$("html, body").animate({scrollTop:form_elm.offset().top},500);if(form_elm.children(".p_not_authorized").size()>0)form_elm.children(".p_comment_section").children().children("#comment_name").focus();else form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()},500)}else{form_elm=responses_container.next(".p_comment_form").find("#new_comment");
$("html, body").animate({scrollTop:form_elm.offset().top},500);if(form_elm.children(".p_not_authorized").size()>0)form_elm.children(".p_comment_section").children().children("#comment_name").focus();else form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()}else{removeFailedLike(responses_container);if(responses_container.children(".p_response_container").size()>0&&responses_container.children(".p_response_container").css("display")!="none"&&
elm.parent().siblings(".p_responses_link").hasClass("active")==false)responses_container.children().slideUp();else{showLoader(responses_container);if(responses_container.children(".p_response_container").size()>0){responses_container.children().slideDown();hideLoader(responses_container);list_form=responses_container.children(".p_response_container").children(".p_comment_form").find("#new_comment");form_elm=list_form.size()==0?responses_container.next(".p_comment_form").find("#new_comment"):list_form;
$("html, body").animate({scrollTop:form_elm.offset().top},500);if(form_elm.children(".p_not_authorized").size()>0)form_elm.children(".p_comment_section").children().children("#comment_name").focus();else form_elm.children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()}else $.ajax({url:href,type:"get",dataType:"json",data:{authenticity_token:window._token},success:function(rsp){hideLoader(responses_container);responses_container.append(innerShiv(rsp.html));
responses_container.find(".p_response_container").slideDown();responses_container.find(".p_response_container").find(".p_responses_list").children().fadeIn();form_elm=responses_container.children(".p_response_container").children(".p_comment_form");FB.XFBML.parse();$("html, body").animate({scrollTop:form_elm.offset().top},500);if(form_elm.find("#new_comment").children(".p_not_authorized").size()>0)form_elm.find("#new_comment").children(".p_comment_section").children().children("#comment_name").focus();
else form_elm.find("#new_comment").children(".p_comment_section:nth-child(3)").children(".p_comment_area").children("#comment_body").focus()}})}}return false})}function responseWidgetState(){var response_link=".p_responses_link a";var like_link=".p_like_link a";var comment_link=".p_comment_link a";var show_type=$("body").attr("data-show-type")||$(".posterous_site_data").first().attr("data-show-type");if(typeof show_type!=="undefined"&&show_type=="post")$(response_link).parent().addClass("active");
$(response_link).live("click",function(){var elm=$(this);var elm_parent=elm.parent();if(elm_parent.hasClass("active")){if(show_type!=undefined&&show_type=="site")elm_parent.removeClass("active")}else elm_parent.addClass("active");if(elm_parent.siblings(".p_comment_link").children(comment_link).hasClass("active")){elm_parent.siblings(".p_comment_link").children(comment_link).removeClass("active");elm_parent.siblings(".p_comment_link").removeClass("active")}if(elm_parent.siblings(".p_like_link").hasClass("active"))elm_parent.siblings(".p_like_link").removeClass("active")});
$(comment_link).live("click",function(){var elm=$(this);var elm_parent=elm.parent();if(elm.hasClass("active")){if(show_type!=undefined&&show_type=="site"){elm.removeClass("active");elm_parent.removeClass("active")}}else{elm.addClass("active");elm_parent.addClass("active")}if(elm_parent.siblings(".p_responses_link").hasClass("active"))elm_parent.siblings(".p_responses_link").removeClass("active");if(elm_parent.siblings(".p_like_link").hasClass("active"))elm_parent.siblings(".p_like_link").removeClass("active")})}
function bindCommentForm(){$(".new_comment").find("button").live("click",function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;var button=$(this);var innerSpan=button.find("span");var elm=button.closest("form");var oldText=innerSpan.text();var responsesList=elm.find(".p_responses_list");button.addClass("loading").attr("disabled","disabled");innerSpan.html("Submitting...");if(elm.find("[data-posterous-push-to-facebook]").val()=="1"&&FB.getSession()==null)FB.login();$.ajax({type:"post",
url:elm.attr("action"),dataType:"json",data:elm.serialize(),success:function(rsp){var show_type=$("body").attr("data-show-type")||$(".posterous_site_data").first().attr("data-show-type");$(".p_no_responses").remove();container=show_type!=undefined&&show_type=="site"?elm.parent().parent():elm.parent().prev().find(".p_response_container");container.children(".p_responses_list").append(innerShiv(rsp.html));container.children(".p_responses_list").find(".p_comment:last").fadeIn();if(elm.find("[data-posterous-push-to-facebook]").size()>
0)p.publishCommentToFacebook(elm.find('[name="comment[post_id]"]').val(),elm.find("textarea").val(),elm.find("[data-posterous-push-to-facebook]").val()=="1");button.removeClass("loading").removeAttr("disabled");innerSpan.text(oldText);count_elm=container.children(".p_responses_list").parent().parent().siblings(".p_response_widget").children().children(".p_responses_link").children().children("strong");updateResponseCount(count_elm);elm[0].reset()},error:function(jqxhr){var json=$.parseJSON(jqxhr.responseText);
button.removeClass("loading").removeAttr("disabled").children().html(oldText);new ErrorBox(button.get(0),json.return_heading,json.messages[0],true,"error")}});return false});$(".new_comment").live("submit",function(e){e.preventDefault();if(window.event!==undefined)event.returnValue=false;return false})}function bindCommentFormForHotmail(){$(".new_comment").find("button").live("click",function(e){e.preventDefault();var button=$(this);var innerSpan=$(".action_button_label");var elm=button.closest("form");
var oldText=innerSpan.text();button.addClass("loading").attr("disabled","disabled");innerSpan.text("Submitting...");$.ajax({type:"post",url:elm.attr("action"),dataType:"json",data:elm.serialize(),success:function(rsp){$(rsp.html).hide().appendTo(".p_responses_list").fadeIn(function(){$(".p_responses_list").children().css("opacity","")});button.removeClass("loading").removeAttr("disabled");innerSpan.text(oldText);elm[0].reset()}});return false})}function updateResponseCount(elm){count=elm.html();new_count=
parseInt(count)+1;elm.html(new_count);header_elm=elm.parents(".p_response_widget").next().children(".p_response_container .p_view_all_link");if(header_elm)header_elm.html("View All "+new_count)}function decrementResponseCount(elm){count=count_elm.html();new_count=parseInt(count)-1;elm.html(new_count);header_elm=elm.parents(".p_response_widget").next().children(".p_response_container .p_view_all_link");if(header_elm)header_elm.html("View All "+new_count)}function loadingImageSrc(elm){return $(elm).parents(".p_responses").hasClass("dark")?
"/images/site/responses_loader_dark.gif":"/images/site/responses_loader.gif"}function addLoading(elm){$(elm).addClass("loading").append('<img src="'+loadingImageSrc(elm)+'" alt=""/>')}function removeLoading(elm){$(elm).removeClass("loading").children("img").remove()}function createLoadingDiv(elm,text){(new Image).src=loadingImageSrc(elm);if(text!=null)return'<div class="loading_comment"><div class="loading"><img src="'+loadingImageSrc(elm)+'" /><span>'+text+"...</span></div></div>";else return'<div class="loading_comment"><div class="loading"><img src="'+
loadingImageSrc(elm)+'" /><span>Loading...</span></div></div>'}function showLoader(elm,text){var loader=createLoadingDiv(elm,text);response_item=elm.siblings(".p_response_widget").children().children(".p_responses_link");response_item.children().hide();response_item.prepend(loader).show()}function hideLoader(elm){response_item=elm.siblings(".p_response_widget").children().children(".p_responses_link");response_item.children(".loading_comment").remove();response_item.children().show()}function removeFailedLike(elm){failed_elm=
elm.children(".p_like_failed");if(failed_elm.size()>0)failed_elm.remove()}$(document).ready(function(){if(window.hotmail!=true){bindResponsesLinks();bindLikeLinks();bindCommentLinks();responseWidgetState();bindActionLinks();bindTwitterLoginButton();bindFacebookTwitterPushButtons();bindCommentForm();$(".p_responses_list").children().show()}else{$.support.opacity=true;bindCommentFormForHotmail()}})};var responses=Responses($j);
var ContentParts=function($){function initializeVideoEmbeds(){if(!FlashDetect.installed){$("[data-posterous-flash-video-embed]").hide();$("[data-posterous-html5-video-embed]").show()}else{$("[data-posterous-flash-video-embed]").show();$("[data-posterous-html5-video-embed]").hide()}$("[data-posterous-html5-video-embed] video").click(function(e){this.play()})}function initializeAudioEmbeds(){if(!FlashDetect.installed){$("[data-posterous-flash-audio-embed]").hide();$("[data-posterous-html5-audio-embed]").show()}else{$("[data-posterous-flash-audio-embed]").show();
$("[data-posterous-html5-audio-embed]").hide()}}function initializeScribdEmbeds(){if(FlashDetect.installed){var scribdDoc;$('[data-posterous-scribd-embed="false"]').each(function(i){$(this).attr("id","posterous_scribd_embed_"+i);scribdDoc=scribd.Document.getDocFromUrl($(this).attr("data-posterous-url"),"pub-50214570658991172461");scribdDoc.addParam("height",600);scribdDoc.addParam("width",500);scribdDoc.addParam("public",false);scribdDoc.addParam("disable_print",1);scribdDoc.addParam("download_formats",
"");scribdDoc.addParam("disable_related_docs",1);scribdDoc.addParam("hide_disabled_buttons",1);scribdDoc.addParam("my_user_id",$(this).attr("data-posterous-user-id"));scribdDoc.write("posterous_scribd_embed_"+i);$(this).attr("data-posterous-scribd-embed","true")})}}function initializeImageGalleries(){$('[data-posterous-image-gallery][data-posterous-image-gallery-initialized="false"]').each(function(i){new PSlideGallery2($(this).get()[0],$.parseJSON(unescape($(this).attr("data-posterous-file-list"))),
$.parseJSON(unescape($(this).attr("data-posterous-options"))));$(this).attr("data-posterous-image-gallery-initialized","true")})}return{init:function(){initializeVideoEmbeds();initializeAudioEmbeds();initializeScribdEmbeds();initializeImageGalleries()}}};var contentParts=ContentParts(jQuery);$j(document).ready(function(){contentParts.init()});
var handlebars=function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,hashSegments:29,hashSegment:30,ID:31,EQUALS:32,pathSegments:33,SEP:34,$accept:0,$end:1},terminals_:{2:"error",
5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",31:"ID",32:"EQUALS",34:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[26,1],[29,2],[29,1],[30,3],[30,3],[21,1],[33,3],[33,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,
yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:this.$=new yy.ProgramNode($$[$0-2],$$[$0]);break;case 3:this.$=new yy.ProgramNode($$[$0]);break;case 4:this.$=new yy.ProgramNode([]);break;case 5:this.$=[$$[$0]];break;case 6:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 7:this.$=new yy.InverseNode($$[$0-2],$$[$0-1],$$[$0]);break;case 8:this.$=new yy.BlockNode($$[$0-2],$$[$0-1],$$[$0]);break;case 9:this.$=$$[$0];break;case 10:this.$=$$[$0];break;case 11:this.$=
new yy.ContentNode($$[$0]);break;case 12:this.$=new yy.CommentNode($$[$0]);break;case 13:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 14:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 15:this.$=$$[$0-1];break;case 16:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 17:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1],true);break;case 18:this.$=new yy.PartialNode($$[$0-1]);break;case 19:this.$=new yy.PartialNode($$[$0-2],$$[$0-1]);break;case 20:break;
case 21:this.$=[[$$[$0-2]].concat($$[$0-1]),$$[$0]];break;case 22:this.$=[[$$[$0-1]].concat($$[$0]),null];break;case 23:this.$=[[$$[$0-1]],$$[$0]];break;case 24:this.$=[[$$[$0]],null];break;case 25:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 26:this.$=[$$[$0]];break;case 27:this.$=$$[$0];break;case 28:this.$=new yy.StringNode($$[$0]);break;case 29:this.$=new yy.HashNode($$[$0]);break;case 30:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 31:this.$=[$$[$0]];break;case 32:this.$=[$$[$0-2],$$[$0]];
break;case 33:this.$=[$$[$0-2],new yy.StringNode($$[$0])];break;case 34:this.$=new yy.IdNode($$[$0]);break;case 35:$$[$0-2].push($$[$0]);this.$=$$[$0-2];break;case 36:this.$=[$$[$0]];break}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],
22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,
11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,31:[1,25],33:24},{17:26,21:23,31:[1,25],33:24},{17:27,21:23,31:[1,25],33:24},{17:28,21:23,31:[1,25],33:24},{21:29,31:[1,25],33:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,31:[1,25],33:24},{10:32,20:[1,33]},{10:34,
20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:39,30:42,31:[1,43],33:24},{18:[2,34],28:[2,34],31:[2,34],34:[1,44]},{18:[2,36],28:[2,36],31:[2,36],34:[2,36]},{18:[1,45]},{18:[1,46]},{18:[1,47]},{18:[1,48],21:49,31:[1,25],33:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,
7],24:[2,7]},{21:50,31:[1,25],33:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:51,27:52,28:[1,41],29:39,30:42,31:[1,43],33:24},{18:[2,23]},{18:[2,26],28:[2,26],31:[2,26]},{18:[2,29],30:53,31:[1,54]},{18:[2,27],28:[2,27],31:[2,27]},{18:[2,28],28:[2,28],31:[2,28]},{18:[2,31],31:[2,31]},{18:[2,36],28:[2,36],31:[2,36],32:[1,55],34:[2,36]},{31:[1,56]},{14:[2,13],
15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,57]},{18:[1,58]},{18:[2,21]},{18:[2,25],28:[2,25],31:[2,25]},{18:[2,30],31:[2,30]},{32:[1,55]},{21:59,28:[1,60],31:[1,25],33:24},{18:[2,35],28:[2,35],
31:[2,35],34:[2,35]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,32],31:[2,32]},{18:[2,33],31:[2,33]}],defaultActions:{16:[2,1],37:[2,23],51:[2,21]},parseError:function parseError(str,hash){throw new Error(str);},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=
2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;var yyloc=this.lexer.yylloc;lstack.push(yyloc);if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number")token=self.symbols_[token]||token;return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,
expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state])action=this.defaultActions[state];else{if(symbol==null)symbol=lex();action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){if(!recovering){expected=[];for(p in table[state])if(this.terminals_[p]&&p>2)expected.push("'"+this.terminals_[p]+"'");var errStr="";if(this.lexer.showPosition)errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ");
else errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'");this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}if(recovering==3){if(symbol==EOF)throw new Error(errStr||"Parsing halted.");yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;symbol=lex()}while(1){if(TERROR.toString()in table[state])break;
if(state==0)throw new Error(errStr||"Parsing halted.");popStack(1);state=stack[stack.length-1]}preErrorSymbol=symbol;symbol=TERROR;state=stack[stack.length-1];action=table[state]&&table[state][TERROR];recovering=3}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=
this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)recovering--}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};r=this.performAction.call(yyval,yytext,
yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined")return r;if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parseError)this.yy.parseError(str,
hash);else throw new Error(str);},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.match+=ch;this.matched+=ch;var lines=ch.match(/\n/);if(lines)this.yylineno++;this._input=this._input.slice(1);return ch},unput:function(ch){this._input=
ch+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20)next+=this._input.substr(0,20-next.length);return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=(new Array(pre.length+1)).join("-");return pre+
this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done)return this.EOF;if(!this._input)this.done=true;var token,match,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){match=this._input.match(this.rules[rules[i]]);if(match){lines=match[0].match(/\n.*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-
1].length-1:this.yylloc.last_column+match.length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[i],this.conditionStack[this.conditionStack.length-1]);if(token)return token;else return}}if(this._input==="")return this.EOF;else this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),
{text:"",token:null,line:this.yylineno})},lex:function lex(){var r=this.next();if(typeof r!=="undefined")return r;else return this.lex()},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:this.begin("mu");
if(yy_.yytext)return 14;break;case 1:return 14;break;case 2:return 24;break;case 3:return 16;break;case 4:return 20;break;case 5:return 19;break;case 6:return 19;break;case 7:return 23;break;case 8:return 23;break;case 9:yy_.yytext=yy_.yytext.substr(3,yy_.yyleng-5);this.begin("INITIAL");return 15;break;case 10:return 22;break;case 11:return 32;break;case 12:return 31;break;case 13:return 31;break;case 14:return 34;break;case 15:break;case 16:this.begin("INITIAL");return 18;break;case 17:this.begin("INITIAL");
return 18;break;case 18:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\"/g,'"');return 28;break;case 19:return 31;break;case 20:return"INVALID";break;case 21:return 5;break}};lexer.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{!.*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^[a-zA-Z0-9_]+(?=[=} /.])/,/^./,/^$/];lexer.conditions={mu:{rules:[2,3,4,5,6,7,8,9,10,11,12,
13,14,15,16,17,18,19,20,21],inclusive:false},INITIAL:{rules:[0,1,21],inclusive:true}};return lexer}();parser.lexer=lexer;return parser}();
if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=handlebars;exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)};exports.main=function commonjsMain(args){if(!args[1])throw new Error("Usage: "+args[0]+" FILE");if(typeof process!=="undefined")var source=require("fs").readFileSync(require("path").join(process.cwd(),args[1]),"utf8");else{var cwd=require("file").path(require("file").cwd());var source=cwd.join(args[1]).read({charset:"utf-8"})}return exports.parser.parse(source)};
if(typeof module!=="undefined"&&require.main===module)exports.main(typeof process!=="undefined"?process.argv.slice(1):require("system").args)}var Handlebars={};Handlebars.Parser=handlebars;Handlebars.parse=function(string){Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(string)};Handlebars.print=function(ast){return(new Handlebars.PrintVisitor).accept(ast)};Handlebars.Runtime={};
Handlebars.Runtime.compile=function(string){var ast=Handlebars.parse(string);return function(context,helpers,partials){helpers=helpers||Handlebars.helpers;partials=partials||Handlebars.partials;var internalContext=new Handlebars.Context(context,helpers,partials);var runtime=new Handlebars.Runtime(internalContext);runtime.accept(ast);return runtime.buffer}};Handlebars.helpers={};Handlebars.partials={};
Handlebars.registerHelper=function(name,fn,inverse){if(inverse)fn.not=inverse;this.helpers[name]=fn};Handlebars.registerPartial=function(name,str){this.partials[name]=str};
Handlebars.registerHelper("blockHelperMissing",function(context,fn,inverse){inverse=inverse||function(){};var ret="";var type=Object.prototype.toString.call(context);if(type==="[object Function]")context=context();if(context===true)return fn(this);else if(context===false||context==null)return inverse(this);else if(type==="[object Array]"){if(context.length>0)for(var i=0,j=context.length;i<j;i++)ret=ret+fn(context[i]);else ret=inverse(this);return ret}else return fn(context)},function(context,fn){return fn(context)});
Handlebars.registerHelper("each",function(context,fn,inverse){var ret="";if(context&&context.length>0)for(var i=0,j=context.length;i<j;i++)ret=ret+fn(context[i]);else ret=inverse(this);return ret});Handlebars.registerHelper("if",function(context,fn,inverse){if(!context||context==[])return inverse(this);else return fn(this)});Handlebars.registerHelper("unless",function(context,fn,inverse){return Handlebars.helpers["if"].call(this,context,inverse,fn)});
Handlebars.registerHelper("with",function(context,fn){return fn(context)});Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(level,str){}};Handlebars.log=function(level,str){Handlebars.logger.log(level,str)};
(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(statements,inverse){this.type="program";this.statements=statements;if(inverse)this.inverse=new Handlebars.AST.ProgramNode(inverse)};Handlebars.AST.MustacheNode=function(params,hash,unescaped){this.type="mustache";this.id=params[0];this.params=params.slice(1);this.hash=hash;this.escaped=!unescaped};Handlebars.AST.PartialNode=function(id,context){this.type="partial";this.id=id;this.context=context};var verifyMatch=function(open,close){if(open.original!==
close.original)throw new Handlebars.Exception(open.original+" doesn't match "+close.original);};Handlebars.AST.BlockNode=function(mustache,program,close){verifyMatch(mustache.id,close);this.type="block";this.mustache=mustache;this.program=program};Handlebars.AST.InverseNode=function(mustache,program,close){verifyMatch(mustache.id,close);this.type="inverse";this.mustache=mustache;this.program=program};Handlebars.AST.ContentNode=function(string){this.type="content";this.string=string};Handlebars.AST.HashNode=
function(pairs){this.type="hash";this.pairs=pairs};Handlebars.AST.IdNode=function(parts){this.type="ID";this.original=parts.join("/");var dig=[],depth=0;for(var i=0,l=parts.length;i<l;i++){var part=parts[i];if(part==="..")depth++;else if(part==="."||part==="this")continue;else dig.push(part)}this.parts=dig;this.depth=depth;this.isSimple=dig.length===1&&depth===0};Handlebars.AST.StringNode=function(string){this.type="STRING";this.string=string};Handlebars.AST.CommentNode=function(comment){this.type=
"comment";this.comment=comment}})();Handlebars.Visitor=function(){};Handlebars.Visitor.prototype={accept:function(object){return this[object.type](object)}};Handlebars.Exception=function(message){this.message=message};Handlebars.SafeString=function(string){this.string=string};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};
(function(){var escape={"<":"&lt;",">":"&gt;"};var badChars=/&(?!\w+;)|[<>]/g;var possible=/[&<>]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={escapeExpression:function(string){if(string instanceof Handlebars.SafeString)return string.toString();else if(string==null||string===false)return"";if(!possible.test(string))return string;return string.replace(badChars,escapeChar)},isEmpty:function(value){if(typeof value==="undefined")return true;else if(value===null)return true;
else if(value===false)return true;else if(Object.prototype.toString.call(value)==="[object Array]"&&value.length===0)return true;else return false}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};
(function(Compiler,JavaScriptCompiler){Compiler.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,invokeInverse:14,assignToHash:15};Compiler.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:1,lookup:1,invokeMustache:2,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:2,invokePartial:1,push:1,invokeInverse:1,
assignToHash:1};Compiler.DISASSEMBLE_MAP={};for(var prop in Compiler.OPCODE_MAP){var value=Compiler.OPCODE_MAP[prop];Compiler.DISASSEMBLE_MAP[value]=prop}Compiler.multiParamSize=function(code){return Compiler.MULTI_PARAM_OPCODES[Compiler.DISASSEMBLE_MAP[code]]};Compiler.prototype={disassemble:function(){var opcodes=this.opcodes,opcode,nextCode;var out=[],str,name,value;for(var i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];if(opcode==="DECLARE"){name=opcodes[++i];value=opcodes[++i];out.push("DECLARE "+
name+" = "+value)}else{str=Compiler.DISASSEMBLE_MAP[opcode];var extraParams=Compiler.multiParamSize(opcode);var codes=[];for(var j=0;j<extraParams;j++){nextCode=opcodes[++i];if(typeof nextCode==="string")nextCode='"'+nextCode.replace("\n","\\n")+'"';codes.push(nextCode)}str=str+" "+codes.join(" ");out.push(str)}}return out.join("\n")},guid:0,compile:function(program){this.children=[];this.depths={list:[]};return this.program(program)},accept:function(node){return this[node.type](node)},program:function(program){var statements=
program.statements,statement;this.opcodes=[];for(var i=0,l=statements.length;i<l;i++){statement=statements[i];this[statement.type](statement)}this.depths.list=this.depths.list.sort(function(a,b){return a-b});return this},compileProgram:function(program){var result=(new Compiler).compile(program);var guid=this.guid++;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++){depth=result.depths.list[i];if(depth<2)continue;else this.addDepth(depth-
1)}return guid},block:function(block){var mustache=block.mustache;var depth,child,inverse,inverseGuid;var params=this.setupStackForMustache(mustache);var programGuid=this.compileProgram(block.program);if(block.program.inverse){inverseGuid=this.compileProgram(block.program.inverse);this.declare("inverse",inverseGuid)}this.opcode("invokeProgram",programGuid,params.length);this.declare("inverse",null);this.opcode("append")},inverse:function(block){this.ID(block.mustache.id);var programGuid=this.compileProgram(block.program);
this.opcode("invokeInverse",programGuid);this.opcode("append")},hash:function(hash){var pairs=hash.pairs,pair,val;this.opcode("push","{}");for(var i=0,l=pairs.length;i<l;i++){pair=pairs[i];val=pair[1];this.accept(val);this.opcode("assignToHash",pair[0])}},partial:function(partial){var id=partial.id;this.usePartial=true;if(partial.context)this.ID(partial.context);else this.opcode("push","context");this.opcode("invokePartial",id.original);this.opcode("append")},content:function(content){this.opcode("appendContent",
content.string)},mustache:function(mustache){var params=this.setupStackForMustache(mustache);this.opcode("invokeMustache",params.length,mustache.id.original);if(mustache.escaped)this.opcode("appendEscaped");else this.opcode("append")},ID:function(id){this.addDepth(id.depth);this.opcode("getContext",id.depth);this.opcode("lookupWithHelpers",id.parts[0]||null);for(var i=1,l=id.parts.length;i<l;i++)this.opcode("lookup",id.parts[i])},STRING:function(string){this.opcode("pushString",string.string)},comment:function(){},
pushParams:function(params){var i=params.length,param;while(i--){param=params[i];this[param.type](param)}},opcode:function(name,val1,val2){this.opcodes.push(Compiler.OPCODE_MAP[name]);if(val1!==undefined)this.opcodes.push(val1);if(val2!==undefined)this.opcodes.push(val2)},declare:function(name,value){this.opcodes.push("DECLARE");this.opcodes.push(name);this.opcodes.push(value)},addDepth:function(depth){if(depth===0)return;if(!this.depths[depth]){this.depths[depth]=true;this.depths.list.push(depth)}},
setupStackForMustache:function(mustache){var params=mustache.params;this.pushParams(params);if(mustache.hash)this.hash(mustache.hash);else this.opcode("push","{}");this.ID(mustache.id);return params}};JavaScriptCompiler.prototype={nameLookup:function(parent,name,type){if(JavaScriptCompiler.RESERVED_WORDS[name])return parent+"['"+name+"']";else return parent+"."+name},appendToBuffer:function(string){return"buffer = buffer + "+string+";"},initializeBuffer:function(){return this.quotedString("")},compile:function(environment,
data){this.environment=environment;this.data=data;this.preamble();this.stackSlot=0;this.stackVars=[];this.registers={list:[]};this.compileChildren(environment,data);Handlebars.log(Handlebars.logger.DEBUG,environment.disassemble()+"\n\n");var opcodes=environment.opcodes,opcode,name,declareName,declareVal;this.i=0;for(l=opcodes.length;this.i<l;this.i++){opcode=this.nextOpcode(0);if(opcode[0]==="DECLARE"){this.i=this.i+2;this[opcode[1]]=opcode[2]}else{this.i=this.i+opcode[1].length;this[opcode[0]].apply(this,
opcode[1])}}return this.createFunction()},nextOpcode:function(n){var opcodes=this.environment.opcodes,opcode=opcodes[this.i+n],name,val;var extraParams,codes;if(opcode==="DECLARE"){name=opcodes[this.i+1];val=opcodes[this.i+2];return["DECLARE",name,val]}else{name=Compiler.DISASSEMBLE_MAP[opcode];extraParams=Compiler.multiParamSize(opcode);codes=[];for(var j=0;j<extraParams;j++)codes.push(opcodes[this.i+j+1+n]);return[name,codes]}},eat:function(opcode){this.i=this.i+opcode.length},preamble:function(){var out=
[];out.push("var buffer = "+this.initializeBuffer()+", currentContext = context");var copies="helpers = helpers || Handlebars.helpers;";if(this.environment.usePartial)copies=copies+" partials = partials || Handlebars.partials;";out.push(copies);this.lastContext=0;this.source=out},createFunction:function(){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,helpers,partials,data){var programWrapper=this.programs[i];
if(data)return Handlebars.VM.program(this.children[i],helpers,partials,data);else if(programWrapper)return programWrapper;else{programWrapper=this.programs[i]=Handlebars.VM.program(this.children[i],helpers,partials);return programWrapper}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};var locals=this.stackVars.concat(this.registers.list);if(locals.length>0)this.source[0]=this.source[0]+", "+locals.join(", ");this.source[0]=this.source[0]+";";this.source.push("return buffer;");
var params=["Handlebars","context","helpers","partials"];if(this.data)params.push("data");for(var i=0,l=this.environment.depths.list.length;i<l;i++)params.push("depth"+this.environment.depths.list[i]);if(params.length===4&&!this.environment.usePartial)params.pop();params.push(this.source.join("\n"));var fn=Function.apply(this,params);fn.displayName="Handlebars.js";Handlebars.log(Handlebars.logger.DEBUG,fn.toString()+"\n\n");container.render=fn;container.children=this.environment.children;return function(context,
helpers,partials,data,$depth){try{var args=Array.prototype.slice.call(arguments);args.unshift(Handlebars);return container.render.apply(container,args)}catch(e){throw e;}}},appendContent:function(content){this.source.push(this.appendToBuffer(this.quotedString(content)))},append:function(){var local=this.popStack();this.source.push("if("+local+" || "+local+" === 0) { "+this.appendToBuffer(local)+" }")},appendEscaped:function(){var opcode=this.nextOpcode(1),extra="";if(opcode[0]==="appendContent"){extra=
" + "+this.quotedString(opcode[1][0]);this.eat(opcode)}this.source.push(this.appendToBuffer("this.escapeExpression("+this.popStack()+")"+extra))},getContext:function(depth){if(this.lastContext!==depth){this.lastContext=depth;if(depth===0)this.source.push("currentContext = context;");else this.source.push("currentContext = depth"+depth+";")}},lookupWithHelpers:function(name){if(name){var topStack=this.nextStack();var toPush="if('"+name+"' in helpers) { "+topStack+" = "+this.nameLookup("helpers",name,
"helper")+"; } else { "+topStack+" = "+this.nameLookup("currentContext",name,"context")+"; }";this.source.push(toPush)}else this.pushStack("currentContext")},lookup:function(name){var topStack=this.topStack();this.source.push(topStack+" = "+this.nameLookup(topStack,name,"context")+";")},pushString:function(string){this.pushStack(this.quotedString(string))},push:function(name){this.pushStack(name)},invokeMustache:function(paramSize,original){this.populateParams(paramSize,this.quotedString(original),
"{}",null,function(nextStack,helperMissingString,id){this.source.push("else if("+id+"=== undefined) { "+nextStack+" = helpers.helperMissing.call("+helperMissingString+"); }");this.source.push("else { "+nextStack+" = "+id+"; }")})},invokeProgram:function(guid,paramSize){var inverse=this.programExpression(this.inverse);var mainProgram=this.programExpression(guid);this.populateParams(paramSize,null,mainProgram,inverse,function(nextStack,helperMissingString,id){this.source.push("else { "+nextStack+" = helpers.blockHelperMissing.call("+
helperMissingString+"); }")})},populateParams:function(paramSize,helperId,program,inverse,fn){var id=this.popStack(),nextStack;var params=[];var hash=this.popStack();for(var i=0;i<paramSize;i++){var param=this.popStack();params.push(param)}this.register("tmp1",program);this.source.push("tmp1.hash = "+hash+";");if(inverse){this.source.push("tmp1.fn = tmp1;");this.source.push("tmp1.inverse = "+inverse+";")}if(this.data)this.source.push("tmp1.data = data;");params.push("tmp1");if(inverse)params.push(inverse);
this.populateCall(params,id,helperId||id,fn)},populateCall:function(params,id,helperId,fn){var paramString=["context"].concat(params).join(", ");var helperMissingString=["context"].concat(helperId).concat(params).join(", ");nextStack=this.nextStack();this.source.push("if(typeof "+id+" === 'function') { "+nextStack+" = "+id+".call("+paramString+"); }");fn.call(this,nextStack,helperMissingString,id)},invokeInverse:function(guid){var program=this.programExpression(guid);var blockMissingParams=["context",
this.topStack(),"this.noop",program];this.pushStack("helpers.blockHelperMissing.call("+blockMissingParams.join(", ")+")")},invokePartial:function(context){this.pushStack("this.invokePartial("+this.nameLookup("partials",context,"partial")+", '"+context+"', "+this.popStack()+", helpers, partials);")},assignToHash:function(key){var value=this.popStack();var hash=this.topStack();this.source.push(hash+"['"+key+"'] = "+value+";")},compiler:JavaScriptCompiler,compileChildren:function(environment,data){var children=
environment.children,child,compiler;var compiled=[];for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler;compiled[i]=compiler.compile(child,data)}environment.rawChildren=children;environment.children=compiled},programExpression:function(guid){if(guid==null)return"this.noop";var programParams=[guid,"helpers","partials"];var depths=this.environment.rawChildren[guid].depths.list;if(this.data)programParams.push("data");for(var i=0,l=depths.length;i<l;i++){depth=depths[i];
if(depth===1)programParams.push("context");else programParams.push("depth"+(depth-1))}if(!this.environment.usePartial)if(programParams[3])programParams[2]="null";else programParams.pop();if(depths.length===0)return"this.program("+programParams.join(", ")+")";else{programParams[0]="this.children["+guid+"]";return"this.programWithDepth("+programParams.join(", ")+")"}},register:function(name,val){this.useRegister(name);this.source.push(name+" = "+val+";")},useRegister:function(name){if(!this.registers[name]){this.registers[name]=
true;this.registers.list.push(name)}},pushStack:function(item){this.source.push(this.nextStack()+" = "+item+";");return"stack"+this.stackSlot},nextStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length)this.stackVars.push("stack"+this.stackSlot);return"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(str){return'"'+str.replace(/\\/,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,
"\\r")+'"'}};var reservedWords=("break case catch continue default delete do else finally "+"for function if in instanceof new return switch this throw "+"try typeof var void while with null true false").split(" ");compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++)compilerWords[reservedWords[i]]=true})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);
Handlebars.VM={programWithDepth:function(fn){var args=Array.prototype.slice.call(arguments,1);return function(context,helpers,partials,data){args[0]=helpers||args[0];args[1]=partials||args[1];args[2]=data||args[2];return fn.apply(this,[context].concat(args))}},program:function(fn,helpers,partials,data){return function(context,h2,p2,d2){return fn(context,h2||helpers,p2||partials,d2||data)}},noop:function(){return""},compile:function(string,data){var ast=Handlebars.parse(string);var environment=(new Handlebars.Compiler).compile(ast);
return(new Handlebars.JavaScriptCompiler).compile(environment,data)},invokePartial:function(partial,name,context,helpers,partials){if(partial===undefined)throw new Handlebars.Exception("The partial "+name+" could not be found");else if(partial instanceof Function)return partial(context,helpers,partials);else{partials[name]=Handlebars.VM.compile(partial);return partials[name](context,helpers,partials)}}};Handlebars.compile=Handlebars.VM.compile;
(function($){$.Class.extend("Modal",{openModals:[],currentModal:function(){if(this.openModals.length)return this.openModals[0];else return null}},{extractArgs:function(linkOrUrl,options){if(typeof linkOrUrl==="string")this.url=linkOrUrl;else{this.link=linkOrUrl;this.url=this.link.attr("href")}this.options=options||{}},init:function(linkOrUrl,options){this.extractArgs(linkOrUrl,options);var top=$(document).scrollTop()+200;this.modal=$("body").append(Modal.template({})).find('[data-posterous-modal-container="true"]').last().get();
$(this.modal).css({"padding-top":top});this.transmit();$(this.modal).click($.proxy(this.closeUnlessClickedInsideWindow,this));Modal.openModals.push(this)},transmit:function(){$.jsonp({url:this.url,data:{format:"modal"},success:$.proxy(this.onSuccess,this),error:$.proxy(this.onError,this)})},showLoader:function(){$(this.modal).find(".p_modal_contents").css({visibility:"hidden"});$(this.modal).find(".p_modal_loading").show()},hideLoader:function(){$(this.modal).find(".p_modal_loading").hide();$(this.modal).find(".p_modal_contents").css({visibility:"visible"})},
closeUnlessClickedInsideWindow:function(event){if(event.target==event.currentTarget||$(event.target).closest(".p_modal_close").length){event.preventDefault();this.close()}},onSuccess:function(data){$(this.modal).find(".p_modal_title h1").text(data.title);var contents=$(unescape(data.contents)).hide().appendTo($(this.modal).find(".p_modal_contents"));var width=contents.outerWidth()+40;var height=contents.outerHeight()+47+40;$(this.modal).find(".p_modal_inner").animate({width:width+"px",height:height+
"px"},{complete:$.proxy(function(){this.hideLoader();contents.show();if(this.link)this.link.triggerHandler("modal:success",this);if(typeof this.options["onSuccess"]==="function")this.options["onSuccess"](this);$(this.modal).find(".p_modal_inner").css({height:"auto"})},this)})},onError:function(data){this.hideLoader();$(this.modal).find(".p_modal_contents").html('Something went wrong. Please try again, or email us at <a href="mailto:help@posterous.com">help@posterous.com.</a>');if(this.link)this.link.trigger("modal:failure");
if(typeof this.options["onFailure"]==="function")this.options["onFailure"](this)},close:function(){var index=$.inArray(this,this.Class.openModals);if(index!=-1)this.Class.openModals.splice(index,1);$(this.modal).hide().remove()}});Modal.extend("SubModal",{init:function(linkOrUrl,options){this.extractArgs(linkOrUrl,options);$("div.p_submodal").remove();$("div.p_modal_main").append(Modal.sub_template({}));var outer_width=$("div.p_modal_main").outerWidth();var submodal_width=0.66*outer_width;var offset=
(outer_width-submodal_width)/2;$("div.p_submodal").css("left",offset+"px");$("div.p_submodal_inner").css("width",submodal_width+"px");$("div.p_submodal").hide();$("div.p_submodal").show("slide",{direction:"up"});this.transmit()},onSuccess:function(data){$("div.p_modal_loading").hide();$("div.p_submodal_contents").prepend(unescape(data.contents));var targetHeight=$(".p_submodal_contents").outerHeight();$(".p_submodal .p_submodal_inner").animate({height:targetHeight+"px"});if(this.link)this.link.triggerHandler("submodal:success",
this)}});$(function(){$.get("/javascripts/views/modal.html.handlebars",function(data){Modal.template=Handlebars.compile(data)});$.get("/javascripts/views/submodal.html.handlebars",function(data){Modal.sub_template=Handlebars.compile(data)});$("body").delegate('a[data-posterous-modal="true"]',"click",function(e){e.preventDefault();new Modal($(this))});$("body").delegate('a[data-posterous-submodal="true"]',"click",function(e){e.preventDefault();new SubModal($(this))});$("body").delegate('a[data-posterous-submodal-close="true"]',
"click",function(e){e.preventDefault();$("div.p_submodal").hide("slide",{direction:"up"})})})})(jQuery);
(function($){$.Class.extend("Map",{maps:[]},{init:function(mapDiv){this.mapDiv=$(mapDiv);var options={zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMAL},mapTypeControl:false,streetViewControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,size:new google.maps.Size(300,150)};var latLngs=$.parseJSON(this.mapDiv.attr("data-posterous-lat-lngs"));if(latLngs.length==0)return;latLngs=$.map(latLngs,function(e,i){return new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))});
this.bounds=new google.maps.LatLngBounds;this.googleMap=new google.maps.Map(document.getElementById(this.mapDiv.attr("id")),options);for(i=0;i<latLngs.length;i++){new google.maps.Marker({position:latLngs[i],map:this.googleMap});this.bounds.extend(latLngs[i])}this.googleMap.fitBounds(this.bounds);if(this.googleMap.zoom!=undefined)this.resize()},resize:function(){google.maps.event.trigger(this.googleMap,"resize");this.googleMap.fitBounds(this.bounds);this.googleMap.setZoom(Math.min(this.googleMap.zoom,
parseInt(this.mapDiv.attr("data-posterous-max-zoom"),10)))}});$(function(){$('[data-posterous-map="true"]').each(function(e){$(this).attr("id","map_"+Math.floor(Math.random()*1E3));Map.maps.push(new Map($(this)));$("body").bind("show-on-click:finished",function(){$.each(Map.maps,function(i,e){e.resize()})})})})})(jQuery);
(function($,window){var Sammy,PATH_REPLACER="([^/]+)",PATH_NAME_MATCHER=/:([\w\d]+)/g,QUERY_STRING_MATCHER=/\?([^#]*)$/,_makeArray=function(nonarray){return Array.prototype.slice.call(nonarray)},_isFunction=function(obj){return Object.prototype.toString.call(obj)==="[object Function]"},_isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]"},_decode=decodeURIComponent,_encode=encodeURIComponent,_escapeHTML=function(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,
"&gt;")},_routeWrapper=function(verb){return function(path,callback){return this.route.apply(this,[verb,path,callback])}},_template_cache={},loggers=[];Sammy=function(){var args=_makeArray(arguments),app,selector;Sammy.apps=Sammy.apps||{};if(args.length===0||args[0]&&_isFunction(args[0]))return Sammy.apply(Sammy,["body"].concat(args));else if(typeof(selector=args.shift())=="string"){app=Sammy.apps[selector]||new Sammy.Application;app.element_selector=selector;if(args.length>0)$.each(args,function(i,
plugin){app.use(plugin)});if(app.element_selector!=selector)delete Sammy.apps[selector];Sammy.apps[app.element_selector]=app;return app}};Sammy.VERSION="0.6.2";Sammy.addLogger=function(logger){loggers.push(logger)};Sammy.log=function(){var args=_makeArray(arguments);args.unshift("["+Date()+"]");$.each(loggers,function(i,logger){logger.apply(Sammy,args)})};if(typeof window.console!="undefined")if(_isFunction(window.console.log.apply))Sammy.addLogger(function(){window.console.log.apply(window.console,
arguments)});else Sammy.addLogger(function(){window.console.log(arguments)});else if(typeof console!="undefined")Sammy.addLogger(function(){console.log.apply(console,arguments)});$.extend(Sammy,{makeArray:_makeArray,isFunction:_isFunction,isArray:_isArray});Sammy.Object=function(obj){return $.extend(this,obj||{})};$.extend(Sammy.Object.prototype,{escapeHTML:_escapeHTML,h:_escapeHTML,toHash:function(){var json={};$.each(this,function(k,v){if(!_isFunction(v))json[k]=v});return json},toHTML:function(){var display=
"";$.each(this,function(k,v){if(!_isFunction(v))display+="<strong>"+k+"</strong> "+v+"<br />"});return display},keys:function(attributes_only){var keys=[];for(var property in this)if(!_isFunction(this[property])||!attributes_only)keys.push(property);return keys},has:function(key){return this[key]&&$.trim(this[key].toString())!=""},join:function(){var args=_makeArray(arguments);var delimiter=args.shift();return args.join(delimiter)},log:function(){Sammy.log.apply(Sammy,arguments)},toString:function(include_functions){var s=
[];$.each(this,function(k,v){if(!_isFunction(v)||include_functions)s.push('"'+k+'": '+v.toString())});return"Sammy.Object: {"+s.join(",")+"}"}});Sammy.HashLocationProxy=function(app,run_interval_every){this.app=app;this.is_native=false;this._startPolling(run_interval_every)};Sammy.HashLocationProxy.prototype={bind:function(){var proxy=this,app=this.app;$(window).bind("hashchange."+this.app.eventNamespace(),function(e,non_native){if(proxy.is_native===false&&!non_native){Sammy.log("native hash change exists, using");
proxy.is_native=true;window.clearInterval(Sammy.HashLocationProxy._interval)}app.trigger("location-changed")});if(!Sammy.HashLocationProxy._bindings)Sammy.HashLocationProxy._bindings=0;Sammy.HashLocationProxy._bindings++},unbind:function(){$(window).unbind("hashchange."+this.app.eventNamespace());Sammy.HashLocationProxy._bindings--;if(Sammy.HashLocationProxy._bindings<=0)window.clearInterval(Sammy.HashLocationProxy._interval)},getLocation:function(){var matches=window.location.toString().match(/^[^#]*(#.+)$/);
return matches?matches[1]:""},setLocation:function(new_location){return window.location=new_location},_startPolling:function(every){var proxy=this;if(!Sammy.HashLocationProxy._interval){if(!every)every=10;var hashCheck=function(){var current_location=proxy.getLocation();if(!Sammy.HashLocationProxy._last_location||current_location!=Sammy.HashLocationProxy._last_location)window.setTimeout(function(){$(window).trigger("hashchange",[true])},13);Sammy.HashLocationProxy._last_location=current_location};
hashCheck();Sammy.HashLocationProxy._interval=window.setInterval(hashCheck,every)}}};Sammy.Application=function(app_function){var app=this;this.routes={};this.listeners=new Sammy.Object({});this.arounds=[];this.befores=[];this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1E3,10);this.context_prototype=function(){Sammy.EventContext.apply(this,arguments)};this.context_prototype.prototype=new Sammy.EventContext;if(_isFunction(app_function))app_function.apply(this,[this]);if(!this._location_proxy)this.setLocationProxy(new Sammy.HashLocationProxy(this,
this.run_interval_every));if(this.debug)this.bindToAllEvents(function(e,data){app.log(app.toString(),e.cleaned_type,data||{})})};Sammy.Application.prototype=$.extend({},Sammy.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:false,element_selector:"body",debug:false,
raise_errors:false,run_interval_every:50,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(selector){return selector?$(this.element_selector).find(selector):$(this.element_selector)},use:function(){var args=_makeArray(arguments),plugin=args.shift(),plugin_name=plugin||"";try{args.unshift(this);if(typeof plugin=="string"){plugin_name="Sammy."+plugin;plugin=Sammy[plugin]}plugin.apply(this,args)}catch(e){if(typeof plugin==="undefined")this.error("Plugin Error: called use() but plugin ("+
plugin_name.toString()+") is not defined",e);else if(!_isFunction(plugin))this.error("Plugin Error: called use() but '"+plugin_name.toString()+"' is not a function",e);else this.error("Plugin Error",e)}return this},setLocationProxy:function(new_proxy){var original_proxy=this._location_proxy;this._location_proxy=new_proxy;if(this.isRunning()){if(original_proxy)original_proxy.unbind();this._location_proxy.bind()}},route:function(verb,path,callback){var app=this,param_names=[],add_route,path_match;if(!callback&&
_isFunction(path)){path=verb;callback=path;verb="any"}verb=verb.toLowerCase();if(path.constructor==String){PATH_NAME_MATCHER.lastIndex=0;while((path_match=PATH_NAME_MATCHER.exec(path))!==null)param_names.push(path_match[1]);path=new RegExp("^"+path.replace(PATH_NAME_MATCHER,PATH_REPLACER)+"$")}if(typeof callback=="string")callback=app[callback];add_route=function(with_verb){var r={verb:with_verb,path:path,callback:callback,param_names:param_names};app.routes[with_verb]=app.routes[with_verb]||[];app.routes[with_verb].push(r)};
if(verb==="any")$.each(this.ROUTE_VERBS,function(i,v){add_route(v)});else add_route(verb);return this},get:_routeWrapper("get"),post:_routeWrapper("post"),put:_routeWrapper("put"),del:_routeWrapper("delete"),any:_routeWrapper("any"),mapRoutes:function(route_array){var app=this;$.each(route_array,function(i,route_args){app.route.apply(app,route_args)});return this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(name,data,callback){var app=this;if(typeof callback==
"undefined")callback=data;var listener_callback=function(){var e,context,data;e=arguments[0];data=arguments[1];if(data&&data.context){context=data.context;delete data.context}else context=new app.context_prototype(app,"bind",e.type,data,e.target);e.cleaned_type=e.type.replace(app.eventNamespace(),"");callback.apply(context,[e,data])};if(!this.listeners[name])this.listeners[name]=[];this.listeners[name].push(listener_callback);if(this.isRunning())this._listen(name,listener_callback);return this},trigger:function(name,
data){this.$element().trigger([name,this.eventNamespace()].join("."),[data]);return this},refresh:function(){this.last_location=null;this.trigger("location-changed");return this},before:function(options,callback){if(_isFunction(options)){callback=options;options={}}this.befores.push([options,callback]);return this},after:function(callback){return this.bind("event-context-after",callback)},around:function(callback){this.arounds.push(callback);return this},isRunning:function(){return this._running},
helpers:function(extensions){$.extend(this.context_prototype.prototype,extensions);return this},helper:function(name,method){this.context_prototype.prototype[name]=method;return this},run:function(start_url){if(this.isRunning())return false;var app=this;$.each(this.listeners.toHash(),function(name,callbacks){$.each(callbacks,function(i,listener_callback){app._listen(name,listener_callback)})});this.trigger("run",{start_url:start_url});this._running=true;this.last_location=null;if(this.getLocation()==
""&&typeof start_url!="undefined")this.setLocation(start_url);this._checkLocation();this._location_proxy.bind();this.bind("location-changed",function(){app._checkLocation()});this.bind("submit",function(e){var returned=app._checkFormSubmission($(e.target).closest("form"));return returned===false?e.preventDefault():false});$(window).bind("beforeunload",function(){app.unload()});return this.trigger("changed")},unload:function(){if(!this.isRunning())return false;var app=this;this.trigger("unload");this._location_proxy.unbind();
this.$element().unbind("submit").removeClass(app.eventNamespace());$.each(this.listeners.toHash(),function(name,listeners){$.each(listeners,function(i,listener_callback){app._unlisten(name,listener_callback)})});this._running=false;return this},bindToAllEvents:function(callback){var app=this;$.each(this.APP_EVENTS,function(i,e){app.bind(e,callback)});$.each(this.listeners.keys(true),function(i,name){if(app.APP_EVENTS.indexOf(name)==-1)app.bind(name,callback)});return this},routablePath:function(path){return path.replace(QUERY_STRING_MATCHER,
"")},lookupRoute:function(verb,path){var app=this,routed=false;this.trigger("lookup-route",{verb:verb,path:path});if(typeof this.routes[verb]!="undefined")$.each(this.routes[verb],function(i,route){if(app.routablePath(path).match(route.path)){routed=route;return false}});return routed},runRoute:function(verb,path,params,target){var app=this,route=this.lookupRoute(verb,path),context,wrapped_route,arounds,around,befores,before,callback_args,path_params,final_returned;this.log("runRoute",[verb,path].join(" "));
this.trigger("run-route",{verb:verb,path:path,params:params});if(typeof params=="undefined")params={};$.extend(params,this._parseQueryString(path));if(route){this.trigger("route-found",{route:route});if((path_params=route.path.exec(this.routablePath(path)))!==null){path_params.shift();$.each(path_params,function(i,param){if(route.param_names[i])params[route.param_names[i]]=_decode(param);else{if(!params.splat)params.splat=[];params.splat.push(_decode(param))}})}context=new this.context_prototype(this,
verb,path,params,target);arounds=this.arounds.slice(0);befores=this.befores.slice(0);callback_args=[context].concat(params.splat);wrapped_route=function(){var returned;while(befores.length>0){before=befores.shift();if(app.contextMatchesOptions(context,before[0])){returned=before[1].apply(context,[context]);if(returned===false)return false}}app.last_route=route;context.trigger("event-context-before",{context:context});returned=route.callback.apply(context,callback_args);context.trigger("event-context-after",
{context:context});return returned};$.each(arounds.reverse(),function(i,around){var last_wrapped_route=wrapped_route;wrapped_route=function(){return around.apply(context,[last_wrapped_route])}});try{final_returned=wrapped_route()}catch(e){this.error(["500 Error",verb,path].join(" "),e)}return final_returned}else return this.notFound(verb,path)},contextMatchesOptions:function(context,match_options,positive){var options=match_options;if(typeof options==="undefined"||options=={})return true;if(typeof positive===
"undefined")positive=true;if(typeof options==="string"||_isFunction(options.test))options={path:options};if(options.only)return this.contextMatchesOptions(context,options.only,true);else if(options.except)return this.contextMatchesOptions(context,options.except,false);var path_matched=true,verb_matched=true;if(options.path)if(_isFunction(options.path.test))path_matched=options.path.test(context.path);else path_matched=options.path.toString()===context.path;if(options.verb)verb_matched=options.verb===
context.verb;return positive?verb_matched&&path_matched:!(verb_matched&&path_matched)},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(new_location){return this._location_proxy.setLocation(new_location)},swap:function(content){return this.$element().html(content)},templateCache:function(key,value){if(typeof value!="undefined")return _template_cache[key]=value;else return _template_cache[key]},clearTemplateCache:function(){return _template_cache={}},notFound:function(verb,
path){var ret=this.error(["404 Not Found",verb,path].join(" "));return verb==="get"?ret:true},error:function(message,original_error){if(!original_error)original_error=new Error;original_error.message=[message,original_error.message].join(" ");this.trigger("error",{message:original_error.message,error:original_error});if(this.raise_errors)throw original_error;else this.log(original_error.message,original_error)},_checkLocation:function(){var location,returned;location=this.getLocation();if(!this.last_location||
this.last_location[0]!="get"||this.last_location[1]!=location){this.last_location=["get",location];returned=this.runRoute("get",location)}return returned},_getFormVerb:function(form){var $form=$(form),verb,$_method;$_method=$form.find('input[name="_method"]');if($_method.length>0)verb=$_method.val();if(!verb)verb=$form[0].getAttribute("method");return $.trim(verb.toString().toLowerCase())},_checkFormSubmission:function(form){var $form,path,verb,params,returned;this.trigger("check-form-submission",
{form:form});$form=$(form);path=$form.attr("action");verb=this._getFormVerb($form);if(!verb||verb=="")verb="get";this.log("_checkFormSubmission",$form,path,verb);if(verb==="get"){this.setLocation(path+"?"+this._serializeFormParams($form));returned=false}else{params=$.extend({},this._parseFormParams($form));returned=this.runRoute(verb,path,params,form.get(0))}return typeof returned=="undefined"?false:returned},_serializeFormParams:function($form){var queryString="",fields=$form.serializeArray(),i;
if(fields.length>0){queryString=this._encodeFormPair(fields[0].name,fields[0].value);for(i=1;i<fields.length;i++)queryString=queryString+"&"+this._encodeFormPair(fields[i].name,fields[i].value)}return queryString},_encodeFormPair:function(name,value){return _encode(name)+"="+_encode(value)},_parseFormParams:function($form){var params={},form_fields=$form.serializeArray(),i;for(i=0;i<form_fields.length;i++)params=this._parseParamPair(params,form_fields[i].name,form_fields[i].value);return params},
_parseQueryString:function(path){var params={},parts,pairs,pair,i;parts=path.match(QUERY_STRING_MATCHER);if(parts){pairs=parts[1].split("&");for(i=0;i<pairs.length;i++){pair=pairs[i].split("=");params=this._parseParamPair(params,_decode(pair[0]),_decode(pair[1]))}}return params},_parseParamPair:function(params,key,value){if(params[key])if(_isArray(params[key]))params[key].push(value);else params[key]=[params[key],value];else params[key]=value;return params},_listen:function(name,callback){return this.$element().bind([name,
this.eventNamespace()].join("."),callback)},_unlisten:function(name,callback){return this.$element().unbind([name,this.eventNamespace()].join("."),callback)}});Sammy.RenderContext=function(event_context){this.event_context=event_context;this.callbacks=[];this.previous_content=null;this.content=null;this.next_engine=false;this.waiting=false};Sammy.RenderContext.prototype=$.extend({},Sammy.Object.prototype,{then:function(callback){if(!_isFunction(callback))if(typeof callback==="string"&&callback in
this.event_context){var helper=this.event_context[callback];callback=function(content){return helper.apply(this.event_context,[content])}}else return this;var context=this;if(this.waiting)this.callbacks.push(callback);else{this.wait();window.setTimeout(function(){var returned=callback.apply(context,[context.content,context.previous_content]);if(returned!==false)context.next(returned)},13)}return this},wait:function(){this.waiting=true},next:function(content){this.waiting=false;if(typeof content!==
"undefined"){this.previous_content=this.content;this.content=content}if(this.callbacks.length>0)this.then(this.callbacks.shift())},load:function(location,options,callback){var context=this;return this.then(function(){var should_cache,cached,is_json,location_array;if(_isFunction(options)){callback=options;options={}}else options=$.extend({},options);if(callback)this.then(callback);if(typeof location==="string"){is_json=location.match(/\.json$/)||options.json;should_cache=is_json&&options.cache===true||
options.cache!==false;context.next_engine=context.event_context.engineFor(location);delete options.cache;delete options.json;if(options.engine){context.next_engine=options.engine;delete options.engine}if(should_cache&&(cached=this.event_context.app.templateCache(location)))return cached;this.wait();$.ajax($.extend({url:location,data:{},dataType:is_json?"json":null,type:"get",success:function(data){if(should_cache)context.event_context.app.templateCache(location,data);context.next(data)}},options));
return false}else{if(location.nodeType)return location.innerHTML;if(location.selector){context.next_engine=location.attr("data-engine");if(options.clone===false)return location.remove()[0].innerHTML.toString();else return location[0].innerHTML.toString()}}})},render:function(location,data,callback){if(_isFunction(location)&&!data)return this.then(location);else{if(!data&&this.content)data=this.content;return this.load(location).interpolate(data,location).then(callback)}},partial:function(location,
data){return this.render(location,data).swap()},send:function(){var context=this,args=_makeArray(arguments),fun=args.shift();if(_isArray(args[0]))args=args[0];return this.then(function(content){args.push(function(response){context.next(response)});context.wait();fun.apply(fun,args);return false})},collect:function(array,callback,now){var context=this;var coll=function(){if(_isFunction(array)){callback=array;array=this.content}var contents=[],doms=false;$.each(array,function(i,item){var returned=callback.apply(context,
[i,item]);if(returned.jquery&&returned.length==1){returned=returned[0];doms=true}contents.push(returned);return returned});return doms?contents:contents.join("")};return now?coll():this.then(coll)},renderEach:function(location,name,data,callback){if(_isArray(name)){callback=data;data=name;name=null}return this.load(location).then(function(content){var rctx=this;if(!data)data=_isArray(this.previous_content)?this.previous_content:[];if(callback)$.each(data,function(i,value){var idata={},engine=this.next_engine||
location;name?idata[name]=value:idata=value;callback(value,rctx.event_context.interpolate(content,idata,engine))});else return this.collect(data,function(i,value){var idata={},engine=this.next_engine||location;name?idata[name]=value:idata=value;return this.event_context.interpolate(content,idata,engine)},true)})},interpolate:function(data,engine,retain){var context=this;return this.then(function(content,prev){if(!data&&prev)data=prev;if(this.next_engine){engine=this.next_engine;this.next_engine=false}var rendered=
context.event_context.interpolate(content,data,engine);return retain?prev+rendered:rendered})},swap:function(){return this.then(function(content){this.event_context.swap(content)}).trigger("changed",{})},appendTo:function(selector){return this.then(function(content){$(selector).append(content)}).trigger("changed",{})},prependTo:function(selector){return this.then(function(content){$(selector).prepend(content)}).trigger("changed",{})},replace:function(selector){return this.then(function(content){$(selector).html(content)}).trigger("changed",
{})},trigger:function(name,data){return this.then(function(content){if(typeof data=="undefined")data={content:content};this.event_context.trigger(name,data)})}});Sammy.EventContext=function(app,verb,path,params,target){this.app=app;this.verb=verb;this.path=path;this.params=new Sammy.Object(params);this.target=target};Sammy.EventContext.prototype=$.extend({},Sammy.Object.prototype,{$element:function(){return this.app.$element(_makeArray(arguments).shift())},engineFor:function(engine){var context=this,
engine_match;if(_isFunction(engine))return engine;engine=engine.toString();if(engine_match=engine.match(/\.([^\.]+)$/))engine=engine_match[1];if(engine&&_isFunction(context[engine]))return context[engine];if(context.app.template_engine)return this.engineFor(context.app.template_engine);return function(content,data){return content}},interpolate:function(content,data,engine){return this.engineFor(engine).apply(this,[content,data])},render:function(location,data,callback){return(new Sammy.RenderContext(this)).render(location,
data,callback)},renderEach:function(location,name,data,callback){return(new Sammy.RenderContext(this)).renderEach(location,name,data,callback)},load:function(location,options,callback){return(new Sammy.RenderContext(this)).load(location,options,callback)},partial:function(location,data){return(new Sammy.RenderContext(this)).partial(location,data)},send:function(){var rctx=new Sammy.RenderContext(this);return rctx.send.apply(rctx,arguments)},redirect:function(){var to,args=_makeArray(arguments),current_location=
this.app.getLocation();if(args.length>1){args.unshift("/");to=this.join.apply(this,args)}else to=args[0];this.trigger("redirect",{to:to});this.app.last_location=[this.verb,this.path];this.app.setLocation(to);if(current_location==to)this.app.trigger("location-changed")},trigger:function(name,data){if(typeof data=="undefined")data={};if(!data.context)data.context=this;return this.app.trigger(name,data)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(contents){return this.app.swap(contents)},
notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(string){return $.parseJSON(string)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}});$.sammy=window.Sammy=Sammy})(jQuery,window);
(function($){$.fn.swipe=function(options){var defaults={threshold:{x:30,y:10},swipeLeft:function(){alert("swiped left")},swipeRight:function(){alert("swiped right")}};var options=$.extend(defaults,options);if(!this)return false;return this.each(function(){var me=$(this);var originalCoord={x:0,y:0};var finalCoord={x:0,y:0};function touchStart(event){originalCoord.x=event.targetTouches[0].pageX;originalCoord.y=event.targetTouches[0].pageY}function touchMove(event){event.preventDefault();finalCoord.x=
event.targetTouches[0].pageX;finalCoord.y=event.targetTouches[0].pageY}function touchEnd(event){var changeY=originalCoord.y-finalCoord.y;if(changeY<defaults.threshold.y&&changeY>defaults.threshold.y*-1){changeX=originalCoord.x-finalCoord.x;if(changeX>defaults.threshold.x)defaults.swipeLeft();if(changeX<defaults.threshold.x*-1)defaults.swipeRight()}}function touchStart(event){originalCoord.x=event.targetTouches[0].pageX;originalCoord.y=event.targetTouches[0].pageY;finalCoord.x=originalCoord.x;finalCoord.y=
originalCoord.y}function touchCancel(event){}this.addEventListener("touchstart",touchStart,false);this.addEventListener("touchmove",touchMove,false);this.addEventListener("touchend",touchEnd,false);this.addEventListener("touchcancel",touchCancel,false)})}})(jQuery);$j(function(){slideshow.run();$j(".posterousHeaderActions a.slideshow").live("click",function(e){e.preventDefault();slideshow.setLocation("#!/slideshow")})});
var slideshow=$j.sammy(function(){this.get("#!/",function(){this.log("slideshows")});this.get("#!/slideshow",function(){if($j(".posterous_site_data").length>0){var show_type=$j(".posterous_site_data").first().attr("data-show-type");var site_type=$j(".posterous_site_data").first().attr("data-site-type");var site_id=$j(".posterous_site_data").first().attr("data-site-id");var user_id=$j(".posterous_site_data").first().attr("data-user-id");var post_id=$j(".posterous_site_data").first().attr("data-post-id")}else{var show_type=
$j("body").attr("data-show-type")||$j("body").attr("data-show_type")||window.show_type;var site_type=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type;var site_id=$j("body").attr("data-site-id")||$j("body").attr("data-site_id")||window.site_id;var user_id=$j("body").attr("data-user-id")||$j("body").attr("data-admin_id")||window.user_id;var post_id=$j("body").attr("data-post-id")||window.post_id}if(site_type!="group")if($j("#whole_site").length==0){this.log("running sitewide");
slides=new startSlideshow({show_type:show_type,site_type:site_type,post_id:post_id,site_id:site_id,user_id:user_id,image_list:null,current_image:null,autoplay:true})}});this.get("#!/:slug/slideshow",function(){if($j(".posterous_site_data").length>0){var show_type=$j(".posterous_site_data").first().attr("data-show-type");var site_type=$j(".posterous_site_data").first().attr("data-site-type");var site_id=$j(".posterous_site_data").first().attr("data-site-id");var user_id=$j(".posterous_site_data").first().attr("data-user-id");
var post_id=$j(".posterous_site_data").first().attr("data-post-id")}else{var show_type=$j("body").attr("data-show-type")||$j("body").attr("data-show_type")||window.show_type;var site_type=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type;var site_id=$j("body").attr("data-site-id")||$j("body").attr("data-site_id")||window.site_id;var user_id=$j("body").attr("data-user-id")||$j("body").attr("data-admin_id")||window.user_id;var post_id=$j("body").attr("data-post-id")||
window.post_id}if(site_type!="group")if(post_id!=undefined||$j("#this_post")==undefined||$j("#this_post")!=undefined&&!$j("#this_post").hasClass("clicked")){this.log("running post slides");this.redirect("/"+this.params.slug+"/#!/slideshow")}});this.get("#!/private/:slug/slideshow",function(){if($j(".posterous_site_data").length>0){var show_type=$j(".posterous_site_data").first().attr("data-show-type");var site_type=$j(".posterous_site_data").first().attr("data-site-type");var site_id=$j(".posterous_site_data").first().attr("data-site-id");
var user_id=$j(".posterous_site_data").first().attr("data-user-id");var post_id=$j(".posterous_site_data").first().attr("data-post-id")}else{var show_type=$j("body").attr("data-show-type")||$j("body").attr("data-show_type")||window.show_type;var site_type=$j("body").attr("data-site-type")||$j("body").attr("data-site_type")||window.site_type;var site_id=$j("body").attr("data-site-id")||$j("body").attr("data-site_id")||window.site_id;var user_id=$j("body").attr("data-user-id")||$j("body").attr("data-admin_id")||
window.user_id;var post_id=$j("body").attr("data-post-id")||window.post_id}if(site_type!="group")if(post_id!=undefined||$j("#this_post")==undefined||$j("#this_post")!=undefined&&!$j("#this_post").hasClass("clicked")){this.log("running post slides");this.redirect("/private/"+this.params.slug+"/#!/slideshow")}});this.get("#!/:slug",function(){this.log("route for "+this.params.slug)})});
Prototype.Browser.IE6=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6;Prototype.Browser.IE7=Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7;Prototype.Browser.IE8=Prototype.Browser.IE&&!Prototype.Browser.IE6&&!Prototype.Browser.IE7;var slideshowTimer;var currentPages=[];var currentPage=null;var currentSlideLength=null;var pageAttempts=0;var image_post_ids=[];var image_sources=[];
var slideCount=0;var windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;
var startSlideshow=Class.create({initialize:function(options){this.show_type=options["show_type"];this.site_type=options["site_type"];this.current_image=options["current_image"];this.image_list=options["image_list"];this.user_id=options["user_id"];this.site_id=options["site_id"];this.post_id=options["post_id"];this.thread_id=options["thread_id"];this.reply_ids=options["reply_ids"];this.slug=options["slug"];this.autoplay=options["autoplay"];this.setupPostSlideshow();if(this.site_type!=undefined&&this.show_type==
"thread"){$("this_thread").addClassName("clicked");var slidesetupTimer=setTimeout(function(){if(this.current_image!=null){this.insertThreadSlides();this.insertThreadReplySlides();this.startThreadSlides()}else{this.insertThreadSlides();this.insertThreadReplySlides()}this.setupSlideControls()}.bind(this),1E3)}else if(this.show_type=="site"||this.show_type=="group"&&this.site_type=="group")var slidesetupTimer=setTimeout(function(){this.insertSiteSlides();this.setupSlideControls()}.bind(this),1E3);else if(this.show_type==
"post"&&this.current_image!=null&&this.image_list!=null){$("this_post").addClassName("clicked");var slidesetupTimer=setTimeout(function(){this.insertPostSlides();this.startPostSlides();this.setupSlideControls()}.bind(this),250)}else if(this.show_type=="post"&&this.current_image==null&&this.image_list==null){$("this_post").addClassName("clicked");$("whole_site").addClassName("clicked");var slidesetupTimer=setTimeout(function(){this.insertPostSlides();this.setupSlideControls()}.bind(this),1E3)}this.boundKeyboardSlides=
this.keyboardSlides.bind(this);this.boundStopSlides=this.stopSlides.bind(this);Event.observe(document.onresize?document:window,"resize",function(){this.resizeImages()}.bind(this))},setupPostSlideshow:function(){var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;var windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;if($("slide_div")==undefined){if(isIphone)this.slide_div=new Element("div",
{id:"slide_div",style:"margin:0;display: none; background: black none repeat scroll 0% 0%; position: fixed; top: 0px; right: 0px; vertical-align:middle; text-align:center; width: 100%; height:"+window.innerHeight+"px; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; z-index: 9999;"});else this.slide_div=new Element("div",{id:"slide_div",style:"margin:0;display: none; background: black none repeat scroll 0% 0%; position: fixed; top: 0px; right: 0px; vertical-align:middle; text-align:center; width: 100%; height:100%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; z-index: 9999;"});
new Effect.Appear(document.body.appendChild(this.slide_div),{duration:0.5})}else new Effect.Appear($("slide_div"),{duration:0.5});if(!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8)if(this.site_type!=undefined&&this.site_type!="group")document.body.setStyle({overflow:"hidden"});if(this.slide_div!=undefined){if(this.autoplay==true&&this.site_type!=undefined&&this.site_type=="group"&&this.show_type=="thread")this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="switch">                <a class="on" href="#" onclick="return false;" id="this_thread">This Thread</a> |                <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>              </div>                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>            </div>         </div>'});
else if(this.autoplay==true&&this.show_type=="site"||this.show_type=="group"&&this.site_type=="group")this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="navigation">                <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>              </div>            </div>         </div>'});
else if(this.autoplay==false&&this.site_type!=undefined&&this.site_type=="group"&&this.show_type=="thread")this.slide_div.insert({top:'          <div id="slideshow_loading">&nbsp;</div>           <div id="slidesource" class="active_source"></div>           <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>           <div id="controls-wrapper" class="active_controls">            <div id="controls" class="controls">              <div id="switch">                <a class="on" href="#" onclick="return false;" id="this_thread">This Thread</a> |                <a href="#" onclick="return false;" id="whole_site">Whole Site</a>              </div>                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>            </div>         </div>'});
else if(this.autoplay==false&&this.show_type=="site"||this.show_type=="group"&&this.site_type=="group")this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="navigation">                  <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                </div>              </div>           </div>'});
else if(this.autoplay==true)this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close" ><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="switch">                  <a class="on" href="#" onclick="return false;" id="this_post">This Post</a> |                  <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>                </div>                  <div id="navigation">                    <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="pause control_button" onclick="return false;" title="Pause">Pause</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                  </div>              </div>           </div>'});
else this.slide_div.insert({top:'            <div id="slideshow_loading">&nbsp;</div>             <div id="slidesource" class="active_source"></div>             <div id="close"><a href="#" onclick="return false;" id="slideshow_close" class="active_close"><img src="/images/slideshow_close.png" border=0 width=28 height=28></a></div>             <div id="controls-wrapper" class="active_controls">              <div id="controls" class="controls">                <div id="switch">                  <a class="on" href="#" onclick="return false;" id="this_post">This Post</a> |                  <a href="#!/slideshow" onclick="return false;" id="whole_site">Whole Site</a>                </div>                  <div id="navigation">                    <a id="prevslide" href="#" class="control_button back" onclick="return false;" title="Back">Back</a><a id="pauseplay" href="#" class="play control_button" onclick="return false;" title="Play">Play</a><a id="nextslide" href="#" class="control_button forward" onclick="return false;" title="Forward">Forward</a>                  </div>              </div>           </div>'});
var isEvent=$$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-location"):false;var siteId=$$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-id"):0;if(isEvent=="true"){var postToImage=siteId=="3008319"?"post-to-image-blogworld":"post-to-image";var postTo=siteId=="3008319"?"post-to-blogworld":"post-to";var event_slideshow_instructions=new Element("div",{"class":"event_slideshow_instructions"});event_slideshow_instructions.insert({top:'          <img id="'+
postToImage+'" src="/images/posterous_p_logo.png">           <div id="'+postTo+'">             Download Posterous for the iPhone to post here       \t\t</div>'});this.slide_div.insert({top:event_slideshow_instructions})}}if(isIphone)noTouchMove()},resizeImages:function(){var windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;
var windowFactor=windowHeight/windowWidth;$$("img.img").each(function(image){currentFactor=image.readAttribute("scaling-factor");if(windowFactor>currentFactor)if(!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8)image.writeAttribute({width:"100%",height:"","scaling-factor":currentFactor});else image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px","scaling-factor":currentFactor});else if(!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8)image.writeAttribute({height:"100%",
width:"","scaling-factor":currentFactor});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px","scaling-factor":currentFactor})})},insertPostSlides:function(){var self=this;var windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;var windowFactor=windowHeight/windowWidth;$("slideshow_loading").show();
console.log("inserting post slides");if(this.current_image){var current=this.current_image;if(current.large!=null){var currentWidth=parseInt(current.largeWidth);var currentHeight=parseInt(current.largeHeight);var currentFactor=currentHeight/currentWidth;image=new Element("img",{src:current.large,"class":"img","scaling-factor":currentFactor})}else{var currentWidth=parseInt(current.imageObj.width);var currentHeight=parseInt(current.imageObj.height);var currentFactor=currentHeight/currentWidth;image=
new Element("img",{src:current.imageObj.src,"class":"img","scaling-factor":currentFactor})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*
currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide activeslide clicked",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({top:slide.insert({top:image})});
slideCount=slideCount+1}if(this.image_list!=null||this.current_image!=null){for(var index=0,len=this.image_list.length;index<len;++index){var item=this.image_list[index];if(this.image_list[index]!=current){if(item.large!=null){var currentWidth=parseInt(item.largeWidth);var currentHeight=parseInt(item.largeHeight);var currentFactor=currentHeight/currentWidth;image=new Element("img",{src:item.large,"class":"img","scaling-factor":currentFactor})}else{var currentWidth=parseInt(item.imageObj.width);var currentHeight=
parseInt(item.imageObj.height);var currentFactor=currentHeight/currentWidth;image=new Element("img",{src:item.imageObj.src,"class":"img","scaling-factor":currentFactor})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>
currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});
$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){if(self.autoplay){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");self.playSlides()}else{self.stopSlides();self.playSlides()}}else console.log("no autoplay")},100)}else{var images=$("slidesource").childElements();var image_sources=[];var baseURI="/api/v2";var slideshowSrc=baseURI+"/users/"+this.user_id+"/sites/"+this.site_id+
"/posts/"+this.post_id+"/photos";new Ajax.Request(slideshowSrc,{method:"get",onLoading:function(){$("slideshow_loading").show()},onSuccess:function(transport){var site_images=transport.responseText.evalJSON();for(var index=0,len=site_images.length;index<len;++index){var site_image=site_images[index];if(site_image.scaled1000!=undefined){currentWidth=site_image.scaled1000.width;currentHeight=site_image.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled1000.url,
alt:site_image.scaled1000.caption,"data-id":site_image.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=
windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.scaled500){currentWidth=
site_image.scaled500.width;currentHeight=site_image.scaled500.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled500.url,alt:site_image.scaled500.caption,"data-id":site_image.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+
"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",
style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.full){currentWidth=site_image.full.width;currentHeight=site_image.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.full.url,alt:site_image.full.caption,"data-id":site_image.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",
window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;
image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){$("slideshow_loading").hide();var first_image=$("slidesource").childElements().first();
slides=$("slidesource").childElements();first_image.addClassName("activeslide");first_image.appear()},500)},onFailure:function(){alert("Weird, something went wrong with the slideshow for this post. Try refreshing your browser.")},onComplete:function(){if(self.autoplay==true&&$("slidesource").childElements().length>1){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");self.playSlides()}else{self.stopSlides();self.playSlides()}}}})}},
startPostSlides:function(){var slide=$("slidesource").down(".activeslide");$("slideshow_loading").hide();if(slide==undefined){var first_image=$("slidesource").down(".slide");slides=$("slidesource").childElements();first_image.addClassName("activeslide");first_image.appear({duration:0.5})}else slide.appear({duration:0.5})},startThreadSlides:function(){var slide=$("slidesource").down(".activeslide");$("slideshow_loading").hide();if(slide==undefined){var first_image=$("slidesource").down(".slide");slides=
$("slidesource").childElements();first_image.addClassName("activeslide");first_image.appear({duration:0.5})}else slide.appear({duration:0.5});if(this.autoplay&&this.reply_ids.length<1){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");this.playSlides()}else{this.stopSlides();this.playSlides()}}},setupSlideControls:function(){var self=this;document.observe("keydown",this.keyboardSlides.bind(this));$("nextslide").observe("click",
function(){var images=$("slidesource").childElements();if(images.length>1)this.nextSlide()}.bind(this));$("prevslide").observe("click",function(){var images=$("slidesource").childElements();if(images.length>1)this.prevSlide()}.bind(this));$("pauseplay").observe("click",function(){var images=$("slidesource").childElements();if(images.length>1)if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");this.playSlides()}else if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");
$("pauseplay").addClassName("play");this.stopSlides()}}.bind(this));$("close").observe("click",function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keydown",this.boundKeyboardSlides);if($("slide_div")!=undefined)$("slide_div").remove()}});if(!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8)if(this.site_type!=
undefined&&this.site_type!="group")document.body.setStyle({overflow:"auto"});if(isIphone)doTouchMove();if(this.slug&&this.site_type=="group")slideshow.setLocation("#!/"+this.slug);else slideshow.setLocation("#!/")}.bind(this));if($("this_post")!=undefined)$("this_post").observe("click",function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}if(!$("this_post").hasClassName("on")){$("whole_site").removeClassName("on");
$("this_post").addClassName("on");this.switchSlideshow();this.insertPostSlides();this.startPostSlides()}if(this.slug!=undefined&&this.show_type=="site")slideshow.setLocation("#!/"+this.slug+"/slideshow");else if(this.slug!=undefined&&this.show_type=="post")slideshow.setLocation("#!/slideshow")}.bind(this));if($("this_thread")!=undefined)$("this_thread").observe("click",function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}if(!$("this_thread").hasClassName("on")){$("whole_site").removeClassName("on");
$("this_thread").addClassName("on");this.switchSlideshow();this.insertThreadSlides();this.insertThreadReplySlides();if(this.current_image!=null)this.startThreadSlides()}if(this.slug!=undefined)slideshow.setLocation("/#!/"+this.slug+"/slideshow")}.bind(this));if($("whole_site")!=undefined){pageAttempts=0;$("whole_site").observe("click",function(){if(!$("whole_site").hasClassName("on")){if($("this_post"))$("this_post").removeClassName("on");else if($("this_thread"))$("this_thread").removeClassName("on");
$("whole_site").addClassName("clicked");$("whole_site").addClassName("on");this.insertSiteSlides()}if(this.show_type=="site"||this.show_type=="post")slideshow.setLocation("#!/slideshow")}.bind(this))}document.observe("load",function(){setTimeout(function(){$("controls-wrapper").hide();$("close").hide()},4500)}.bind(this));document.observe("mousemove",function(){clearTimeout(this.controltimer);if($("controls-wrapper")!=undefined)$("controls-wrapper").show();if($("close")!=undefined)$("close").show();
this.controltimer=setTimeout(function(){if($("controls-wrapper")!=undefined)$("controls-wrapper").hide();if($("close")!=undefined)$("close").hide()},4500)}.bind(this))},keyboardSlides:function(evt){var self=this;var images=$("slidesource").childElements();var key=evt.charCode||evt.keyCode;if(images.length>1)if(key==37)this.prevSlide();else if(key==39)this.nextSlide();else if(key==32)if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");
this.playSlides()}else if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}if(key==27){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keydown",this.boundKeyboardSlides);if($("slide_div")!=undefined)$("slide_div").remove()}});if(!Prototype.Browser.IE7&&
!Prototype.Browser.IE6&&!Prototype.Browser.IE8)if(this.site_type!=undefined&&this.site_type!="group")document.body.setStyle({overflow:"auto"});if(this.slug&&this.site_type=="group")slideshow.setLocation("#!/"+this.slug);else slideshow.setLocation("#!/")}},nextSlide:function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}active_slide=$$("#slidesource .activeslide").first();next_slide=active_slide.next(".slide");
if(next_slide==undefined){next_slide=$("slidesource").down(".slide");if(slideCount<currentSlideLength)this.updateSiteSlides()}active_slide.removeClassName("activeslide");next_slide.addClassName("activeslide");if(!next_slide.hasClassName("clicked")){slideCount=slideCount+1;next_slide.addClassName("clicked")}if(currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))this.updateSiteSlides();else if(currentSlideLength!=
null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on"))){console.log("update slides");this.updateSiteSlides()}active_slide.fade();next_slide.appear()},prevSlide:function(){if($("pauseplay").hasClassName("pause")){$("pauseplay").removeClassName("pause");$("pauseplay").addClassName("play");this.stopSlides()}active_slide=$$("#slidesource .activeslide").first();prev_slide=active_slide.previous(".slide");if(prev_slide==undefined){prev_slide=$("slidesource").childElements().last();
if(slideCount<currentSlideLength)this.updateSiteSlides()}active_slide.removeClassName("activeslide");prev_slide.addClassName("activeslide");if(!prev_slide.hasClassName("clicked")){slideCount=slideCount+1;prev_slide.addClassName("clicked")}if(currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))this.updateSiteSlides();else if(currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||
$("whole_site").hasClassName("on")))this.updateSiteSlides();active_slide.fade();prev_slide.appear()},playSlides:function(){var self=this;slideshowTimer=window.setInterval(function(){active_slide=$$("#slidesource .activeslide").first();if(active_slide==undefined)return;next_slide=active_slide.next(".slide");if(next_slide==undefined){next_slide=$("slidesource").down(".slide");if(slideCount<currentSlideLength)self.updateSiteSlides()}active_slide.removeClassName("activeslide");next_slide.addClassName("activeslide");
if(!next_slide.hasClassName("clicked")){slideCount=slideCount+1;next_slide.addClassName("clicked")}if(currentSlideLength!=null&&currentSlideLength>5&&slideCount==currentSlideLength-5&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))self.updateSiteSlides();else if(currentSlideLength!=null&&slideCount==currentSlideLength&&($("whole_site")==undefined||$("whole_site").hasClassName("on")))self.updateSiteSlides();active_slide.fade();next_slide.appear()},7E3)},stopSlides:function(){window.clearInterval(slideshowTimer);
return false},insertThreadSlides:function(){var windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;var windowFactor=windowHeight/windowWidth;image_sources=[];var self=this;console.log("inserting thread slides");if(this.current_image){var current=this.current_image;if(current.large!=null){image_sources.push(current.large);var currentWidth=
parseInt(current.largeWidth);var currentHeight=parseInt(current.largeHeight);var currentFactor=currentHeight/currentWidth;image=new Element("img",{src:current.large,"class":"img","scaling-factor":currentFactor})}else{var currentWidth=parseInt(current.imageObj.width);var currentHeight=parseInt(current.imageObj.height);var currentFactor=currentHeight/currentWidth;image=new Element("img",{src:current.imageObj.src,"class":"img","scaling-factor":currentFactor})}if(isIphone)image.writeAttribute("height",
window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;
image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide activeslide clicked",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({top:slide.insert({top:image})});slideCount=slideCount+1}if(this.image_list!=null||this.current_image!=null)for(var index=
0,len=this.image_list.length;index<len;++index){var item=this.image_list[index];if(this.image_list[index]!=current){if(item.large!=null){image_sources.push(item.large);var currentWidth=parseInt(item.largeWidth);var currentHeight=parseInt(item.largeHeight);var currentFactor=currentHeight/currentWidth;image=new Element("img",{src:item.large,"class":"img","scaling-factor":currentFactor})}else{image_sources.push(item.imageObj.src);var currentWidth=parseInt(item.imageObj.width);var currentHeight=parseInt(item.imageObj.height);
var currentFactor=currentHeight/currentWidth;image=new Element("img",{src:item.imageObj.src,"class":"img","scaling-factor":currentFactor})}if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>
currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});
$("slidesource").insert({bottom:slide.insert({top:image})})}}else{var images=$("slidesource").childElements();image_sources=[];var baseURI="/api/v2";var threadPhotoSrc=baseURI+"/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+this.thread_id+"/photos";new Ajax.Request(threadPhotoSrc,{method:"get",onLoading:function(){$("slideshow_loading").show()},onSuccess:function(transport){var thread_images=transport.responseText.evalJSON();for(var index=0,len=thread_images.length;index<len;++index){var thread_image=
thread_images[index];if(thread_image.scaled1000!=undefined){image_sources.push(thread_image.scaled1000.url);currentWidth=thread_image.scaled1000.width;currentHeight=thread_image.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:thread_image.scaled1000.url,alt:thread_image.scaled1000.caption,"data-id":thread_image.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>
currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>
currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(thread_image.scaled500){image_sources.push(thread_image.scaled500.url);currentWidth=thread_image.scaled500.width;currentHeight=thread_image.scaled500.height;currentFactor=
currentHeight/currentWidth;image=new Element("img",{src:thread_image.scaled500.url,alt:thread_image.scaled500.caption,"data-id":thread_image.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});
else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||
Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(thread_image.full){image_sources.push(thread_image.full.url);currentWidth=thread_image.full.width;currentHeight=thread_image.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:thread_image.full.url,alt:thread_image.full.caption,"data-id":thread_image.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",
window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;
image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){$("slideshow_loading").hide();var first_image=$("slidesource").childElements().first();
slides=$("slidesource").childElements();first_image.addClassName("activeslide");first_image.appear()},500);if(self.autoplay&&self.reply_ids.length<1){console.log("autoplay");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");self.playSlides()}else{self.stopSlides();self.playSlides()}}},onFailure:function(){alert("Weird, something went wrong with the thread slideshow. Try refreshing your browser.")}})}},insertThreadReplySlides:function(){var windowHeight=
window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;var windowFactor=windowHeight/windowWidth;var self=this;var images=$("slidesource").childElements();var baseURI="/api/v2";console.log("inserting thread reply slides");for(var index=0,len=this.reply_ids.length;index<len;++index){var reply_id=this.reply_ids[index];var repliesPhotoSrc=baseURI+
"/users/"+this.user_id+"/sites/"+this.site_id+"/posts/"+reply_id+"/photos";new Ajax.Request(repliesPhotoSrc,{method:"get",onSuccess:function(transport){var thread_images=transport.responseText.evalJSON();for(var index=0,len=thread_images.length;index<len;++index){var thread_image=thread_images[index];if(thread_image.scaled1000&&image_sources.include(thread_image.scaled1000.url)||thread_image.scaled500&&image_sources.include(thread_image.scaled500.url)||thread_image.full&&image_sources.include(thread_image.full.url))console.log("has image");
else{console.log("new image");if(thread_image.scaled1000!=undefined){image_sources.push(thread_image.scaled1000.url);currentWidth=thread_image.scaled1000.width;currentHeight=thread_image.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:thread_image.scaled1000.url,alt:thread_image.scaled1000.caption,"data-id":thread_image.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>
currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>
currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(thread_image.scaled500){image_sources.push(thread_image.scaled500.url);currentWidth=thread_image.scaled500.width;currentHeight=thread_image.scaled500.height;currentFactor=
currentHeight/currentWidth;image=new Element("img",{src:thread_image.scaled500.url,alt:thread_image.scaled500.caption,"data-id":thread_image.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});
else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||
Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(thread_image.full){image_sources.push(thread_image.full.url);currentWidth=thread_image.full.width;currentHeight=thread_image.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:thread_image.full.url,alt:thread_image.full.caption,"data-id":thread_image.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",
window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;
image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}}setTimeout(function(){if(self.autoplay==true)if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");
$("pauseplay").addClassName("pause");self.playSlides()}else{self.stopSlides();self.playSlides()}},1E3)},onFailure:function(){alert("Weird, something went wrong with the thread slideshow. Try refreshing your browser.")}})}},insertSiteSlides:function(pagenumber){var windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;var windowFactor=
windowHeight/windowWidth;var images=$("slidesource").childElements();var image_sources=[];var baseURI="/api/v2";currentPages=[];image_post_ids=[];var self=this;pagenumber=pagenumber||0;randompage=pagenumber+1;var slideshowSrc=baseURI+"/users/"+this.user_id+"/sites/"+this.site_id+"/photos?page="+randompage;console.log("inserting site slides");active_slide=$$("#slidesource .activeslide").first();if(active_slide!=undefined)active_slide.fade({duration:1});if(images.length>0){for(var index=0,len=images.length;index<
len;++index){var item=images[index];item.remove()}if(this.image_list!=null||this.current_image!=null)for(var index=0,len=this.image_list.length;index<len;++index){var item=this.image_list[index];if(item.large!=null)image_sources.push(item.large);else image_sources.push(item.imageObj.src)}}new Ajax.Request(slideshowSrc,{method:"get",onLoading:function(){$("slideshow_loading").show()},onSuccess:function(transport){var site_images=transport.responseText.evalJSON();if(site_images.length==0){pageAttempts=
pageAttempts+1;if(pageAttempts>=30){new Effect.Fade("slide_div",{duration:1,afterFinish:function(){document.stopObserving("keyup",this.boundKeyboardSlides);if($("slide_div")!=undefined)$("slide_div").remove()}});if(!Prototype.Browser.IE7&&!Prototype.Browser.IE6&&!Prototype.Browser.IE8)if(this.site_type!=undefined&&this.site_type!="group")document.body.setStyle({overflow:"auto"});if(this.slug&&this.site_type=="group")slideshow.setLocation("#!/"+this.slug);else slideshow.setLocation("#!/");alert("We can't seem to find any photos for this site.")}else{currentPages.push(randompage);
self.insertSiteSlides(randompage)}}else{pageAttempts=0;slideCount=0;currentPage=randompage;currentPages.push(randompage);currentSlideLength=site_images.length;var site_image=site_images[0];if(site_image.scaled1000){image_post_ids.push(site_image.scaled1000.post_id);currentWidth=site_image.scaled1000.width;currentHeight=site_image.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled1000.url,alt:site_image.scaled1000.caption,"data-id":site_image.scaled1000.post_id,
"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,
width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.scaled500){image_post_ids.push(site_image.scaled500.post_id);
currentWidth=site_image.scaled500.width;currentHeight=site_image.scaled500.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled500.url,alt:site_image.scaled500.caption,"data-id":site_image.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});
else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");
slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.full){image_post_ids.push(site_image.full.post_id);currentWidth=site_image.full.width;currentHeight=site_image.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.full.url,alt:site_image.full.caption,"data-id":site_image.full.post_id,
"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,
width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}setTimeout(function(){active_slide=
$("slidesource").down(".activeslide");slide=$("slidesource").down(".slide");if(active_slide==undefined&&slide!=undefined){$("slideshow_loading").hide();slide.addClassName("activeslide");slide.addClassName("clicked");slideCount=slideCount+1;slide.appear()}},500);for(var index=1,len=site_images.length;index<len;++index){var site_image=site_images[index];if(site_image.scaled1000){image_post_ids.push(site_image.scaled1000.post_id);currentWidth=site_image.scaled1000.width;currentHeight=site_image.scaled1000.height;
currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled1000.url,alt:site_image.scaled1000.caption,"data-id":site_image.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+
"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||
Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.scaled500){image_post_ids.push(site_image.scaled500.post_id);currentWidth=site_image.scaled500.width;currentHeight=site_image.scaled500.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled500.url,alt:site_image.scaled500.caption,"data-id":site_image.scaled500.post_id,"class":"img","scaling-factor":currentFactor});
if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=
windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.full){image_post_ids.push(site_image.full.post_id);
currentWidth=site_image.full.width;currentHeight=site_image.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.full.url,alt:site_image.full.caption,"data-id":site_image.full.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+
"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",
style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}setTimeout(function(){console.log("load photos and start slideshow");if($("pauseplay").hasClassName("play")){$("pauseplay").removeClassName("play");$("pauseplay").addClassName("pause");self.playSlides()}else{self.stopSlides();self.playSlides()}},1500)}},onFailure:function(){alert("Weird, something went wrong with the site wide slideshow. Try refreshing your browser.")}})},
updateSiteSlides:function(pagenumber){if($("this_post")!=undefined&&$("this_post").hasClassName("on")||$("this_thread")!=undefined&&$("this_thread").hasClassName("on"))return;var windowHeight=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;var windowWidth=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth;var windowFactor=windowHeight/windowWidth;var images=$("slidesource").childElements();var image_sources=
[];var isEvent=$$(".posterous_site_data")[0]?$$(".posterous_site_data")[0].readAttribute("data-site-location"):false;var self=this;var baseURI="/api/v2";var slideshowSrc=baseURI+"/users/"+this.user_id+"/sites/"+this.site_id+"/photos?page="+pagenumber;console.log("updating site slides");if(images.length>0)for(var index=0,len=images.length;index<len;++index){var item=images[index];image_sources.push(item.readAttribute("data-id"))}new Ajax.Request(slideshowSrc,{method:"get",onSuccess:function(transport){var site_images=
transport.responseText.evalJSON();if(site_images.length==0||currentPages.include(randompage)&&randompage!=1){pageAttempts=pageAttempts+1;currentPages.push(randompage);self.updateSiteSlides(rand(30));return}else{pageAttempts=0;slideCount=0;currentPage=randompage;currentPages.push(randompage);currentSlideLength=site_images.length;for(var index=0,len=site_images.length;index<len;++index){var site_image=site_images[index];if(site_image.scaled1000&&image_post_ids.include(site_image.scaled1000.post_id))console.log("has image");
else if(site_image.scaled500&&image_post_ids.include(site_image.scaled500.post_id))console.log("has image");else if(site_image.full&&image_post_ids.include(site_image.full.post_id))console.log("has image");else{console.log("new image");if(site_image.scaled1000){image_post_ids.push(site_image.scaled1000.post_id);currentWidth=site_image.scaled1000.width;currentHeight=site_image.scaled1000.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled1000.url,alt:site_image.scaled1000.caption,
"data-id":site_image.scaled1000.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*
currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.scaled500){image_post_ids.push(site_image.scaled500.post_id);
currentWidth=site_image.scaled500.width;currentHeight=site_image.scaled500.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.scaled500.url,alt:site_image.scaled500.caption,"data-id":site_image.scaled500.post_id,"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});
else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");
slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}else if(site_image.full){image_post_ids.push(site_image.full.post_id);currentWidth=site_image.full.width;currentHeight=site_image.full.height;currentFactor=currentHeight/currentWidth;image=new Element("img",{src:site_image.full.url,alt:site_image.full.caption,"data-id":site_image.full.post_id,
"class":"img","scaling-factor":currentFactor});if(isIphone)image.writeAttribute("height",window.innerHeight);else if(Prototype.Browser.IE8)if(windowFactor>currentFactor)image.writeAttribute({width:windowWidth+"px",height:windowWidth/currentFactor+"px"});else image.writeAttribute({height:windowHeight+"px",width:windowHeight/currentFactor+"px"});else if(Prototype.Browser.IE7||Prototype.Browser.IE6)if(windowFactor>currentFactor){var height=windowWidth/currentWidth*currentHeight;image.writeAttribute({height:height,
width:windowWidth})}else{var width=windowHeight/currentHeight*currentWidth;image.writeAttribute({height:windowHeight,width:width})}else if(windowFactor>currentFactor)image.writeAttribute("width","100%");else image.writeAttribute("height","100%");slide=new Element("div",{"class":"slide",style:"display:none;"});if(Prototype.Browser.IE7||Prototype.Browser.IE6)slide.writeAttribute({style:"left:0px;display:none;"});$("slidesource").insert({bottom:slide.insert({top:image})})}}}}},onFailure:function(){return false}})},
switchSlideshow:function(){var images=$("slidesource").childElements();active_slide=$$("#slidesource .activeslide").first();if(active_slide!=undefined)active_slide.fade({duration:1});for(var index=0,len=images.length;index<len;++index){var item=images[index];item.remove()}}});function rand(n){return Math.floor(Math.random()*n+1)}function doTouchMove(state){document.ontouchmove=function(e){return state}}function noTouchMove(){document.ontouchmove=function(e){e.preventDefault()}}
(function(){var root=this;var previousBackbone=root.Backbone;var Backbone;if(typeof exports!=="undefined")Backbone=exports;else Backbone=root.Backbone={};Backbone.VERSION="0.5.2";var _=root._;if(!_&&typeof require!=="undefined")_=require("underscore")._;var $=root.jQuery||root.Zepto;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;Backbone.Events={bind:function(ev,callback,context){var calls=this._callbacks||(this._callbacks=
{});var list=calls[ev]||(calls[ev]=[]);list.push([callback,context]);return this},unbind:function(ev,callback){var calls;if(!ev)this._callbacks={};else if(calls=this._callbacks)if(!callback)calls[ev]=[];else{var list=calls[ev];if(!list)return this;for(var i=0,l=list.length;i<l;i++)if(list[i]&&callback===list[i][0]){list[i]=null;break}}return this},trigger:function(eventName){var list,calls,ev,callback,args;var both=2;if(!(calls=this._callbacks))return this;while(both--){ev=both?eventName:"all";if(list=
calls[ev])for(var i=0,l=list.length;i<l;i++)if(!(callback=list[i])){list.splice(i,1);i--;l--}else{args=both?Array.prototype.slice.call(arguments,1):arguments;callback[0].apply(callback[1]||this,args)}}return this}};Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(defaults=this.defaults){if(_.isFunction(defaults))defaults=defaults.call(this);attributes=_.extend({},defaults,attributes)}this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId("c");this.set(attributes,
{silent:true});this._changed=false;this._previousAttributes=_.clone(this.attributes);if(options&&options.collection)this.collection=options.collection;this.initialize(attributes,options)};_.extend(Backbone.Model.prototype,Backbone.Events,{_previousAttributes:null,_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return _.clone(this.attributes)},get:function(attr){return this.attributes[attr]},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;
var val=this.attributes[attr];return this._escapedAttributes[attr]=escapeHTML(val==null?"":""+val)},has:function(attr){return this.attributes[attr]!=null},set:function(attrs,options){options||(options={});if(!attrs)return this;if(attrs.attributes)attrs=attrs.attributes;var now=this.attributes,escaped=this._escapedAttributes;if(!options.silent&&this.validate&&!this._performValidation(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var alreadyChanging=this._changing;
this._changing=true;for(var attr in attrs){var val=attrs[attr];if(!_.isEqual(now[attr],val)){now[attr]=val;delete escaped[attr];this._changed=true;if(!options.silent)this.trigger("change:"+attr,this,val,options)}}if(!alreadyChanging&&!options.silent&&this._changed)this.change(options);this._changing=false;return this},unset:function(attr,options){if(!(attr in this.attributes))return this;options||(options={});var value=this.attributes[attr];var validObj={};validObj[attr]=void 0;if(!options.silent&&
this.validate&&!this._performValidation(validObj,options))return false;delete this.attributes[attr];delete this._escapedAttributes[attr];if(attr==this.idAttribute)delete this.id;this._changed=true;if(!options.silent){this.trigger("change:"+attr,this,void 0,options);this.change(options)}return this},clear:function(options){options||(options={});var attr;var old=this.attributes;var validObj={};for(attr in old)validObj[attr]=void 0;if(!options.silent&&this.validate&&!this._performValidation(validObj,
options))return false;this.attributes={};this._escapedAttributes={};this._changed=true;if(!options.silent){for(attr in old)this.trigger("change:"+attr,this,void 0,options);this.change(options)}return this},fetch:function(options){options||(options={});options.showLoader=options.showLoader==false?false:true;if(options.showLoader)Posterous.showLoader();var model=this;var success=options.success;options.success=function(resp,status,xhr){Posterous.hideLoader();if(!model.set(model.parse(resp,xhr),options))return false;
if(success)success(model,resp)};options.error=wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},save:function(attrs,options){options||(options={});if(attrs&&!this.set(attrs,options))return false;var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp,xhr)};options.error=wrapError(options.error,model,options);var method=this.isNew()?
"create":"update";return(this.sync||Backbone.sync).call(this,method,this,options)},destroy:function(options){options||(options={});if(this.isNew())return this.trigger("destroy",this,this.collection,options);var model=this;var success=options.success;options.success=function(resp){model.trigger("destroy",model,model.collection,options);if(success)success(model,resp)};options.error=wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,"delete",this,options)},url:function(){var base=
getUrl(this.collection)||this.urlRoot||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,xhr){return resp},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(options){this.trigger("change",this,options);this._previousAttributes=_.clone(this.attributes);this._changed=false},hasChanged:function(attr){if(attr)return this._previousAttributes[attr]!=this.attributes[attr];
return this._changed},changedAttributes:function(now){now||(now=this.attributes);var old=this._previousAttributes;var changed=false;for(var attr in now)if(!_.isEqual(old[attr],now[attr])){changed=changed||{};changed[attr]=now[attr]}return changed},previous:function(attr){if(!attr||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},_performValidation:function(attrs,options){var error=this.validate(attrs);
if(error){if(options.error)options.error(this,error,options);else this.trigger("error",this,error,options);return false}return true}});Backbone.Collection=function(models,options){options||(options={});if(options.comparator)this.comparator=options.comparator;_.bindAll(this,"_onModelEvent","_removeReference");this._reset();if(models)this.reset(models,{silent:true});this.initialize.apply(this,arguments)};_.extend(Backbone.Collection.prototype,Backbone.Events,{model:Backbone.Model,initialize:function(){},
toJSON:function(){return this.map(function(model){return model.toJSON()})},add:function(models,options){if(_.isArray(models))for(var i=0,l=models.length;i<l;i++)this._add(models[i],options);else this._add(models,options);return this},remove:function(models,options){if(_.isArray(models))for(var i=0,l=models.length;i<l;i++)this._remove(models[i],options);else this._remove(models,options);return this},get:function(id){if(id==null)return null;return this._byId[id.id!=null?id.id:id]},getByCid:function(cid){return cid&&
this._byCid[cid.cid||cid]},at:function(index){return this.models[index]},sort:function(options){options||(options={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);if(!options.silent)this.trigger("reset",this,options);return this},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr)})},reset:function(models,options){models||(models=[]);options||(options={});this.each(this._removeReference);this._reset();
this.add(models,{silent:true});if(!options.silent)this.trigger("reset",this,options);return this},fetch:function(options){options||(options={});var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?"add":"reset"](collection.parse(resp,xhr),options);if(success)success(collection,resp)};options.error=wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},create:function(model,options){var coll=
this;options||(options={});model=this._prepareModel(model,options);if(!model)return false;var success=options.success;options.success=function(nextModel,resp,xhr){coll.add(nextModel,options);if(success)success(nextModel,resp,xhr)};model.save(null,options);return model},parse:function(resp,xhr){return resp},chain:function(){return _(this.models).chain()},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(model,options){if(!(model instanceof Backbone.Model)){var attrs=
model;model=new this.model(attrs,{collection:this});if(model.validate&&!model._performValidation(attrs,options))model=false}else if(!model.collection)model.collection=this;return model},_add:function(model,options){options||(options={});model=this._prepareModel(model,options);if(!model)return false;var already=this.getByCid(model);if(already)throw new Error(["Can't add the same model to a set twice",already.id]);this._byId[model.id]=model;this._byCid[model.cid]=model;var index=options.at!=null?options.at:
this.comparator?this.sortedIndex(model,this.comparator):this.length;this.models.splice(index,0,model);model.bind("all",this._onModelEvent);this.length++;if(!options.silent)model.trigger("add",model,this,options);return model},_remove:function(model,options){options||(options={});model=this.getByCid(model)||this.get(model);if(!model)return null;delete this._byId[model.id];delete this._byCid[model.cid];this.models.splice(this.indexOf(model),1);this.length--;if(!options.silent)model.trigger("remove",
model,this,options);this._removeReference(model);return model},_removeReference:function(model){if(this==model.collection)delete model.collection;model.unbind("all",this._onModelEvent)},_onModelEvent:function(ev,model,collection,options){if((ev=="add"||ev=="remove")&&collection!=this)return;if(ev=="destroy")this._remove(model,options);if(model&&ev==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=
["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty"];_.each(methods,function(method){Backbone.Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)))}});Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=
options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var namedParam=/:([\w\d]+)/g;var splatParam=/\*([\w\d]+)/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Backbone.Router.prototype,Backbone.Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new Backbone.History);if(!_.isRegExp(route))route=this._routeToRegExp(route);Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);
callback.apply(this,args);this.trigger.apply(this,["route:"+name].concat(args))},this))},navigate:function(fragment,triggerRoute){Backbone.history.navigate(fragment,triggerRoute)},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes)routes.unshift([route,this.routes[route]]);for(var i=0,l=routes.length;i<l;i++)this.route(routes[i][0],routes[i][1],this[routes[i][1]])},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(namedParam,"([^/]*)").replace(splatParam,
"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1)}});Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl")};var hashStrip=/^#*/;var isExplorer=/msie [\w.]+/;var historyStarted=false;_.extend(Backbone.History.prototype,{interval:50,getFragment:function(fragment,forcePushState){if(fragment==null)if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=
search;if(fragment.indexOf(this.options.root)==0)fragment=fragment.substr(this.options.root.length)}else fragment=window.location.hash;return fragment.replace(hashStrip,"")},start:function(options){if(historyStarted)throw new Error("Backbone.history has already been started");this.options=_.extend({},{root:"/"},this.options,options);this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();
var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState)$(window).bind("popstate",this.checkUrl);else if("onhashchange"in window&&!oldIE)$(window).bind("hashchange",this.checkUrl);else setInterval(this.checkUrl,this.interval);this.fragment=fragment;historyStarted=true;var loc=window.location;
var atRoot=loc.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=loc.hash.replace(hashStrip,"");window.history.replaceState({},document.title,loc.protocol+"//"+loc.host+this.options.root+this.fragment)}return this.loadUrl()},route:function(route,callback){this.handlers.unshift({route:route,
callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.iframe.location.hash);if(current==this.fragment||current==decodeURIComponent(this.fragment))return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);
return true}});return matched},navigate:function(fragment,triggerRoute){var frag=(fragment||"").replace(hashStrip,"");console.log(frag);if(this._hasPushState){var loc=window.location;if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history.pushState({},document.title,loc.protocol+"//"+loc.host+frag)}else{console.log("else");console.log(frag);window.location.hash=this.fragment=frag;if(this.iframe&&frag!=this.getFragment(this.iframe.location.hash)){this.iframe.document.open().close();
this.iframe.location.hash=frag}}if(triggerRoute)this.loadUrl(fragment)}});Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var selectorDelegate=function(selector){return $(selector,this.el)};var eventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName"];_.extend(Backbone.View.prototype,Backbone.Events,{tagName:"div",$:selectorDelegate,
initialize:function(){},render:function(){return this},remove:function(){$(this.el).remove();return this},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content)$(el).html(content);return el},delegateEvents:function(events){if(!(events||(events=this.events)))return;$(this.el).unbind(".delegateEvents"+this.cid);for(var key in events){var method=this[events[key]];if(!method)throw new Error('Event "'+events[key]+'" does not exist');
var match=key.match(eventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector==="")$(this.el).bind(eventName,method);else $(this.el).delegate(selector,eventName,method)}},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr]}this.options=options},_ensureElement:function(){if(!this.el){var attrs=
this.attributes||{};if(this.id)attrs.id=this.id;if(this.className)attrs["class"]=this.className;this.el=this.make(this.tagName,attrs)}else if(_.isString(this.el))this.el=$(this.el).get(0)}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child};Backbone.Model.extend=Backbone.Collection.extend=Backbone.Router.extend=Backbone.View.extend=extend;Backbone.methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};Backbone.sync=
function(method,model,options){var type=Backbone.methodMap[method];var params=_.extend({type:type,dataType:"json"},options);if(!params.url)params.url=getUrl(model)||urlError();if(!params.data&&model&&(method=="create"||method=="update")){params.contentType="application/json";params.data=JSON.stringify(model.toJSON())}if(Backbone.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(Backbone.emulateHTTP)if(type==="PUT"||type==="DELETE"){if(Backbone.emulateJSON)params.data._method=
type;params.type="POST";params.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type)}}if(params.type!=="GET")params.processData=false;params.beforeSend=function(xhr){xhr.setRequestHeader("X-Xhrsource","posterous")};return $.ajax(params)};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty("constructor"))child=protoProps.constructor;else child=function(){return parent.apply(this,arguments)};_.extend(child,
parent);ctor.prototype=parent.prototype;child.prototype=new ctor;if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child};var getUrl=function(object){if(!(object&&object.url))return null;return _.isFunction(object.url)?object.url():object.url};var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(onError,model,options){return function(resp){if(onError)onError(model,
resp,options);else model.trigger("error",model,resp,options)}};var escapeHTML=function(string){return string.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};(function(window,document,undefined_,$){var RelationalModel;window.Posterous=window.Posterous||{BASE_URL:"/api/2",Collections:{},
Models:{},Views:{}};RelationalModel=function(){__extends(RelationalModel,Backbone.Model);function RelationalModel(){RelationalModel.__super__.constructor.apply(this,arguments)}RelationalModel.prototype.hasMany=function(name,collection){this[name]=new collection;return this[name][Posterous.getConstructorName(this).toLowerCase()]=this};RelationalModel.prototype.belongsTo=function(name,mdl){return this[name]=this.collection?this.collection[name]:new mdl({id:this.get(""+name+"_id")})};RelationalModel.prototype.hasOne=
function(name,mdl){this[name]=new mdl;return this[name][Posterous.getConstructorName(this).toLowerCase()]=this};return RelationalModel}();Posterous.Model=function(){__extends(Model,RelationalModel);function Model(){Model.__super__.constructor.apply(this,arguments)}Model.prototype.hasMany=function(name,collection){this[name]=new collection;return this[name][Posterous.getConstructorName(this).toLowerCase()]=this};Model.prototype.belongsTo=function(name,mdl){return this[name]=this.collection?this.collection[name]:
new mdl({id:""+name+"_id"})};Model.prototype.hasOne=function(name,mdl){this[name]=new mdl;return this[name][Posterous.getConstructorName(this).toLowerCase()]=this};Model.prototype.toJSON=function(){return this._wrappedAttributes()};Model.prototype._wrappedAttributes=function(){var object;object={};object[this._namespace()]=_.clone(this.attributes);return object};Model.prototype._namespace=function(){if(!this.namespaceKey)throw new Error("A 'namespaceKey' property must be specified");return this.namespaceKey};
return Model}();Posterous.MovableModel=function(){__extends(MovableModel,Posterous.Model);function MovableModel(){MovableModel.__super__.constructor.apply(this,arguments)}MovableModel.prototype.initialize=function(){return this._url=this.url};MovableModel.prototype.fetch=function(options){var abort,model,success,_ref;options||(options={});if((_ref=options.showLoader)==null)options.showLoader=true;if(options.showLoader)Posterous.showLoader();model=this;success=options.success;options.success=function(resp,
status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)return success(model,resp)};abort=options.abortable;options.error=Posterous._wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,"read",this,options,abort)};MovableModel.prototype.moveUrl=function(){return this._url()+"/move"};MovableModel.prototype.canMoveTo=function(newPosition){return true};MovableModel.prototype.moveTo=function(newPosition,options){var error,model,opts,success;options=
options||{};if(!this.canMoveTo(newPosition)){error=JSON.stringify({message:["Can't move to position "+newPosition],error:"Validation Failed"});if(options.error)options.error(this,error);else this.trigger("error",this,error);return this}else{model=this;success=options.success;error=options.error;opts=_.extend(options,{success:function(model,resp){model._resetUrl();if(success)return success(model,resp)},error:function(model,resp){model._resetUrl();if(error)return error(model,resp);else return model.trigger("error",
model,resp,opts)}});this.url=this.moveUrl;this.attributes.position=newPosition;return Posterous.MovableModel.prototype.save.call(this,null,opts)}};MovableModel.prototype._resetUrl=function(){return this.url=this._url};return MovableModel}();Posterous.PaginatedCollection=function(){__extends(PaginatedCollection,Backbone.Collection);function PaginatedCollection(){this.parse=__bind(this.parse,this);PaginatedCollection.__super__.constructor.apply(this,arguments)}PaginatedCollection.prototype.formatCacheKey=
function(params){var k,key,v;if(params==null)params={};key=params.url;key+=function(){var _ref,_results;_ref=params.data;_results=[];for(k in _ref){v=_ref[k];_results.push(""+k+"|"+v)}return _results}().join("|");return key};PaginatedCollection.prototype.parse=function(resp,jqhxr){this.perPage=+jqhxr.getResponseHeader("x-per-page");this.currentPage=+jqhxr.getResponseHeader("x-current-page")||1;this.totalPages=+jqhxr.getResponseHeader("x-total-pages");this.totalEntries=+jqhxr.getResponseHeader("x-total-entries");
return resp};PaginatedCollection.prototype.fetch=function(options){var abort,collection,success,_ref;options||(options={});collection=this;success=options.success;abort=options.abortable;if((_ref=options.showLoader)==null)options.showLoader=true;if(options.showLoader)Posterous.showLoader();options.originalSuccess=options.success;options.success=function(resp,status,xhr){collection[options.add?"add":"reset"](collection.parse(resp,xhr),options);if(success)success(collection,resp);return Posterous.hideLoader()};
options.error=Posterous._wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,"read",this,options,abort)};PaginatedCollection.prototype.getUrl=function(object){if(!(object&&object.url))return null;if(_.isFunction(object.url))return object.url();else return object.url};PaginatedCollection.prototype.urlError=function(){throw new Error('A "url" property or function must be specified');};PaginatedCollection.prototype.sync=function(method,model,options,abort){var cacheKey,
cached,display_date,methodMap,modelJSON,oldSuccess,paramSeparator,params,type;if(abort==null)abort=true;methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};type=methodMap[method];params=_.extend({type:type,dataType:"json"},options);this.currentPage=this.currentPage||1;this.perPage=this.perPage||options.perPage||10;modelJSON=method==="create"||method==="update"?JSON.stringify(model.toJSON()):{};if(this.currentPage)modelJSON.page=this.currentPage;if(this.perPage)modelJSON.per_page=this.perPage;
if(!params.url)params.url=this.getUrl(model)||urlError();if(this.currentPage){if(options.useBeforeDisplayDate)this.currentPage=1;paramSeparator=/\?/.test(params.url)?"&":"?";params.url=""+params.url+paramSeparator+"page="+this.currentPage+"&per_page="+this.perPage;if(options.useBeforeDisplayDate){display_date=(new Date(this.last().get("display_date"))).getTime()/1E3;params.url+="&before_display_date="+display_date}}if(!params.data&&model&&(method==="create"||method==="update")){params.contentType=
"application/json";params.data=modelJSON}if(Backbone.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(Backbone.emulateHTTP)if(type==="PUT"||type==="DELETE"){if(Backbone.emulateJSON)params.data._method=type;params.type="POST";params.beforeSend=function(xhr){return xhr.setRequestHeader("X-HTTP-Method-Override",type)}}if(params.type!=="GET")params.processData=false;params.beforeSend=function(xhr){return xhr.setRequestHeader("X-Xhrsource",
"posterous")};if(type==="GET"){cacheKey=this.formatCacheKey(params);oldSuccess=params.success;params.success=__bind(function(resp,status,xhr){if(oldSuccess)oldSuccess(resp,status,xhr);Dashboard.Cache[cacheKey]={xhr:xhr,resp:resp,status:status};return Posterous.hideLoader()},this);if(cached=Dashboard.Cache[cacheKey]){this.totalPages=cached.totalPages;this.currentPage=cached.currentPage;oldSuccess(cached.resp,cached.status,cached.xhr);return true}}if(abort)return Dashboard.currentRequest=$.ajax(params);
else return $.ajax(params)};PaginatedCollection.prototype.fetchPage=function(newPage,options){if(typeof this.totalPages!=="undefined")this._errorIfOutsideRange(newPage);this.currentPage=newPage;return this.fetch(options)};PaginatedCollection.prototype.fetchNextPage=function(options){this._errorIfNewCollection();return this.fetchPage(this.currentPage+1,options)};PaginatedCollection.prototype.fetchPreviousPage=function(options){this._errorIfNewCollection();return this.fetchPage(this.currentPage-1,options)};
PaginatedCollection.prototype.hasNextPage=function(){this._errorIfNewCollection();return this._isPageInRange(this.currentPage+1)};PaginatedCollection.prototype.hasPreviousPage=function(){this._errorIfNewCollection();return this._isPageInRange(this.currentPage-1)};PaginatedCollection.prototype.nextPage=function(){var nextPage;if(this._isPageInRange(nextPage=this.currentPage+1))return nextPage};PaginatedCollection.prototype.previousPage=function(){var prevPage;if(this._isPageInRange(prevPage=this.currentPage-
1))return prevPage};PaginatedCollection.prototype._isPageInRange=function(newPage){return newPage<=this.totalPages&&newPage>=1};PaginatedCollection.prototype._errorIfNewCollection=function(){if(typeof this.currentPage==="undefined"||typeof this.totalPages==="undefined")throw new Error("Must initialize the collection by first calling `fetch` or `fetchPage`.");};PaginatedCollection.prototype._errorIfOutsideRange=function(newPage){if(!this._isPageInRange(newPage))throw new Error("Page "+newPage+" cannot be fetched: there are only "+
this.totalPages+" pages available");};return PaginatedCollection}();Posterous._wrapError=function(onError,model,options){return function(resp){Posterous.hideLoader();if(onError)return onError(model,resp);else return model.trigger("error",model,resp,options)}};Posterous.showLoader=function(){};Posterous.hideLoader=function(){};Posterous.fetchAndAssignCurrentUser=function(user){return this.currentUser=user?new Posterous.Models.User(user):null};return Posterous.getConstructorName=function(obj){var funcNameRegex,
results;funcNameRegex=/function ([^\(]{1,})\(/;results=funcNameRegex.exec(obj.constructor.toString());if(results&&results.length>1)return results[1];else return""}})(window,document,void 0,jQuery)}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Post=function(){__extends(Post,Posterous.Model);function Post(){Post.__super__.constructor.apply(this,arguments)}Post.prototype.namespaceKey="post";Post.prototype.mediaType=null;
Post.prototype.url=function(){var base;base=""+Posterous.BASE_URL+"/sites/"+this.get("site_id")+"/posts";if(this.isNew())return base;else return""+base+"/"+this.id};Post.prototype.initialize=function(){this.hasMany("comments",Posterous.Collections.Comments);this.hasMany("likes",Posterous.Collections.Likes);this.belongsTo("site",Posterous.Models.Site);this.belongsTo("user",Posterous.Models.User);return this.belongsTo("email",Posterous.Models.Email)};Post.prototype.fetchResponses=function(callback){return $.ajax({url:""+
this.url()+"/responses",data:{},success:callback,beforeSend:function(xhr){return xhr.setRequestHeader("X-Xhrsource","posterous")}})};Post.prototype.approve=function(callback){return $.ajax({url:""+this.url()+"/approve",type:"post",data:{_method:"put"},success:callback,beforeSend:function(xhr){return xhr.setRequestHeader("X-Xhrsource","posterous")}})};Post.prototype.flag=function(callback){return $.ajax({url:""+Posterous.BASE_URL+"/popular_posts/"+this.id,type:"post",data:{_method:"delete",is_flagged:true},
success:callback})};Post.prototype.flag=function(callback){return $.ajax({url:""+Posterous.BASE_URL+"/popular_posts/"+this.id,type:"post",data:{_method:"delete",is_flagged:true},success:callback})};Post.prototype.type=function(){if(this.mediaType)return this.mediaType;if(this.media().videos.length>=1)return this.mediaType="video";else if(this.media().audio_files.length>=1)return this.mediaType="audio";else if(this.media().images.length>1)return this.mediaType="gallery";else if(this.media().images.length===
1)return this.mediaType="image";else return this.mediaType="text"};Post.prototype.fullUrl=function(){if(this.get("is_private"))return this.get("full_url").replace(this.get("slug"),"private/"+this.get("privatestring"));else return this.get("full_url")};Post.prototype.hasPreviewImage=function(){return this.media().images!=="undefined"&&this.media().images.length>0};Post.prototype.previewImage=function(){return(this.media().images[0].scaled500||this.media().images[0].full).url};Post.prototype.media=
function(){return this.get("media")};Post.prototype.vimeoId=function(){return this.extractIframe()};Post.prototype.youTubeId=function(){return this.extractIframe()};Post.prototype.hasYouTube=function(){return this.get("body_cleaned").indexOf("www.youtube.com")!==-1};Post.prototype.hasVimeo=function(){return this.get("body_cleaned").indexOf("player.vimeo.com/video")!==-1};Post.prototype.wrappedBody=function(){return $("<div>"+this.get("body_cleaned")+"</div>")};Post.prototype.extractIframe=function(){var height,
iframe,oldheight,oldwidth,videoId,videoUrl,width,_ref;iframe=this.wrappedBody().find("iframe");if(iframe.length===0)return null;videoUrl=_.last(iframe.attr("src").split("/"));if(iframe.attr("src").indexOf("youtube")!==-1||iframe.attr("src").indexOf("vimeo")!==-1){videoId=_.first(videoUrl.split("?"));oldheight=iframe.attr("height");oldwidth=iframe.attr("width");_ref=this.resizeVideo(oldheight,oldwidth),height=_ref[0],width=_ref[1];return{videoId:videoId,height:height,width:width}}};Post.prototype.resizeVideo=
function(height,width){var new_height,ratio;ratio=width/height;new_height=500/ratio;return[Math.floor(new_height),500]};Post.prototype.isOwnedByCurrentUser=function(){return this.get("is_owned_by_current_user")};Post.prototype.isEditableByCurrentUser=function(){return this.isOwnedByCurrentUser()||this.get("current_member")==="admin"};return Post}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Account=function(){__extends(Account,Posterous.Model);function Account(){Account.__super__.constructor.apply(this,arguments)}Account.prototype.id="backboneisworsethanphp";Account.prototype.namespaceKey=
"user";Account.prototype.url=function(){return""+Posterous.BASE_URL+"/account"};Account.prototype.formConfig={password:{type:"Dashboard.Views.PasswordFieldView",opts:{label:"Password",description:"Type your password to delete your account"}}};return Account}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Activity=function(){__extends(Activity,Posterous.Model);function Activity(){Activity.__super__.constructor.apply(this,arguments)}Activity.prototype.namespaceKey="activity";Activity.prototype.initialize=
function(){};return Activity}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Comment=function(){__extends(Comment,Posterous.Model);function Comment(){Comment.__super__.constructor.apply(this,arguments)}Comment.prototype.namespaceKey="comment";Comment.prototype.formConfig=
{body:{type:"Dashboard.Views.TextAreaView",opts:{label:"Comment:"}}};Comment.prototype.validate=function(attrs){var errors;errors=[];if(!attrs.body)errors.push("Body must be present");if(errors.length>0)return errors;else return};Comment.prototype.initialize=function(){return this.belongsTo("post",Posterous.Models.Post)};Comment.prototype.isReallyNew=true;Comment.prototype.isNew=function(){return this.isReallyNew};Comment.prototype.url=function(){var base;base=this.post.url()+"/comments";if(this.isNew())return base;
else return""+base+"/"+this.id};Comment.prototype.approve=function(callback){return $.post(""+this.url()+"/approve",{_method:"put"},callback)};return Comment}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Email=function(){__extends(Email,Posterous.Model);function Email(){Email.__super__.constructor.apply(this,arguments)}Email.prototype.namespaceKey="email";Email.prototype.formConfig=
{email:{type:"Dashboard.Views.TextFieldView",opts:{label:"Email Address",description:'Type an email then click "Add Email". We will send a confirmation to that address.'}}};Email.prototype.url=function(){var base;this.user=Dashboard.currentUser;if(!this.user||!this.user.id)throw new Error("Email must belong to a valid user");base=this.user.url()+"/emails";if(this.isNew())return base;else return""+base+"/"+this.id};Email.prototype.initialize=function(){return this.belongsTo("user",Posterous.Models.User)};
Email.prototype.makePrimary=function(success,error){return this.save({primary:true},{success:success,error:error})};Email.prototype.sendConfirmation=function(success,error){return this.save({send_confirmation:true},{success:success,error:error})};return Email}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.ExternalSite=function(){__extends(ExternalSite,Posterous.Model);function ExternalSite(){ExternalSite.__super__.constructor.apply(this,arguments)}ExternalSite.prototype.namespaceKey=
"external_site";ExternalSite.prototype.save=function(){throw new Error("External Sites cannot be created or updated");};ExternalSite.prototype.initialize=function(){return this.belongsTo("site",Posterous.Models.Site)};return ExternalSite}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.FriendSource=function(){__extends(FriendSource,Posterous.Model);function FriendSource(){FriendSource.__super__.constructor.apply(this,arguments)}FriendSource.prototype.namespaceKey=
"source";FriendSource.prototype.service=function(){return this.get("service")};FriendSource.prototype.href=function(){return this.get("href")};FriendSource.prototype.name=function(){return this.get("name")};return FriendSource}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Like=function(){__extends(Like,Posterous.Model);function Like(){Like.__super__.constructor.apply(this,arguments)}Like.prototype.namespaceKey="like";Like.prototype.save=function(attributes,
options){if(this.isNew())return Posterous.Model.prototype.save.call(this,attributes,options);else throw new Error("Likes cannot be updated");};Like.prototype.initialize=function(){return this.belongsTo("post",Posterous.Models.Post)};Like.prototype.url=function(){var base;base=this.post.url()+"/likes";if(this.isNew())return base;else return""+base+"/"+this.id};return Like}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Link=function(){__extends(Link,Posterous.MovableModel);function Link(){Link.__super__.constructor.apply(this,arguments)}Link.prototype.namespaceKey="link";Link.prototype.validate=
function(attrs){var errors;errors=[];if(!attrs.title)errors.push("Title must be present");if(!attrs.url)errors.push("URL must be present");if(errors.length>0)return errors;else return};return Link}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.LinkCategory=function(){__extends(LinkCategory,Posterous.MovableModel);function LinkCategory(){LinkCategory.__super__.constructor.apply(this,arguments)}LinkCategory.prototype.namespaceKey=
"link_category";LinkCategory.prototype.initialize=function(){Posterous.MovableModel.prototype.initialize.call(this);this.links=new Posterous.Collections.Links;return this.links.category=this};LinkCategory.prototype.validate=function(attrs){var errors;errors=[];if(!attrs.title)errors.push("Title must be present");if(errors.length>0)return errors;else return};LinkCategory.prototype.save=function(attrs,options){if(this.canEdit())return Posterous.Model.prototype.save.call(this,attrs,options);else throw new Error("Cannot change Navigation category");
};LinkCategory.prototype.destroy=function(options){if(this.canDestroy())return Posterous.Model.prototype.destroy.call(this,options);else throw new Error("Cannot destroy Navigation category");};LinkCategory.prototype.canEdit=function(){return!this.isNavigation()};LinkCategory.prototype.canDestroy=function(){return!this.isNavigation()};LinkCategory.prototype.isNavigation=function(){return this.get("position")===0};LinkCategory.prototype.canMoveTo=function(newPosition){return newPosition>0};return LinkCategory}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.MailSetting=function(){__extends(MailSetting,Posterous.Model);function MailSetting(){MailSetting.__super__.constructor.apply(this,arguments)}MailSetting.prototype.namespaceKey=
"mail_setting";MailSetting.prototype.formConfig={mysubs:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Your subscription email",optionsForSelect:[["Daily",2],["Weekly",3],["Never",4]]}},post_replies:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"When you email a new post",description:'When you <a href="http://help.posterous.com/how-to-post-by-email-video" class="help">send a post via email</a>',optionsForSelect:[["Instantly",1],["Never",4]]}},subs:{type:"Dashboard.Views.SelectDropdownView",
opts:{label:"Follow emails",description:"When someone follows one of your spaces",optionsForSelect:[["Instantly",1],["Daily",2],["Weekly",3],["Never",4]]}},comments:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Response emails",description:"When someone responds to your posts",optionsForSelect:[["Instantly",1],["Daily",2],["Weekly",3],["Never",4]]}},moderation:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Moderation emails",description:"When a post or comment needs moderation",
optionsForSelect:[["Instantly",1],["Daily",2],["Weekly",3],["Never",4]]}},whatsnew:{type:"Dashboard.Views.SelectDropdownView",opts:{label:"Posterous Newsletter",optionsForSelect:[["Monthly",5],["Never",4]]}}};MailSetting.prototype.url=function(){return Posterous.BASE_URL+"/users/me/mail_setting"};return MailSetting}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Notification=function(){__extends(Notification,Posterous.Model);function Notification(){Notification.__super__.constructor.apply(this,arguments)}Notification.prototype.namespaceKey=
"notification";Notification.prototype.initialize=function(){};return Notification}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Page=function(){__extends(Page,Posterous.Model);function Page(){Page.__super__.constructor.apply(this,arguments)}Page.prototype.namespaceKey="page";Page.prototype.validate=function(attrs){var errors;
errors=[];if(!attrs.title)errors.push("Title must be present");if(!attrs.body)errors.push("Body must be present");if(errors.length>0)return errors;else return};return Page}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.PopularPost=function(){__extends(PopularPost,Posterous.Models.Post);function PopularPost(){PopularPost.__super__.constructor.apply(this,arguments)}PopularPost.prototype.remove=
function(callback){return $.ajax({url:""+Posterous.BASE_URL+"/popular_posts/"+this.id,type:"post",data:{_method:"delete"},success:callback})};return PopularPost}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Site=function(){__extends(Site,Posterous.Model);function Site(){Site.__super__.constructor.apply(this,arguments)}Site.prototype.namespaceKey="site";Site.prototype.formConfig={name:{type:"Dashboard.Views.TextFieldView",
opts:{label:"Space Name",description:"This is the title others will see on your Space (required)."}},subhead:{type:"Dashboard.Views.TextAreaView",opts:{label:"Description"}},hostname:{type:"Dashboard.Views.UrlFieldView",opts:{label:"URL",description:"This is the web address of your Space. You can change it later (required)."}}};Site.prototype.url=function(){var base;base=Posterous.BASE_URL+"/sites";if(this.isNew())return base;else return base+"/"+this.id};Site.prototype.initialize=function(){this.hasOne("theme",
Posterous.Models.Theme);this.hasOne("profile",Posterous.Models.SiteProfile);this.hasMany("posts",Posterous.Collections.Posts);this.hasMany("external_sites",Posterous.Collections.ExternalSites);this.hasMany("link_categories",Posterous.Collections.LinkCategories);this.hasMany("pages",Posterous.Collections.Pages);this.hasMany("activities",Posterous.Collections.Activities);this.hasMany("followers",Posterous.Collections.Followers);return this.hasMany("authors",Posterous.Collections.Authors)};Site.prototype.subscribe=
function(callback){return $.post(""+this.url()+"/subscribe",{_method:"put"},callback)};Site.prototype.unsubscribe=function(callback){return $.post(""+this.url()+"/unsubscribe",{_method:"put"},callback)};Site.prototype.subscribeViaJsonp=function(callback,error){return jQuery.jsonp({url:""+this.url()+"/subscribe_via_jsonp.jsonp",success:callback,error:error})};Site.prototype.unsubscribeViaJsonp=function(callback,error){return jQuery.jsonp({url:""+this.url()+"/unsubscribe_via_jsonp.jsonp",success:callback,
error:error})};Site.prototype.subscribe_by_email=function(email,callback){return $.post(""+this.url()+"/subscribe_by_email",{_method:"put",email:email,authenticity_token:_token},callback)};Site.prototype.enableInstant=function(callback){this.set({current_user_notification_frequency:"immediately"});return $.post(""+this.url()+"/notifications",{_method:"put",email_notifications:"instant"},callback)};Site.prototype.disableInstant=function(callback){this.set({current_user_notification_frequency:"daily"});
return $.post(""+this.url()+"/notifications",{_method:"put",email_notifications:"daily"},callback)};Site.prototype.makePrimary=function(callback){return $.post(""+this.url()+"/make_primary",{_method:"put",authenticity_token:_token},callback)};Site.prototype.mergeImport=function(siteId,callback){if(callback==null)callback=null;return $.post(""+this.url()+"/merge_with_site",{_method:"put",authenticity_token:_token,merge_target_site_id:siteId},callback)};Site.prototype.currentUserRole=function(){return this.get("current_user_role")};
Site.prototype.roleWithIndefiniteArticle=function(){if(this.isAdmin())return"an administrator of";if(this.isContributor())return"a contributor to";if(this.isSubscriber())return"a follower of"};Site.prototype.isAdmin=function(){return this.currentUserRole()==="admin"};Site.prototype.isContributor=function(){return this.currentUserRole()==="contributor"};Site.prototype.isSubscriber=function(){return this.currentUserRole()==="subscriber"};Site.prototype.isAuthor=function(){return this.isAdmin()||this.isContributor()};
Site.prototype.isMember=function(){return this.isAdmin()||this.isContributor()||this.isSubscriber()};Site.prototype.isPrimaryFor=function(user){return this.id===user.get("site_id")};Site.prototype.hostname=function(){return this.get("hostname")};Site.prototype.canBeLeftByCurrentUser=function(){return!this.isPrimaryFor(Dashboard.currentUser)&&(this.get("current_user_role")==="contributor"||this.get("admins_count")>1)};Site.prototype.canBeDeletedByCurrentUser=function(){return this.get("current_user_role")===
"admin"&&!this.isPrimaryFor(Dashboard.currentUser)};Site.prototype.canBeMadePrimary=function(){return!this.isPrimaryFor(Dashboard.currentUser)&&this.get("current_user_role")==="admin"};return Site}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.SiteProfile=function(){__extends(SiteProfile,Posterous.Model);function SiteProfile(){SiteProfile.__super__.constructor.apply(this,arguments)}SiteProfile.prototype.namespaceKey=
"site_profile";SiteProfile.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Site Profile must belong to a valid site");return this.site.url()+"/profile"};SiteProfile.prototype.create=function(attributes,options){return this.save(attributes,options)};return SiteProfile}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.Theme=function(){__extends(Theme,Posterous.Model);function Theme(){Theme.__super__.constructor.apply(this,arguments)}Theme.prototype.namespaceKey="theme";Theme.prototype.url=function(){if(!this.site||
!this.site.id)throw new Error("Theme must belong to a valid site");return this.site.url()+"/theme"};Theme.prototype.save=function(){throw new Error("Theme is a read-only resource and cannot be saved");};Theme.prototype.destroy=function(){throw new Error("Theme is a read-only resource and cannot be destroyed");};return Theme}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Models.UpdatePassword=function(){__extends(UpdatePassword,Posterous.Model);function UpdatePassword(){UpdatePassword.__super__.constructor.apply(this,arguments)}UpdatePassword.prototype.namespaceKey=
"user";UpdatePassword.prototype.formConfig={old_password:{type:"Dashboard.Views.PasswordFieldView",opts:{label:"Old Password"}},new_password:{type:"Dashboard.Views.PasswordFieldView",opts:{label:"New Password"}}};UpdatePassword.prototype.url=function(){return Posterous.BASE_URL+("/users/"+this.id+"/update_password")};return UpdatePassword}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Posterous.Models.User=function(){__extends(User,Posterous.Model);function User(){User.__super__.constructor.apply(this,
arguments)}User.prototype.namespaceKey="user";User.prototype.formConfig={firstname:{type:"Dashboard.Views.TextFieldView",opts:{label:"First Name"}},lastname:{type:"Dashboard.Views.TextFieldView",opts:{label:"Last Name"}},nickname:{type:"Dashboard.Views.TextFieldView",opts:{}},body:{type:"Dashboard.Views.TextAreaView",opts:{description:"Appears on your profile page.",label:"Profile text"}},profile_pic:{type:"Dashboard.Views.FileFieldView",opts:{label:"Profile Image"}}};User.prototype.states=["welcome",
"profile","findFriends","post","customize","autopost","downloadApp","addPeople","addGallery","addVideo","explore","createSpace","confirmEmail"];User.prototype.eventsForExisting=[{name:"next",from:"welcome",to:"profile"},{name:"next",from:"profile",to:"post"},{name:"next",from:"post",to:"customize"},{name:"next",from:"customize",to:"findFriends"},{name:"next",from:"findFriends",to:"confirmEmail"},{name:"next",from:"confirmEmail",to:"autopost"},{name:"next",from:"autopost",to:"downloadApp"},{name:"next",
from:"downloadApp",to:"addPeople"},{name:"next",from:"addPeople",to:"addVideo"},{name:"next",from:"addVideo",to:"createSpace"},{name:"next",from:"createSpace",to:"completed"},{name:"skipall",from:["welcome","profile","post","customize","findFriends"],to:"confirmEmail"},{name:"skipall",from:["autopost","downloadApp","addPeople","addVideo","createSpace"],to:"completed"}];User.prototype.eventsForNew=[{name:"next",from:"welcome",to:"post"},{name:"next",from:"post",to:"profile"},{name:"next",from:"profile",
to:"customize"},{name:"next",from:"customize",to:"findFriends"},{name:"next",from:"findFriends",to:"confirmEmail"},{name:"next",from:"confirmEmail",to:"autopost"},{name:"next",from:"autopost",to:"downloadApp"},{name:"next",from:"downloadApp",to:"addPeople"},{name:"next",from:"addPeople",to:"addVideo"},{name:"next",from:"addVideo",to:"createSpace"},{name:"next",from:"createSpace",to:"completed"},{name:"skipall",from:["welcome","profile","post","customize","findFriends"],to:"confirmEmail"},{name:"skipall",
from:["autopost","downloadApp","addPeople","addVideo","createSpace"],to:"completed"}];User.prototype.eventsForContributor=[{name:"next",from:"welcome",to:"post"},{name:"next",from:"post",to:"profile"},{name:"next",from:"profile",to:"confirmEmail"},{name:"next",from:"confirmEmail",to:"explore"},{name:"next",from:"explore",to:"findFriends"},{name:"next",from:"findFriends",to:"downloadApp"},{name:"next",from:"downloadApp",to:"createSpace"},{name:"next",from:"createSpace",to:"addGallery"},{name:"skip",
from:"createSpace",to:"completed"},{name:"next",from:"addGallery",to:"completed"},{name:"skipall",from:["welcome","profile","post","customize","findFriends"],to:"confirmEmail"},{name:"skipall",from:["autopost","downloadApp","addPeople","addVideo","createSpace","addGallery"],to:"confirmEmail"}];User.prototype.eventsForComment=[{name:"next",from:"welcome",to:"profile"},{name:"next",from:"profile",to:"findFriends"},{name:"next",from:"findFriends",to:"confirmEmail"},{name:"next",from:"confirmEmail",to:"downloadApp"},
{name:"next",from:"downloadApp",to:"createSpace"},{name:"next",from:"createSpace",to:"post"},{name:"skip",from:"createSpace",to:"completed"},{name:"next",from:"post",to:"addGallery"},{name:"next",from:"addGallery",to:"completed"},{name:"skipall",from:["welcome","profile","post","customize","findFriends"],to:"confirmEmail"},{name:"skipall",from:["autopost","downloadApp","addPeople","addVideo","createSpace","addGallery"],to:"confirmEmail"}];User.prototype.eventsForSubscriber=[{name:"next",from:"welcome",
to:"profile"},{name:"next",from:"profile",to:"findFriends"},{name:"next",from:"findFriends",to:"confirmEmail"},{name:"next",from:"explore",to:"downloadApp"},{name:"next",from:"downloadApp",to:"createSpace"},{name:"next",from:"createSpace",to:"post"},{name:"skip",from:"createSpace",to:"completed"},{name:"next",from:"post",to:"addGallery"},{name:"next",from:"addGallery",to:"completed"},{name:"skipall",from:["welcome","profile","post","customize","findFriends"],to:"confirmEmail"},{name:"skipall",from:["autopost",
"downloadApp","addPeople","addVideo","createSpace","addGallery"],to:"confirmEmail"}];User.prototype.url=function(){return Posterous.BASE_URL+("/users/"+this.id)};User.prototype.initialize=function(){_.bindAll(this,"updateOnboardingState","oncustomize","onconfirmEmail","onprofile","onpost","onwelcome");this.hasMany("notifications",Posterous.Collections.Notifications);this.hasMany("reader_posts",Posterous.Collections.ReaderPosts);this.hasMany("unmoderated_posts",Posterous.Collections.UnmoderatedPosts);
this.hasMany("unmoderated_comments",Posterous.Collections.UnmoderatedComments);this.hasMany("sites",Posterous.Collections.Sites);this.hasMany("user_sites",Posterous.Collections.UserSites);this.hasMany("emails",Posterous.Collections.Emails);this.hasMany("subscriptions",Posterous.Collections.Subscriptions);this.hasMany("imports",Posterous.Collections.Imports);this.hasOne("mail_setting",Posterous.Models.MailSetting);return this.hasMany("activities",Posterous.Collections.Activities)};User.prototype.initializeStateMachine=
function(){this.stateMachine=StateMachine.create({initial:this.get("onboarding_status_state"),events:this["eventsFor"+this.get("onboarding_status_origin").underscore().camelize(false)]});this.showManageTooltip();this.stateMachine.onskip=this.stateMachine.onnext=this.stateMachine.onskipall=this.updateOnboardingState;this.stateMachine.oncustomize=this.oncustomize;this.stateMachine.onconfirmEmail=this.onconfirmEmail;this.stateMachine.onprofile=this.onprofile;this.stateMachine.onpost=this.onpost;this.stateMachine.onwelcome=
this.onwelcome;return this.updateOnboardingState(false)};User.prototype.showManageTooltip=function(){if(this.stateMachine.current!=="autopost"&&this.stateMachine.current!=="createSpace"&&this.get("onboarding_status_origin")==="existing"&&$.cookie("manageTipShown")!=="true"&&$.cookie("manageTipShown")!==true){$.cookie("manageTipShown","true",{expires:365});return this.tooltip=new Posterous.TooltipView({target:$("li.spaces"),title:"Looking for Manage?",body:"Manage has been moved to the Spaces tab. You can manage your Spaces and posts from here.",
links:[{text:"Take me there",href:"#spaces",htmlClass:"go_to_manage",callback:__bind(function(){return Posterous.TooltipView.prototype.closeAll()},this)}]})}};User.prototype.oncustomize=function(){if(Dashboard.defaultSites.first().get("theme_id")!==Dashboard.DEFAULT_THEME_ID)return this.stateMachine.next()};User.prototype.onconfirmEmail=function(){if(Dashboard.currentUser.get("confirmed")===true)return this.stateMachine.next()};User.prototype.onprofile=function(){if(!(_.isEmpty(Dashboard.currentUser.get("firstname"))&&
_.isEmpty(Dashboard.currentUser.get("lastname"))))return this.stateMachine.next()};User.prototype.onpost=function(){if(Dashboard.currentUser.get("posts_count")>0)return this.stateMachine.next()};User.prototype.onwelcome=function(){if(Dashboard.currentUser.get("onboarding_status_origin")!=="existing")return this.stateMachine.next()};User.prototype.updateOnboardingState=function(save){var animated,newStatusView,_name;if(save==null)save=true;if(save)this.save({onboarding_status_attributes:{state:this.stateMachine.current}});
else if(typeof this[_name="on"+this.stateMachine.current]==="function")this[_name]();animated=!Dashboard.shownOnboardingNag;if(!(Dashboard.shownOnboardingNag===true&&!_(["confirmEmail","customize","findFriends","post","welcome","profile"]).include(this.stateMachine.current)||$.cookie("interstitialClosed")==="true")){newStatusView=""+this.stateMachine.current.underscore().camelize(false)+"StatusView";Dashboard.shownOnboardingNag=true;if(Dashboard.Views[newStatusView])return Dashboard.currentInterstitial=
new Dashboard.Views[newStatusView](animated)}};return User}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Activities=function(){__extends(Activities,Posterous.PaginatedCollection);function Activities(){Activities.__super__.constructor.apply(this,arguments)}Activities.prototype.model=
Posterous.Models.Activity;Activities.prototype.url=function(){if(typeof this.site!=="undefined")return this.site.url()+"/activities?snippets=true";else if(typeof this.user!=="undefined")return this.user.url()+"/activities?snippets=true"};return Activities}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Authors=function(){__extends(Authors,Posterous.PaginatedCollection);function Authors(){Authors.__super__.constructor.apply(this,arguments)}Authors.prototype.model=Posterous.Models.User;
Authors.prototype.url=function(){return this.site.url()+"/authors"};return Authors}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Comments=function(){__extends(Comments,Backbone.Collection);function Comments(){Comments.__super__.constructor.apply(this,arguments)}Comments.prototype.model=Posterous.Models.Comment;
Comments.prototype.url=function(){return Posterous.BASE_URL+"/comments"};return Comments}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Emails=function(){__extends(Emails,Posterous.PaginatedCollection);function Emails(){Emails.__super__.constructor.apply(this,arguments)}Emails.prototype.model=Posterous.Models.Email;
Emails.prototype.url=function(){return Posterous.BASE_URL+"/users/me/emails"};return Emails}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.ExplorePosts=function(){__extends(ExplorePosts,Posterous.PaginatedCollection);function ExplorePosts(){ExplorePosts.__super__.constructor.apply(this,arguments)}ExplorePosts.prototype.model=
Posterous.Models.Post;ExplorePosts.prototype.perPage=20;ExplorePosts.prototype.url=function(){return Posterous.BASE_URL+"/explore"};return ExplorePosts}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.ExternalSites=function(){__extends(ExternalSites,Backbone.Collection);function ExternalSites(){ExternalSites.__super__.constructor.apply(this,arguments)}ExternalSites.prototype.model=
Posterous.Models.ExternalSite;ExternalSites.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("External Sites collection must belong to a valid site");return this.site.url()+"/external_sites"};return ExternalSites}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Followers=function(){__extends(Followers,Posterous.PaginatedCollection);function Followers(){Followers.__super__.constructor.apply(this,arguments)}Followers.prototype.model=
Posterous.Models.User;Followers.prototype.url=function(){return this.site.url()+"/subscribers"};return Followers}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.FriendSources=function(){__extends(FriendSources,Backbone.Collection);function FriendSources(){FriendSources.__super__.constructor.apply(this,arguments)}FriendSources.prototype.model=
Posterous.Models.FriendSource;FriendSources.prototype.url=function(){return Posterous.BASE_URL+"/users/me/friends/sources"};return FriendSources}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Friends=function(){__extends(Friends,Backbone.Collection);function Friends(){Friends.__super__.constructor.apply(this,arguments)}Friends.prototype.model=Posterous.Models.Site;
Friends.prototype.url=function(){return Posterous.BASE_URL+"/users/me/friends"};Friends.prototype.followAll=function(callback){var i,params,url;url=""+Posterous.BASE_URL+"/users/me/subscriptions";i=0;params={site_ids:[]};this.each(function(site){params["site_ids"][i]=site.get("id");return i++});return $.ajax({url:url,type:"post",data:$.extend(params,{authenticity_token:_token}),complete:callback,beforeSend:function(xhr){return xhr.setRequestHeader("X-Xhrsource","posterous")}})};return Friends}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Imports=function(){__extends(Imports,Posterous.PaginatedCollection);function Imports(){Imports.__super__.constructor.apply(this,arguments)}Imports.prototype.model=Posterous.Models.Site;
Imports.prototype.url=function(){return Posterous.BASE_URL+"/sites/imports?completed=true"};return Imports}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Likes=function(){__extends(Likes,Backbone.Collection);function Likes(){Likes.__super__.constructor.apply(this,arguments)}Likes.prototype.model=Posterous.Models.Like;Likes.prototype.url=
function(){if(!this.post||!this.post.id)throw new Error("Likes collection must belong to a valid post");return this.post.url()+"/likes"};return Likes}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.LinkCategories=function(){__extends(LinkCategories,Backbone.Collection);function LinkCategories(){LinkCategories.__super__.constructor.apply(this,arguments)}LinkCategories.prototype.model=
Posterous.Models.LinkCategory;LinkCategories.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Link Categories collection must belong to a valid site");return this.site.url()+"/link_categories"};return LinkCategories}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Links=function(){__extends(Links,Backbone.Collection);function Links(){Links.__super__.constructor.apply(this,arguments)}Links.prototype.model=Posterous.Models.Link;Links.prototype.url=
function(){if(!this.category||!this.category.id)throw new Error("Links collection must belong to a valid category");return this.category.url()+"/links"};return Links}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Notifications=function(){__extends(Notifications,Posterous.PaginatedCollection);function Notifications(){Notifications.__super__.constructor.apply(this,arguments)}Notifications.prototype.model=
Posterous.Models.Notification;Notifications.prototype.url=function(){return Posterous.BASE_URL+"/users/me/activities/stream?snippets=true"};return Notifications}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Pages=function(){__extends(Pages,Backbone.Collection);function Pages(){Pages.__super__.constructor.apply(this,arguments)}Pages.prototype.model=Posterous.Models.Page;Pages.prototype.url=
function(){if(!this.site||!this.site.id)throw new Error("Pages collection must belong to a valid site");return this.site.url()+"/pages"};return Pages}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.PopularPosts=function(){__extends(PopularPosts,Posterous.PaginatedCollection);function PopularPosts(){PopularPosts.__super__.constructor.apply(this,arguments)}PopularPosts.prototype.model=
Posterous.Models.PopularPost;PopularPosts.prototype.perPage=20;PopularPosts.prototype.url=function(){return Posterous.BASE_URL+"/popular_posts"};return PopularPosts}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Posts=function(){__extends(Posts,Posterous.PaginatedCollection);function Posts(){Posts.__super__.constructor.apply(this,arguments)}Posts.prototype.model=Posterous.Models.Post;
Posts.prototype.perPage=20;Posts.prototype.url=function(){if(!this.site||!this.site.id)throw new Error("Posts collection must belong to a valid site");return this.site.url()+"/posts"};return Posts}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.ReaderPosts=function(){__extends(ReaderPosts,Posterous.PaginatedCollection);function ReaderPosts(){ReaderPosts.__super__.constructor.apply(this,arguments)}ReaderPosts.prototype.model=
Posterous.Models.Post;ReaderPosts.prototype.perPage=20;ReaderPosts.prototype.url=function(){if(!this.user||!this.user.id)throw new Error("ReaderPosts collection must belong to a valid user");return Posterous.BASE_URL+("/users/"+this.user.id+"/subscriptions/posts")};return ReaderPosts}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.SiteActivities=function(){__extends(SiteActivities,Posterous.PaginatedCollection);function SiteActivities(){SiteActivities.__super__.constructor.apply(this,arguments)}SiteActivities.prototype.model=
Posterous.Models.Activity;SiteActivities.prototype.url=function(){return Posterous.BASE_URL+"/sites//activity?snippets=true"};return SiteActivities}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Sites=function(){__extends(Sites,Posterous.PaginatedCollection);function Sites(){Sites.__super__.constructor.apply(this,arguments)}Sites.prototype.model=Posterous.Models.Site;
Sites.prototype.perPage=20;Sites.prototype.url=function(){return Posterous.BASE_URL+"/sites"};Sites.prototype.findByHostname=function(hostname){var index;index=Dashboard.defaultSites.pluck("hostname").indexOf(hostname);if(index!==-1)return Dashboard.defaultSites.at(index);else return null};Sites.prototype.suggestHostname=function(name,callback){return $.get(""+this.url()+"/suggest_hostname?name="+name,callback)};return Sites}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.Subscriptions=function(){__extends(Subscriptions,Posterous.PaginatedCollection);function Subscriptions(){Subscriptions.__super__.constructor.apply(this,arguments)}Subscriptions.prototype.model=
Posterous.Models.Site;Subscriptions.prototype.url=function(){return this.user.url()+"/subscriptions"};return Subscriptions}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.UnmoderatedComments=function(){__extends(UnmoderatedComments,Backbone.Collection);function UnmoderatedComments(){UnmoderatedComments.__super__.constructor.apply(this,arguments)}
UnmoderatedComments.prototype.model=Posterous.Models.Comment;UnmoderatedComments.prototype.url=function(){if(!this.user||!this.user.id)throw new Error("UnmoderatedComments collection must belong to a valid user");return Posterous.BASE_URL+("/users/"+this.user.id+"/comments/unmoderated")};UnmoderatedComments.prototype.approveAll=function(callback){var url;url=Posterous.BASE_URL+("/users/"+this.user.id+"/comments/approve_all_unmoderated");return $.ajax({url:url,type:"post",data:{_method:"put"},success:callback,
beforeSend:function(xhr){return xhr.setRequestHeader("X-Xhrsource","posterous")}})};UnmoderatedComments.prototype.deleteAll=function(callback){var url;url=Posterous.BASE_URL+("/users/"+this.user.id+"/comments/destroy_all_unmoderated");return $.ajax({url:url,type:"post",data:{_method:"delete"},success:callback,beforeSend:function(xhr){return xhr.setRequestHeader("X-Xhrsource","posterous")}})};return UnmoderatedComments}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.UnmoderatedPosts=function(){__extends(UnmoderatedPosts,Posterous.PaginatedCollection);function UnmoderatedPosts(){UnmoderatedPosts.__super__.constructor.apply(this,arguments)}
UnmoderatedPosts.prototype.model=Posterous.Models.Post;UnmoderatedPosts.prototype.url=function(){if(!this.user||!this.user.id)throw new Error("UnmoderatedPosts collection must belong to a valid user");return Posterous.BASE_URL+("/users/"+this.user.id+"/posts/unmoderated")};UnmoderatedPosts.prototype.approveAll=function(callback){var url;url=Posterous.BASE_URL+("/users/"+this.user.id+"/posts/approve_all_unmoderated");return $.ajax({url:url,type:"post",data:{_method:"put"},success:callback,beforeSend:function(xhr){return xhr.setRequestHeader("X-Xhrsource",
"posterous")}})};UnmoderatedPosts.prototype.deleteAll=function(callback){var url;url=Posterous.BASE_URL+("/users/"+this.user.id+"/posts/destroy_all_unmoderated");return $.ajax({url:url,type:"delete",data:{_method:"put"},success:callback,beforeSend:function(xhr){return xhr.setRequestHeader("X-Xhrsource","posterous")}})};return UnmoderatedPosts}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Collections.UserSites=function(){__extends(UserSites,Posterous.PaginatedCollection);function UserSites(){UserSites.__super__.constructor.apply(this,arguments)}UserSites.prototype.model=
Posterous.Models.Site;UserSites.prototype.url=function(){return this.user.url()+"/sites/public"};return UserSites}()}).call(this);
(function(){if(!_.isFunction(window.innerShiv))window.innerShiv=function(str,doc){if(doc==null)doc=true;return str};jQuery(window).bind("app:deferredContentComplete",function(){var posterousBarView;Posterous.fetchAndAssignCurrentUser(deferredContent.current_user.evalJSON());posterousBarView=new Posterous.Views.PosterousBarView({model:new Posterous.Models.Site(deferredContent.site.evalJSON())});jQuery("#pbar").html(posterousBarView.el);if(jQuery("#pbar").length&&!Posterous.currentUser)mpmetrics.track("Posterous Bar: Shown - Logged Out");
if(jQuery("#pbar").length&&Posterous.currentUser)return mpmetrics.track("Posterous Bar: Shown - Logged In")})}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Posterous.Views.PosterousBarLoginFormView=function(){__extends(PosterousBarLoginFormView,Backbone.View);function PosterousBarLoginFormView(){PosterousBarLoginFormView.__super__.constructor.apply(this,
arguments)}PosterousBarLoginFormView.prototype.template=JST["posterous_bar_login_form"];PosterousBarLoginFormView.prototype.tagName="div";PosterousBarLoginFormView.prototype.className="pbar_login_form_view";PosterousBarLoginFormView.prototype.events={"click .sign_up":"switchPaneToSignUp","click .log_in":"switchPaneToLogin","click .log_in_form button":"logInSubmit","click .sign_up_form button":"signUpSubmit"};PosterousBarLoginFormView.prototype.initialize=function(){return this.render()};PosterousBarLoginFormView.prototype.render=
function(){$j(this.el).html(this.template({site:this.model}));this.initializeAutoFadeInputs();return this.switchPane("sign_up")};PosterousBarLoginFormView.prototype.logInSubmit=function(event){event.preventDefault();mpmetrics.track("Posterous Bar: Submitted Log In - Logged Out",{},__bind(function(){return this.$(".log_in_form").submit()},this));return false};PosterousBarLoginFormView.prototype.signUpSubmit=function(event){event.preventDefault();mpmetrics.track("Posterous Bar: Submitted Sign Up - Logged Out",
{},__bind(function(){return this.$(".sign_up_form").submit()},this));return false};PosterousBarLoginFormView.prototype.initializeAutoFadeInputs=function(){return this.$(".auto_fade_input input").each(function(){return new AutoFadeInput(this)})};PosterousBarLoginFormView.prototype.switchPane=function(pane){if(pane==null)pane="login";this.$("form").hide();this.$("menu li").removeClass("active");if(pane==="login"){this.$(".log_in_form").show();this.$(".sign_up_form").hide();this.$(".login").addClass("active");
this.$(".pbar_toggle").addClass("log_in_activated").removeClass("sign_up_activated");return this.$("#pbar_login_email").first().focus()}else{this.$(".log_in_form").hide();this.$(".sign_up_form").show();this.$(".sign_up").addClass("active");this.$(".pbar_toggle").removeClass("log_in_activated").addClass("sign_up_activated");return this.$("#pbar_user_toast").first().focus()}};PosterousBarLoginFormView.prototype.switchPaneToLogin=function(event){event.preventDefault();this.switchPane("login");return false};
PosterousBarLoginFormView.prototype.switchPaneToSignUp=function(event){event.preventDefault();this.switchPane("sign_up");return false};return PosterousBarLoginFormView}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Views.PosterousBarMenuView=function(){__extends(PosterousBarMenuView,Backbone.View);function PosterousBarMenuView(){PosterousBarMenuView.__super__.constructor.apply(this,arguments)}PosterousBarMenuView.prototype.template=
JST["posterous_bar_menu"];PosterousBarMenuView.prototype.tagName="div";PosterousBarMenuView.prototype.className="pbar_menu_view";PosterousBarMenuView.prototype.initialize=function(){return this.render()};PosterousBarMenuView.prototype.render=function(){return $j(this.el).html(innerShiv(this.template({site:this.model})))};return PosterousBarMenuView}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Views.PosterousBarNotificationView=function(){__extends(PosterousBarNotificationView,Backbone.View);function PosterousBarNotificationView(){PosterousBarNotificationView.__super__.constructor.apply(this,
arguments)}PosterousBarNotificationView.prototype.template=JST["posterous_bar_notification"];PosterousBarNotificationView.prototype.tagName="div";PosterousBarNotificationView.prototype.className="pbar_notification_view";PosterousBarNotificationView.prototype.initialize=function(){return this.render()};PosterousBarNotificationView.prototype.render=function(){return $j(this.el).html(this.template({message:this.options.message,links:this.options.links}))};return PosterousBarNotificationView}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Posterous.Views.PosterousBarView=function(){__extends(PosterousBarView,Backbone.View);function PosterousBarView(){PosterousBarView.__super__.constructor.apply(this,
arguments)}PosterousBarView.prototype.template=JST["posterous_bar"];PosterousBarView.prototype.tagName="div";PosterousBarView.prototype.className="pbar";PosterousBarView.prototype.events={"click .pbar_close":"close","mouseout .pbar_inner":"hoverAway","click .pbar_login_form":"follow","click .pbar_unfollow":"unfollow","click .unfollow_for_real":"unfollowForReal","click .cancel_unfollow":"close","mouseover .pbar_menu":"openMenu","click .pbar_menu":"openMenu","touchstart .pbar_menu":"openMenu","mouseover .pbar_inner":"keepMenuOpen",
"click .pbar_join":"clickedJoin"};PosterousBarView.prototype.initialize=function(){_.bindAll(this,"close","subscribeSuccess","subscribeError","unsubscribeSuccess","unsubscribeError");this.site=this.model;return this.render()};PosterousBarView.prototype.close=function(event){if(event==null)event=null;if(event!=null)event.preventDefault();this.closeAllPanes(false,__bind(function(){this.currentPane=null;return this.$(".pbar_main").hide()},this));return false};PosterousBarView.prototype.clickedJoin=function(event){event.preventDefault();
mpmetrics.track("Posterous Bar: Clicked Join",{},__bind(function(){return window.location.href=this.$(".pbar_join").attr("href")},this));return false};PosterousBarView.prototype.hoverAway=function(event){event.preventDefault();if(this.currentPane==="menu")this.menuTimeout=setTimeout(this.close,500);return false};PosterousBarView.prototype.render=function(){this.currentPane=null;this.subViews={login_form:new Posterous.Views.PosterousBarLoginFormView({model:this.site}),menu:new Posterous.Views.PosterousBarMenuView({model:this.site})};
$j(this.el).html(innerShiv(this.template({site:this.site})));this.$(".pbar_forgot").hide();this.appendSubViews();return this.close()};PosterousBarView.prototype.appendSubViews=function(){return _(_(this.subViews).values()).each(__bind(function(view){return this.$(".pbar_body").append($j(view.el).hide())},this))};PosterousBarView.prototype.unfollow=function(event){event.preventDefault();this.closeAllPanes();if(this.site.isSubscriber()&&this.site.get("is_private")===false)this.unfollowForReal(event);
else this.displayWarning("You are a member of the Space. If unfollow, you will leave the Space permanently. Would you like to proceed?",[{text:"Cancel",htmlClass:"cancel_unfollow",href:"#"},{text:"Unfollow",htmlClass:"unfollow_for_real",href:"#"}]);return false};PosterousBarView.prototype.displayWarning=function(message,buttons){this.$(".pbar_warning_view").remove();this.$(".pbar_body").append($j((new Posterous.Views.PosterousBarWarningView({message:message,buttons:buttons})).el).hide());return this.activatePane("warning")};
PosterousBarView.prototype.unfollowForReal=function(event){event.preventDefault();this.closeAllPanes();this.$(".pbar_unfollow").html("Unfollowing...");this.site.unsubscribeViaJsonp(this.unsubscribeSuccess,this.unsubscribeError);return false};PosterousBarView.prototype.follow=function(event){event.preventDefault();this.closeAllPanes();if(Posterous.currentUser){mpmetrics.track("Posterous Bar: Followed - Logged In");this.$(".pbar_login_form").html("Following...");this.site.subscribeViaJsonp(this.subscribeSuccess,
this.subscribeError)}else{mpmetrics.track("Posterous Bar: Clicked Follow - Logged Out");this.activatePane("login_form",true,__bind(function(){this.$(".pbar_forgot").show();return this.$(".pbar_login").hide()},this))}return false};PosterousBarView.prototype.subscribeSuccess=function(){this.site.set({current_user_role:"subscriber"});this.render();return this.displayNotification("<strong>"+this.site.get("name")+"</strong> has been added to your Reader",[{text:"Open Reader",htmlClass:"pbar_open_reader",
href:"http://"+POSTEROUS_HOSTNAME+"/"}])};PosterousBarView.prototype.unsubscribeSuccess=function(){if(this.site.get("is_private")===true){window.location.href="http://"+POSTEROUS_HOSTNAME;return}this.site.set({current_user_role:null});this.render();return this.displayNotification("You are no longer following <strong>"+this.site.get("name")+"</strong>")};PosterousBarView.prototype.displayNotification=function(message,links){this.$(".pbar_notification_view").remove();this.$(".pbar_body").append($j((new Posterous.Views.PosterousBarNotificationView({message:message,
links:links})).el).hide());return this.activatePane("notification")};PosterousBarView.prototype.subscribeError=function(){this(".pbar_login_form").html("Follow");return this.displayErrorMessage()};PosterousBarView.prototype.unsubscribeError=function(){this(".pbar_login_form").html("Unfollow");return this.displayErrorMessage()};PosterousBarView.prototype.displayErrorMessage=function(){return this.displayNotification("<strong>Oops!</strong><br />We are experiencing technical difficulties. Please try again later")};
PosterousBarView.prototype.keepMenuOpen=function(event){event.preventDefault();clearTimeout(this.menuTimeout);return false};PosterousBarView.prototype.openMenu=function(event){event.preventDefault();clearTimeout(this.menuTimeout);if(this.currentPane===null||event.type==="click")this.activatePane("menu");return false};PosterousBarView.prototype.activatePane=function(pane,animated,callback){if(animated==null)animated=true;this.$(".pbar_main").show();return this.closeAllPanes(animated,__bind(function(){this.currentPane=
pane;this.openPane(pane,animated);return typeof callback==="function"?callback():void 0},this))};PosterousBarView.prototype.openPane=function(pane,animated){this.$("a.pbar_"+pane).addClass("active");this.$(".pbar_"+pane+"_view").show();return $j(this.el).addClass("active")};PosterousBarView.prototype.closeAllPanes=function(animated,callback){$j(this.el).removeClass("active");this.$("header li a").removeClass("active");this.$(".pbar_body > div").hide();this.$(".pbar_forgot").hide();this.$(".pbar_login").show();
return typeof callback==="function"?callback():void 0};return PosterousBarView}()}).call(this);
(function(){var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){for(var key in parent)if(__hasProp.call(parent,key))child[key]=parent[key];function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Posterous.Views.PosterousBarWarningView=function(){__extends(PosterousBarWarningView,Backbone.View);function PosterousBarWarningView(){PosterousBarWarningView.__super__.constructor.apply(this,
arguments)}PosterousBarWarningView.prototype.template=JST["posterous_bar_warning"];PosterousBarWarningView.prototype.tagName="div";PosterousBarWarningView.prototype.className="pbar_warning_view";PosterousBarWarningView.prototype.initialize=function(){return this.render()};PosterousBarWarningView.prototype.render=function(){return $j(this.el).html(innerShiv(this.template({message:this.options.message,buttons:this.options.buttons})))};return PosterousBarWarningView}()}).call(this);
